/*
@version 1.0b
@author m13p4
@copyright Meliantchenkov Pavel
*/
var CSSC=function(){var y;return function(n,H){var v={},z=!1,e=null,B=function(){if(!z){if("cssRules"in n){var a=(n.ownerNode.getAttribute("data-cssc-ignore")||"").toLowerCase();if("true"!==a&&"1"!==a)try{A(n.cssRules,null)}catch(g){e.conf.viewErr&&console.log('Cannot init CSS from "'+n.href+'"'),e.messages.push('Cannot init CSS from "'+n.href+'"')}}else if("length"in n)for(var c=0;c<n.length;c++)if(a=(n[c].ownerNode.getAttribute("data-cssc-ignore")||"").toLowerCase(),"true"!==a&&"1"!==a)try{A(n[c].cssRules,
null)}catch(g){e.conf.viewErr&&console.log('Cannot init CSS from "'+n[c].href+'"'),e.messages.push('Cannot init CSS from "'+n[c].href+'"')}z=!0}},A=function(a,c){for(var e=0;e<a.length;e++)m.isElemInOwnNode(a[e])||D(a[e],c)},D=function(a,c,g){var d=a.cssText.substr(0,a.cssText.indexOf("{")).trim(),b=a.type,f=c?c.children:v;if(b!==e.type.rule&&b!==e.type.fontFace&&b!==e.type.media&&b!==e.type.keyframes&&b!==e.type.keyframe&&b!==e.type.page&&b!==e.type.supports)console.log("unsuported type: ["+b+"] - "+
e.type.names[b]);else return a._update=!1,b===e.type.rule&&(a.style._update={}),c={indexElem:a,selector:d,csscSelector:g?g:d,children:!1,parent:c?c:!1,events:{},obj:{},type:b},f[d]?(f[d].content[0].indexElem===a&&(console.log('Dublicate "'+d+'": '),console.log(Error().stack+"\n\n")),c=f[d].content.push(c)-1):(f[d]={type:b,content:[c],events:{}},c=0),b===e.type.media||b===e.type.keyframes||b===e.type.supports?(f[d].content[c].children={},A(a.cssRules,f[d].content[c])):f[d].content[c].obj=m.objFromCssText(a.cssText),
f[d]},u=function(a,c,g,d){d||y||m.createNewStyleElem();var b=d?d.indexElem:y.sheet;var f=b.cssRules.length,h="";if(c){var k=m.elemType(c);if("Object"===k)for(var t in c)"Function"===m.elemType(c[t])?(g=c[t](),h+=t+":"+g+"; "):h+=t+":"+c[t]+"; ";else if("Function"===k)for(t in g=c(),g)h+=t+":"+g[t]+"; ";else h=c+":"+g+";"}try{return"insertRule"in b?b.insertRule(a+"{"+h+"}",f):"appendRule"in b?b.appendRule(a+"{"+h+"}",f):"addRule"in b&&b.addRule(a,h,f),D(b.cssRules[f],d,a)}catch(E){e.conf.viewErr&&
console.log('"'+a+'" -> '+E),e.messages.push('"'+a+'" -> '+E)}return!1},F=function(a,c){z||B();c=c?c:v;return c[a]?c[a]:null},w=function(a,c,e){c=c?c:v;var d=m.elemType(a);if("String"===d)return c=F(a,c),e?c?c.content:[]:r(c?c.content:[],a);if("RegExp"===d){d=[];for(var b in c)if(b.match(a))for(f=0;f<c[b].content.length;f++)d.push(c[b].content[f]);return e?d:r(d,a)}if("Array"===d){d=[];var f;for(f=0;f<a.length;f++){var h=F(a[f],c);if(null!==h)for(b=0;b<h.content.length;b++)d.push(h.content[b])}return e?
d:r(d,a)}if("Null"===d||"Undefined"===d){d=[];for(b in c)for(f=0;f<c[b].content.length;f++)d.push(c[b].content[f]);return e?d:r(d,a)}return null},C=function(a,c,e,d){var b=m.elemType(a);if("String"===b||"RegExp"===b||"Array"===b||"Null"===b||"Undefined"===b)return a=w(a,e,d),c?a.has(c):a;x(a,null,e)},x=function(a,c){var g,d,b;for(d in a){var f="Array"===m.elemType(a[d])?a[d]:[a[d]];for(b=0;b<f.length;b++)if("@"===d.charAt(0))if("@font-face"===d)u(d,f[b],null,c);else if(d.match(/^@(media|keyframes|supports)/))if(g=
d.match(/^@(media|keyframes|supports)\s*$/)?!1:u(d,null,null,c)){var h=g.content.length-1;x(f[b],g.content[h])}else g={csscSelector:d,parent:c,type:null},d.match(/^@media/)?g.type=e.type.media:d.match(/^@keyframes/)?g.type=e.type.keyframes:d.match(/^@supports/)&&(g.type=e.type.supports),x(f[b],g);else c&&(c.type===e.type.media||c.type===e.type.keyframes||c.type===e.type.supports)&&(g=c.csscSelector+" "+d.substr(1),g=u(g,null,null,c.parent))&&(h=g.content.length-1,x(f[b],g.content[h]));else if(g=u(d,
null,null,c))g=r([g.content[g.content.length-1]],d),g.set(f[b])}},r=function(a,c,g,d){var b=function(a,c){var f,h,e=[];for(f=0;f<b.e.length;f++)if(b.e[f].children){var d=C(a,c,b.e[f].children,!0);for(h=0;h<d.length;h++)e.push(d[h])}return r(e,a,null,b.e)};b.e=a;b.eLength=a.length;b.set=function(a,h,k){if("number"===typeof k){if(this.e[k].indexElem.type===e.type.fontFace)return e.conf.viewErr&&console.log('Element of Type "'+e.type.names[this.e[k].indexElem.type]+'" is readonly.'),e.messages.push('Element of Type "'+
e.type.names[this.e[k].indexElem.type]+'" is readonly.'),this;if(this.e[k].children)w(null,this.e[k].children).set(a,h);else{var f=m.elemType(h);if("Object"===f||"Array"===f){var b=this.e[k].selector+("/"===a.charAt(0)?"":" ")+a.replace(/^\//,"");h="Object"===f?[h]:h;var l;for(l=0;l<h.length;l++)if(f=u(b,null,null,this.e[k].parent))r([f.content[f.content.length-1]],q).set(h[l]),this.e[k].obj[a]&&"push"in this.e[k].obj[a]||(this.e[k].obj[a]=[]),this.e[k].obj[a].push(f.content[f.content.length-1])}else if("Function"===
f){var q=this.pos(k).get(a);try{l=h(q),this.set(a,l,k),this.e[k].indexElem.style._update[a]=h}catch(G){e.conf.viewErr&&console.log(G),e.messages.push(G)}}else h=m.parseValue(h),this.e[k].indexElem.style[a]=h,this.e[k].obj[a]=h}}else{var p;k=m.elemType(a);"Object"===k?b=Object.keys(a).length:"Function"===k&&(p=a());if(0>=this.e.length&&!g&&"String"===m.elemType(c)){var n=[];if(d)for(n=[],l=0;l<d.length;l++){if(f=u(c,null,null,d[l].indexElem,d[l].children))for(q=0;q<f.content.length;q++)n.push(f.content[q])}else if(f=
u(c,null,null))n=f.content;this.e=n;this.eLength=n.length}if("Array"===k||"Function"===k&&"Array"===m.elemType(p))for(h="Array"===k?a:p,l=0;l<h.length;l++)if(a=this.pos(l),1===a.e.length)a.set(h[l]);else break;else for(l=0;l<this.e.length;l++)if("Object"===k&&0<b)for(q in a)this.set(q,a[q],l);else if("Function"===k){for(q in p)this.set(q,p[q],l);this.e[l].indexElem._update=a}else this.set(a,h,l)}return this};b.get=function(a,c){if(!a){a=this.export(e.export.type.object);for(b in a){if(f)return a;
var f=b}return a[f]}var b=[];f="";var h;c=!!c;for(h=0;h<this.e.length;h++){var d="";this.e[h].obj[a]&&!this.e[h].obj[a].selector&&(d=this.e[h].obj[a]);d&&""!==d||(d=this.e[h].indexElem.style[a]);d&&""!==d||(d=m.findPropInCssText(this.e[h].indexElem.cssText,a));d&&(f=d,c&&b.push(f))}return c?b:f};b.has=function(a){var f=[];var b=m.elemType(a);if("String"===b){var d=a.split(":");for(b=0;b<this.e.length;b++){var e=m.findPropInCssText(this.e[b].indexElem.cssText,d[0]);""!==e&&(!d[1]||d[1]&&d[1].replace(/ |;/g,
"")===e)&&f.push(this.e[b])}}else if("Array"===b)for(var g=0;g<a.length;g++)for(d=a[g].split(":"),b=0;b<this.e.length;b++)e=m.findPropInCssText(this.e[b].indexElem.cssText,d[0]),""!==e&&(!d[1]||d[1]&&d[1].replace(/ |;/g,"")===e)&&f.push(this.e[b]);else if("RegExp"===b)for(b=0;b<this.e.length;b++)if(d=this.e[b].indexElem.cssText.match(/[\S]+:.+?;/g))for(g=0;g<d.length;g++)(e=d[g].match(a))&&f.push(this.e[b]);return r(f,c,!0)};b.update=function(){var a,c;for(a=0;a<this.e.length;a++){if(!1!==this.e[a].indexElem._update){var b=
this.e[a].indexElem._update();for(c in b)this.set(c,b[c],a)}if(this.e[a].children)w(null,this.e[a].children).update();else for(c in this.e[a].indexElem.style._update)b=this.e[a].indexElem.style._update[c](),this.set(c,b,a)}return this};b.delete=function(a){var b;if("undefined"===typeof a)for(b=0;b<this.e.length;b++){this.e[b].indexElem.parentRule?this.e[b].indexElem.parentRule.deleteRule(this.e[b]):this.e[b].indexElem.parentStyleSheet.deleteRule(this.e[b]);var d=this.e[b].parent?this.e[b].parent:
null;d=d?d:v;d[c]&&delete d[c];this.e[b].children&&(d=w(null,this.e[b].children),d.delete(a))}else for(b=0;b<this.e.length;b++)this.e[b].indexElem.style[a]="",this.e[b].children&&(d=w(null,this.e[b].children),d.delete(a));return this};b.export=function(a,b){var c={},d,f,g,h=a;a===e.export.type.obj&&(a=e.export.type.object);if(a===e.export.type.normal||a===e.export.type.min)a=e.export.type.notMDObject;b||(b=[]);for(d=0;d<this.e.length;d++)if(!(0<=b.indexOf(this.e[d]))){var p=Object.assign({},this.e[d].obj);
for(g in this.e[d].obj)if("object"===typeof this.e[d].obj[g]&&"length"in this.e[d].obj[g])if(a===e.export.type.notMDObject)p[g]=null,delete p[g];else{p[g]=[];for(f=0;f<this.e[d].obj[g].length;f++){var n=r([this.e[d].obj[g][f]]);p[g][f]=n.export(a,b)[this.e[d].obj[g][f].selector];b.push(this.e[d].obj[g][f])}1===p[g].length&&(p[g]=p[g][0])}this.e[d].children?(p=w(null,this.e[d].children),c[this.e[d].selector]?("length"in c[this.e[d].selector]||(c[this.e[d].selector]=[c[this.e[d].selector]]),c[this.e[d].selector].push(p.export(a,
b))):c[this.e[d].selector]=p.export(a,b)):c[this.e[d].selector]?("length"in c[this.e[d].selector]||(c[this.e[d].selector]=[c[this.e[d].selector]]),c[this.e[d].selector].push(p)):c[this.e[d].selector]=p}return h===e.export.type.normal||h===e.export.type.min?m.cssTextFromObj(c,null,h):c};b.pos=function(a){return r(this.e[a]?[this.e[a]]:[])};b.first=function(){return this.pos(0)};b.last=function(){return this.pos(this.e.length-1)};return b},m={elemType:function(a,c){return c?Object.prototype.toString.call(a):
Object.prototype.toString.call(a).replace(/(^\[.+\s|\]$)/g,"")},createNewStyleElem:function(){if(document.getElementById(e.conf.styleId)){for(var a=0;10>a;a++)if(!document.getElementById(e.conf.styleId+"-"+a)){e.conf.styleId=e.conf.styleId+"-"+a;break}if(document.getElementById(e.conf.styleId))throw Error("cann not create new element..");}a=document.createElement("style");a.setAttribute("type","text/css");a.setAttribute("id",e.conf.styleId);a.appendChild(document.createTextNode(""));document.head.appendChild(a);
y=a},isElemInOwnNode:function(a){return a&&!!a.parentStyleSheet&&!!a.parentStyleSheet.ownerNode&&a.parentStyleSheet.ownerNode.id===e.conf.styleId},parseValue:function(a){if(isFinite(a))return 0===a%1?a+"px":Math.floor(100*a)/100+"px";if("String"===m.elemType(a)){var c=a.split(" ");if(0<c.length){for(var e=0;e<c.length;e++)isFinite(c[e])&&(a=c[e],c[e]=0===a%1?a+"px":Math.floor(100*a)/100+"px");return c.join(" ")}}return a},objFromCssText:function(a){var c=a.replace(/(^.*?{\s*|\s*}\s*$)/g,"");a=c.split(";");
var e={};if(""!==c)for(c=0;c<a.length;c++)if(""!==a[c]){var d=a[c].split(":");e[d[0].trim()]=d.slice(1).join(":").trim()}return e},cssTextFromObj:function(a,c,g){var d="",b;c=c||"";for(b in a){var f=m.elemType(a[b]);if("Object"===f){var h=m.cssTextFromObj(a[b],c+"    ",g);""!==h&&(d=g===e.export.type.min?d+(b+"{"+h+"}"):d+(c+b+" {\n"+h+c+"}\n"))}else if("Array"===f)for(f=0;f<a[b].length;f++)h=m.cssTextFromObj(a[b][f],c+"    ",g),""!==h&&(d=g===e.export.type.min?d+(b+"{"+h+"}"):d+(c+b+" {\n"+h+c+"}\n"));
else d=g===e.export.type.min?d+(b+":"+a[b]+";"):d+((4>c.length?"    ":c)+b+": "+a[b]+";\n")}return d},findPropInCssText:function(a,c){return(a=a.match(new RegExp(c+"s*:s*(.+?);")))?a[1].trim():""}};e=function(a,c){try{return C(a,c)}catch(g){e.conf.viewErr&&console.log(g),e.messages.push(g)}};e.import=function(a){try{return x(a)}catch(c){e.conf.viewErr&&console.log(c),e.messages.push(c)}};e.export=function(a){return C().export(a)};e.update=function(a){if(a)a=e(a),a.update();else for(var c in v)a=r(v[c].content),
a.update()};e.type={rule:1,charset:2,"import":3,media:4,fontFace:5,page:6,keyframes:7,keyframe:8,namespace:10,counterStyle:11,supports:12,fontFeatureValues:14,names:{1:"rule",2:"charset",3:"import",4:"media",5:"fontFace",6:"page",7:"keyframes",8:"keyframe",10:"namespace",11:"counterStyle",12:"supports",14:"fontFeatureValues"}};e.events={beforeChange:"beforechange",change:"change",beforeSet:"beforeset",set:"set",beforeCreate:"beforecreate",create:"create",beforeDelete:"beforedelete","delete":"delete",
beforeDestroy:"beforedestroy",destroy:"destroy"};e.export.type={normal:"css",min:"minCss",obj:"obj",object:"object",notMDObject:"objNMDO"};e.conf={styleId:"cssc-style",viewErr:!0};e.messages=[];H?B():window.addEventListener("load",function(){B()});return e}(document.styleSheets,!0)}();
