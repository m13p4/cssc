/*
@version 1.0b
@author m13p4
@copyright Meliantchenkov Pavel
*/
var _debug=!0,csscDebug={},CSSC=function(){var q;_debug&&(csscDebug.ownElem=q);var w=function(l,w){var p={},x=!1,f=null;_debug&&(csscDebug.index=p);var z=function(){if(!x){if("cssRules"in l){var a=(l.ownerNode.getAttribute("data-cssc-ignore")||"").toLowerCase();if("true"!==a&&"1"!==a)try{y(l.cssRules,null)}catch(d){f.conf.viewErr&&console.log('Cannot init CSS from "'+l.href+'"'),f.messages.push('Cannot init CSS from "'+l.href+'"')}}else if("length"in l)for(var b=0;b<l.length;b++)if(a=(l[b].ownerNode.getAttribute("data-cssc-ignore")||
"").toLowerCase(),"true"!==a&&"1"!==a)try{y(l[b].cssRules,null)}catch(d){f.conf.viewErr&&console.log('Cannot init CSS from "'+l[b].href+'"'),f.messages.push('Cannot init CSS from "'+l[b].href+'"')}x=!0}},y=function(a,b){for(var d=0;d<a.length;d++)m.isElemInOwnNode(a[d])||B(a[d],b)},B=function(a,b){var d=a.cssText.substr(0,a.cssText.indexOf("{")).trim(),c=a.type,e=b?b.children:p;if(c!==f.ruleType.rule&&c!==f.ruleType.fontFace&&c!==f.ruleType.media&&c!==f.ruleType.keyframes&&c!==f.ruleType.keyframe&&
c!==f.ruleType.page&&c!==f.ruleType.supports)console.log("unsuported type: ["+c+"] - "+f.ruleType.names[c]);else return a._update=!1,c===f.ruleType.rule&&(a.style._update={}),b={indexElem:a,selector:d,children:!1,parent:b?b:!1,events:{},obj:{},type:c},e[d]?(e[d].content[0].indexElem===a&&(console.log('Dublicate "'+d+'": '),console.log(Error().stack+"\n\n")),b=e[d].content.push(b)-1):(e[d]={type:c,content:[b],events:{}},b=0),c===f.ruleType.media||c===f.ruleType.keyframes||c===f.ruleType.supports?(e[d].content[b].children=
{},y(a.cssRules,e[d].content[b])):e[d].content[b].obj=m.objFromCssText(a.cssText),e[d]},u=function(a,b,d,c){c||q||m.createNewStyleElem();var e=c?c.indexElem:q.sheet;var g=e.cssRules.length,h="";if(b){var k=m.elemType(b);if("Object"===k)for(var t in b)"Function"===m.elemType(b[t])?(d=b[t](),h+=t+":"+d+"; "):h+=t+":"+b[t]+"; ";else if("Function"===k)for(t in d=b(),d)h+=t+":"+d[t]+"; ";else h=b+":"+d+";"}try{return"insertRule"in e?e.insertRule(a+"{"+h+"}",g):"appendRule"in e?e.appendRule(a+"{"+h+"}",
g):"addRule"in e&&e.addRule(a,h,g),B(e.cssRules[g],c)}catch(C){f.conf.viewErr&&console.log('"'+a+'" -> '+C),f.messages.push('"'+a+'" -> '+C)}return!1},D=function(a,b){x||z();b=b?b:p;return b[a]?b[a]:null},v=function(a,b,d){b=b?b:p;var c=m.elemType(a);if("String"===c)return b=D(a,b),d?b?b.content:[]:r(b?b.content:[],a);if("RegExp"===c){c=[];for(var e in b)if(e.match(a))for(g=0;g<b[e].content.length;g++)c.push(b[e].content[g]);return d?c:r(c,a)}if("Array"===c){c=[];var g;for(g=0;g<a.length;g++){var h=
D(a[g],b);if(null!==h)for(e=0;e<h.content.length;e++)c.push(h.content[e])}return d?c:r(c,a)}if("Null"===c||"Undefined"===c){c=[];for(e in b)for(g=0;g<b[e].content.length;g++)c.push(b[e].content[g]);return d?c:r(c,a)}return null},E=function(a,b,d,c){var e=m.elemType(a);if("String"===e||"RegExp"===e||"Array"===e||"Null"===e||"Undefined"===e)return a=v(a,d,c),b?a.has(b):a;A(a,null,d)},A=function(a,b){var d,c,e;for(c in a){var g="Array"===m.elemType(a[c])?a[c]:[a[c]];for(e=0;e<g.length;e++)if("@font-face"===
c)u(c,g[e],null,b);else if(c.match(/^@(media|keyframes|supports)/)){if(d=u(c,null,null,b)){var h=d.content.length-1;A(g[e],d.content[h])}}else if(d=u(c,null,null,b))d=r([d.content[d.content.length-1]],c),d.set(g[e])}},r=function(a,b,d,c){var e=function(a,b){var g,d,c=[];for(g=0;g<e.e.length;g++)if(e.e[g].children){var h=E(a,b,e.e[g].children,!0);for(d=0;d<h.length;d++)c.push(h[d])}return r(c,a,null,e.e)};e.e=a;e.eLength=a.length;e.set=function(a,h,k){if("number"===typeof k){if(this.e[k].indexElem.type===
f.ruleType.fontFace)return f.conf.viewErr&&console.log('Element of Type "'+f.ruleType.names[this.e[k].indexElem.type]+'" is readonly.'),f.messages.push('Element of Type "'+f.ruleType.names[this.e[k].indexElem.type]+'" is readonly.'),this;if(this.e[k].children)v(null,this.e[k].children).set(a,h);else if(a.match(/^:.+/))(k=u(this.e[k].selector+a,null,null,this.e[k].parent))&&r(k.content,l).set(h);else if("Function"===m.elemType(h)){var g=m.findPropInCssText(this.e[k].indexElem.cssText,a);try{var e=
h(g);var n=m.parseValue(e);this.e[k].indexElem.style[a]=n;this.e[k].obj[a]=n;this.e[k].indexElem.style._update[a]=h}catch(F){f.conf.viewErr&&console.log(F),f.messages.push(F)}}else n=m.parseValue(h),this.e[k].indexElem.style[a]=n,this.e[k].obj[a]=n}else{var l,p;e=m.elemType(a);"Object"===e?g=Object.keys(a).length:"Function"===e&&(p=a());if(0>=this.e.length&&!d&&"String"===m.elemType(b)){var q=[];if(c)for(q=[],n=0;n<c.length;n++){if(k=u(b,null,null,c[n].indexElem,c[n].children))for(l=0;l<k.content.length;l++)q.push(k.content[l])}else if(k=
u(b,null,null))q=k.content;this.e=q;this.eLength=q.length}for(n=0;n<this.e.length;n++)if("Object"===e&&0<g)for(l in a)this.set(l,a[l],n);else if("Function"===e){for(l in p)this.set(l,p[l],n);this.e[n].indexElem._update=a}else this.set(a,h,n)}return this};e.get=function(a,b){var d=[],c="",e,g;b=!!b;for(g=0;g<this.e.length;g++)(e=this.e[g].indexElem.style[a])&&""!==e||(e=m.findPropInCssText(this.e[g].indexElem.cssText,a)),e&&(c=e,b&&d.push(c));return b?d:c};e.has=function(a){var d=[];var c=m.elemType(a);
if("String"===c){var e=a.split(":");for(c=0;c<this.e.length;c++){var g=m.findPropInCssText(this.e[c].indexElem.cssText,e[0]);""!==g&&(!e[1]||e[1]&&e[1].replace(/ |;/g,"")===g)&&d.push(this.e[c])}}else if("Array"===c)for(var f=0;f<a.length;f++)for(e=a[f].split(":"),c=0;c<this.e.length;c++)g=m.findPropInCssText(this.e[c].indexElem.cssText,e[0]),""!==g&&(!e[1]||e[1]&&e[1].replace(/ |;/g,"")===g)&&d.push(this.e[c]);else if("RegExp"===c)for(c=0;c<this.e.length;c++)if(e=this.e[c].indexElem.cssText.match(/[\S]+:.+?;/g))for(f=
0;f<e.length;f++)(g=e[f].match(a))&&d.push(this.e[c]);return r(d,b,!0)};e.update=function(){var a,b;for(a=0;a<this.e.length;a++){if(!1!==this.e[a].indexElem._update){var c=this.e[a].indexElem._update();for(b in c)this.set(b,c[b],a)}if(this.e[a].children)v(null,this.e[a].children).update();else for(b in this.e[a].indexElem.style._update)c=this.e[a].indexElem.style._update[b](),this.set(b,c,a)}return this};e.delete=function(a){var c;if("undefined"===typeof a)for(c=0;c<this.e.length;c++){this.e[c].indexElem.parentRule?
this.e[c].indexElem.parentRule.deleteRule(this.e[c]):this.e[c].indexElem.parentStyleSheet.deleteRule(this.e[c]);var d=this.e[c].parent?this.e[c].parent:null;d=d?d:p;d[b]&&delete d[b];this.e[c].children&&(d=v(null,this.e[c].children),d.delete(a))}else for(c=0;c<this.e.length;c++)this.e[c].indexElem.style[a]="",this.e[c].children&&(d=v(null,this.e[c].children),d.delete(a));return this};e.export=function(a){var c="",b;for(b=0;b<this.e.length;b++)c+=m.exportParser(this.e[b].indexElem.cssText,a);return c.trim()};
return e},m={elemType:function(a,b){return b?Object.prototype.toString.call(a):Object.prototype.toString.call(a).replace(/(^\[.+\s|\]$)/g,"")},createNewStyleElem:function(){if(document.getElementById(f.conf.styleId)){for(var a=0;10>a;a++)if(!document.getElementById(f.conf.styleId+"-"+a)){f.conf.styleId=f.conf.styleId+"-"+a;break}if(document.getElementById(f.conf.styleId))throw Error("cann not create new element..");}a=document.createElement("style");a.setAttribute("type","text/css");a.setAttribute("id",
f.conf.styleId);a.appendChild(document.createTextNode(""));document.head.appendChild(a);q=a;_debug&&(csscDebug.ownElem=q)},isElemInOwnNode:function(a){return a&&!!a.parentStyleSheet&&!!a.parentStyleSheet.ownerNode&&a.parentStyleSheet.ownerNode.id===f.conf.styleId},parseValue:function(a){if(isFinite(a))return 0===a%1?a+"px":Math.floor(100*a)/100+"px";var b=a.split(" ");if(0<b.length){for(var d=0;d<b.length;d++)isFinite(b[d])&&(a=b[d],b[d]=0===a%1?a+"px":Math.floor(100*a)/100+"px");return b.join(" ")}return a},
objFromCssText:function(a){var b=a.replace(/(^.*?{\s*|\s*}\s*$)/g,"");a=b.split(";");var d={};if(""!==b)for(b=0;b<a.length;b++)if(""!==a[b]){var c=a[b].split(":");c[0].trim();d[c[0].trim()]=c.slice(1).join(":").trim()}return d},findPropInCssText:function(a,b){return(a=a.match(new RegExp(b+"s*:s*(.+?);")))?a[1].trim():""},exportParser:function(a,b){return b===f.export.type.ruleRow?a.replace(/\n/g,"")+"\n":b===f.export.type.min?a.replace(/(;|:|\s*?{|}|,)\s+/g,function(a){return a.trim()}):a.match(/^@(media|keyframes|supports)/)?
a.replace(/^(.*){([\s\S]*)}$/,function(a,c,b){return c+"\n{\n    "+b.trim().replace(/({|}|;)\s*/g,function(a){a=a.trim();if("{"===a)return"\n    {\n        ";if("}"===a)return"}\n    ";if(";"===a)return";\n        "}).replace(/\s+}/g,"\n    }").trim()+"\n}\n"}):a.replace(/({|}|;)\s*/g,function(a){a=a.trim();if("{"===a)return"\n"+a+"\n    ";if("}"===a)return a+"\n";if(";"===a)return a+"\n    "}).replace(/\s+}/,"\n}")}};f=function(a,b){try{return E(a,b)}catch(d){f.conf.viewErr&&console.log(d),f.messages.push(d)}};
f.import=function(a){try{return A(a)}catch(b){f.conf.viewErr&&console.log(b),f.messages.push(b)}};f.export=function(a){var b="",d,c;for(d in p)for(c=0;c<p[d].content.length;c++)b+=m.exportParser(p[d].content[c].indexElem.cssText,a);return b.trim()};f.update=function(a){if(a)a=f(a),a.update();else for(var b in p)a=r(p[b].content),a.update()};f.ruleType={rule:1,charset:2,"import":3,media:4,fontFace:5,page:6,keyframes:7,keyframe:8,namespace:10,counterStyle:11,supports:12,fontFeatureValues:14,names:{1:"rule",
2:"charset",3:"import",4:"media",5:"fontFace",6:"page",7:"keyframes",8:"keyframe",10:"namespace",11:"counterStyle",12:"supports",14:"fontFeatureValues"}};f.events={beforeChange:"beforechange",change:"change",beforeSet:"beforeset",set:"set",beforeCreate:"beforecreate",create:"create",beforeDelete:"beforedelete","delete":"delete",beforeDestroy:"beforedestroy",destroy:"destroy"};f.export.type={normal:"normal",ruleRow:"ruleRow",min:"min"};f.conf={styleId:"cssc-style",viewErr:!0};f.messages=[];w?z():window.addEventListener("load",
function(){z()});return f};_debug&&(csscDebug.cntrl=w);return w(document.styleSheets,!0)}();
