/* CSSC.js | @version 1.0b |  m13p4 */
var CSSC=function(){function p(c,a,b){if(b)return Object.prototype.toString.call(c);c=Object.prototype.toString.call(c).replace(/(^\[.+\s|\]$)/g,"");return a?c.substr(0,a):c}function E(){if(Object.assign)return Object.assign.apply(null,arguments);var c={},a,b;for(b=0;b<arguments.length;b++)for(a in arguments[b])c[a]=arguments[b][a];return c}function J(c){if(c.match(/^@(namespace|import|charset)/))return c.replace(/(^@(namespace|import|charset)\s*|\s*;\s*$)/g,"");var a=c.replace(/(^.*?{\s*|\s*}\s*$)/g,
"");c=a.split(";");var b={};if(""!==a)for(a=0;a<c.length;a++)if(""!==c[a]){var d=c[a].split(":");b[d[0].trim()]=d.slice(1).join(":").trim()}return b}function x(c,a,b,d,f){var e="",g=Array((parseInt(b)||2)+1).join(" "),h,k=p(c,1);d=d||"";if("S"===k)return c;if("A"===k)for(k=0;k<c.length;k++)e+=x(c[k],a,b,d,!0);else for(h in c){var l=c[h];k=p(c[h],1);if("O"===k||"A"===k)if(f&&"A"===k){var m=x(c[h],a,b,d+g,f);""!==m&&(e=a?e+(h.replace(/\s*(,|:)\s*/g,"$1")+"{"+m+"}"):e+(d+h.replace(/\s*,\s*/g,",\n"+d)+
" {\n"+m+d+"}\n"))}else for("O"===k&&(l=[c[h]]),k=0;k<l.length;k++)"@namespace"===h||"@import"===h||"@charset"===h?e+=h+" "+l[k]+";"+(a?"":"\n"):(m=x(l[k],a,b,d+g,f),""!==m&&(e=a?e+(h.replace(/\s*(,|:)\s*/g,"$1")+"{"+m+"}"):e+(d+h.replace(/\s*,\s*/g,",\n"+d)+" {\n"+m+d+"}\n")));else e="@namespace"===h||"@import"===h||"@charset"===h?e+(h+" "+l+";"+(a?"":"\n")):a?e+(h+":"+l.trim().replace(/\s*,\s*/g,",")+";"):e+((d.length<g.length?g:d)+h+": "+l+";\n")}return e}function F(c,a){"@"===a.charAt(0)&&"@"===
c.charAt(0)&&(a=a.substr(1));a="/"===a.charAt(0)?a.substr(1):","===a.charAt(0)?", "+a.substr(1).trim():" "+a;if(0<=c.indexOf(",")||0<a.indexOf(",")){c=c.split(",");var b,d="",f=a.split(",");if(","!==a.charAt(0))for(b=0;b<c.length;b++)for(a=0;a<f.length;a++)d+=c[b]+f[a]+", ";else for(b=0;b<c.length;b++)d+=c[b]+a+", ";return d.replace(/,+\s*$/,"")}return c+a}function K(c){var a=c.parentRule?c.parentRule:c.parentStyleSheet,b;for(b=0;b<a.cssRules.length;b++)a.cssRules[b]===c&&a.deleteRule(b)}function G(c,
a){a?"A"!==p(a,1)&&(a=[a]):a=[{}];c||(c="");for(var b=c.lastIndexOf("$"),d,f=0,e,g,h,k,l,m;0<=b&&100>f;){f++;e=null;k=c.substr(b+1);d=k.search(/[^\w\.]/);d=0>d?c.length:d+b;l=c.substr(b+1,d-b);m=l.split(".");for(g=0;g<m.length;g++)if(!(1>m[g].length)){h=typeof e;if(0===g)for(h=a.length-1;0<=h;h--){if(m[g]in a[h]){e=a[h][m[g]];break}}else if(null!==e&&"object"===h&&m[g]in e)e=e[m[g]];else if("string"===h&&m[g].match(/^[0-9]+$/))e=e.charAt(m[g]);else{e="$"+l;break}if("function"===typeof e){if("("===
c.charAt(d+1)){d++;h=k=d;do h=c.indexOf("(",h+1),d=c.indexOf(")",d+1);while(-1<h&&h<d);0>d&&(d=c.length);k=c.substr(k+1,d-k-1);k=k.trim().split(/\s*,\s*/);e=e.apply(null,k)}else e=e();if("."===c.charAt(d+1))for(d++,h=d,k=c.substr(d+1),d=k.search(/[^\w\.]/),k=k.substr(0,0>d?k.length:d),d=0>d?c.length:d+h,l=c.substr(b+1,d-b),k=k.split("."),h=0;h<k.length;h++)m.push(k[h])}}c=c.substr(0,b)+e+c.substr(d+1);d="$"+l===e?b:d+(e.length-1);if(0>--d)break;b=c.lastIndexOf("$",d)}return c}function L(c,a){var b;
if(Object.defineProperty)for(b in a)Object.defineProperty(c,b,{enumerable:!0,value:a[b]});else for(b in a)c[b]=a[b]}function H(c){if(Object.freeze)return Object.freeze(c);if(Object.defineProperty){var a={},b;for(b in c)Object.defineProperty(a,b,{enumerable:!0,value:c[b]});c=a}Object.preventExtensions&&Object.preventExtensions(c);return c}function M(c,a,b){for(var d=0;d<a.length;d++)a[d]&&a[d].parentStyleSheet&&a[d].parentStyleSheet.ownerNode&&a[d].parentStyleSheet.ownerNode.id===c[4].styleId&&C(c,
a[d],b)}function C(c,a,b,d){var f=a.cssText.substr(0,a.cssText.indexOf("{")).trim(),e=a.type,g=b?b.children:c[0];if(1!==e&&5!==e&&4!==e&&7!==e&&8!==e&&6!==e&&12!==e&&10!==e&&3!==e&&2!==e)console.log("unsuported type: "+e);else return 10===e&&(f="@namespace"),3===e&&(f="@import"),2===e&&(f="@charset"),a._update=!1,1===e&&(a.style._update={}),c[2]++,c={indexElem:a,selector:f,csscSelector:d?d:f,children:!1,parent:b?b:!1,events:{},obj:{},type:e,p:c[2]},g[f]?(g[f].content[0].indexElem===a&&(console.log('Dublicate "'+
f+'": '),console.log(Error().stack+"\n\n")),c=g[f].content.push(c)-1):(g[f]={type:e,content:[c],events:{}},c=0),4===e||7===e||12===e?(g[f].content[c].children={},M(a.cssRules,g[f].content[c])):g[f].content[c].obj=J(a.cssText),g[f]}function t(c,a,b,d,f){if(!f&&!c[1]){var e=c[4];if(document.getElementById(e.styleId)){for(var g=0;10>g;g++)if(!document.getElementById(e.styleId+"-"+g)){e.styleId=e.styleId+"-"+g;break}if(document.getElementById(e.styleId))throw Error("cann not create new element..");}g=
document.createElement("style");g.setAttribute("type","text/css");g.setAttribute("id",e.styleId);g.appendChild(document.createTextNode(""));document.head.appendChild(g);c[1]=g}e=f?f.indexElem:c[1].sheet;g=e.cssRules.length;var h="";if(b){var k=p(b,1);if("O"===k)for(var l in b)"F"===p(b[l],1)?(d=b[l](),h+=l+":"+d+"; "):h+=l+":"+b[l]+"; ";else if("F"===k)for(l in d=b(),d)h+=l+":"+d[l]+"; ";else h=b+":"+d+";"}try{d=a+"{"+h+"}";if("@namespace"===a||"@import"===a||"@charset"===a)d=a+" "+b;return"@charset"!==
a?("insertRule"in e?e.insertRule(d,g):"appendRule"in e?e.appendRule(d,g):"addRule"in e&&e.addRule(a,h,g),C(c,e.cssRules[g],f,a)):C(c,{csscSelector:a,cssText:d,parent:!1,type:2,cssRules:{}},f,l)}catch(m){a=(f?'"'+f.selector+'" > ':"")+'"'+a+'" -> '+m,c[4].viewErr&&console.log(a),v.push(a)}return!1}function N(c,a,b){if(c&&c[a]){var d=b?c[a].content.indexOf(b):-1;b?0<=d&&(c[a].content.splice(d,1),0>=c[a].content.length&&delete c[a]):delete c[a]}}function w(c,a,b){var d=p(a,1),f="A"===p(c,1)?c[0]:c;if("S"===
d)return b?f[a]?f[a]:[]:u(c,f[a]?f[a]:[],a);if("R"===d){d=[];for(var e in f)if(e.match(a))for(g=0;g<f[e].content.length;g++)d.push(f[e].content[g]);return b?d:u(c,d,a)}if("A"===d){d=[];var g;for(g=0;g<a.length;g++)if(f[a])for(e=0;e<f[a].content.length;e++)d.push(f[a].content[e]);return b?d:u(c,d,a)}if("N"===d||"U"===d){d=[];for(e in f)for(g=0;g<f[e].content.length;g++)d.push(f[e].content[g]);return b?d:u(c,d,a)}return null}function y(c,a,b){var d=p(a,1);return"S"===d||"R"===d||"A"===d||"N"===d||"U"===
d?w(c,a,b):z(c,a)}function z(c,a,b,d){var f,e={};d||b||("@charset"in a&&(e["@charset"]=a["@charset"]),"@import"in a&&(e["@import"]=a["@import"]),"@namespace"in a&&(e["@namespace"]=a["@namespace"]),"@font-face"in a&&(e["@font-face"]=a["@font-face"]),0<Object.keys(e).length&&z(c,e,b,!0));for(g in a)if(!(g in e)){d="A"===p(a[g],1)?a[g]:[a[g]];var g=G(g,c[3]);for(f=0;f<d.length;f++)if("@"===g.charAt(0))if("@font-face"===g||"@namespace"===g||"@import"===g||"@charset"===g)t(c,g,d[f],null,b);else{if(g.match(/^@(media|keyframes|supports)/)||
b&&(4===b.type||7===b.type||12===b.type)){var h=b;var k=g;b&&!k.match(/^@(media|keyframes|supports)/)&&(g=F(b.csscSelector,g),h=b.parent);var l=t(c,g,null,null,h);var m=(l?l.content.length:0)-1;if(-1<m&&l.content[m].selector===l.content[m].csscSelector)z(c,d[f],l.content[m]);else{-1<m&&(K(l.content[m].indexElem),N(l.content[m].parent?l.content[m].parent:c,l.content[m].selector,l.content[m]));l=g;m=g+" {}";h=h||!1;var n=g;n=n.trim();if("@"!==n.charAt(0))var q=1;else{n=n.substr(1);q=n.indexOf(" ");
0<=q&&(n=n.substr(0,q));q=n;if(0<=n.indexOf("-")){var D=n.split("-");q=D[0];for(n=1;n<D.length;n++)q+=D[n].charAt(0).toUpperCase()+D[n].substr(1)}q=q in I?I[q]:-1}h={csscSelector:l,cssText:m,parent:h,type:q,cssRules:{}};l=C(c,h,h.parent,g);z(c,d[f],l.content[l.content.length-1])}b&&(b.obj[k]||(b.obj[k]=[]),b.obj[k].push(l.content[l.content.length-1]))}}else(l=t(c,g,null,null,b))&&r(c,[l.content[l.content.length-1]],d[f])}}function r(c,a,b,d,f){if("number"===typeof f)if(5===a[f].indexElem.type)c[4].viewErr&&
console.log("@font-face rules are readonly."),v.push("@font-face rules are readonly.");else if(b=G(b,c[3]),a[f].children)w(a[f].children).set(b,d);else{var e=p(d,1);if("O"===e||"A"===e){var g="@"===b.charAt(0),h;e="O"===e?[d]:d;var k,l=F(a[f].selector,b);g&&(l=a[f].parent?F(a[f].parent.selector,b):b);for(k=0;k<e.length;k++)if(h=t(c,l,null,null,g?!1:a[f].parent)){var m=h.content.length-1;g&&(d=h,(h=t(c,a[f].selector,null,null,h.content[m]))?m=h.content.length-1:h=d);d=h.content[m];r(c,[d],e[k]);g&&
a[f].parent&&(h=a[f].parent,h.obj[b]&&"push"in h.obj[b]||(h.obj[b]=[]),h.obj[b].push(d.parent));a[f].obj[b]&&"push"in a[f].obj[b]||(a[f].obj[b]=[]);a[f].obj[b].push(d)}}else if("F"===e){g=A(c,a,f).get(b);try{k=d(g),r(c,a,b,k,f),a[f].indexElem.style._update[b]=d}catch(n){c[4].viewErr&&console.log(n),v.push(n)}}else{a:if(isFinite(d))c=0===d%1?d+"px":Math.floor(100*d)/100+"px";else{if("S"===p(d,1)&&(c=d.split(" "),0<c.length)){for(d=0;d<c.length;d++)isFinite(c[d])&&(k=c[d],c[d]=0===k%1?k+"px":Math.floor(100*
k)/100+"px");c=c.join(" ");break a}c=d}a[f].indexElem.style[b]=c;a[f].obj[b]=c}}else if(f=p(b,1),"O"===f?g=Object.keys(b).length:"F"===f&&(l=b()),"A"===f||"F"===f&&"A"===p(l,1))for(f="A"===f?b:l,k=0;k<f.length;k++)if(b=A(c,a,k),1===b.e.length)b.set(f[k]);else break;else for(k=0;k<a.length;k++)if("O"===f&&0<g)for(e in b)r(c,a,e,b[e],k);else if("F"===f){for(e in l)r(c,a,e,l[e],k);a[k].indexElem._update=b}else r(c,a,b,d,k)}function B(c,a,b,d){var f={},e,g,h,k=b;"obj"===b&&(b="object");if("css"===b||
"minCss"===b)b="array";d||(d=[]);for(e=0;e<a.length;e++)if(!(0<=d.indexOf(a[e]))){if(10===a[e].type||3===a[e].type||2===a[e].type)var l=a[e].obj;else for(h in l=E({},a[e].obj),a[e].obj)if("object"===typeof a[e].obj[h]&&"length"in a[e].obj[h])if("objNMD"===b||"array"===b)l[h]=null,delete l[h];else{l[h]=[];for(g=0;g<a[e].obj[h].length;g++)if(!(0<=d.indexOf(a[e].obj[h][g]))){var m=B(c,[a[e].obj[h][g]],b,d)[a[e].obj[h][g].selector];d.push(a[e].obj[h][g]);!m||0>=Object.keys(m).length||(l[h][g]=m)}0===
l[h].length?delete l[h]:1===l[h].length&&(l[h]=l[h][0])}a[e].children&&(m=w(a[e].children),l=E(m.export(b,d),l));0>=Object.keys(l).length||("array"===b?(f[a[e].p]={},f[a[e].p][a[e].selector]=l):f[a[e].selector]?("object"===typeof f[a[e].selector]&&"length"in f[a[e].selector]||(f[a[e].selector]=[f[a[e].selector]]),f[a[e].selector].push(l)):f[a[e].selector]=l,d.push(a[e]))}if("array"===b)return f=Object.values(f),b===k?f:x(f,"minCss"===k,c[4].tabLen);c={};f["@charset"]&&(c["@charset"]=f["@charset"]);
f["@import"]&&(c["@import"]=f["@import"]);f["@namespace"]&&(c["@namespace"]=f["@namespace"]);f["@font-face"]&&(c["@font-face"]=f["@font-face"]);if(m=0<Object.keys(c).length)for(e in f)c[e]||(c[e]=f[e]);return m?c:f}function A(c,a,b,d,f){0>b&&(b+=a.length);return a[b]?u(c,[a[b]],d,!1,a[b].parent?a[b].parent:!1):u(c,[],d,!1,f)}function O(c){for(var a=[],b=0;b<c.length;b++)c[b].indexElem&&a.push(c[b].indexElem);return a}function u(c,a,b,d,f){function e(){if(0>=a.length&&!d&&"S"===p(b,1)){var c,e=[],
l,m;if(f)for(l=0;l<f.length;l++){if(c=t(b,null,null,f[l]))for(m=0;m<c.content.length;m++)e.push(c.content[m])}else if(c=t(b,null,null))e=c.content;a=e;g.e=O(a);g.selector=1===a.length?a[0].selector:b}}var g=function(b){var d,f,h=[];e();for(d=0;d<a.length;d++)if(a[d].children){var g=y(a[d].children,b,!0);for(f=0;f<g.length;f++)h.push(g[f])}return u(c,h,b,null,a)};g.e=O(a);g.selector=1===a.length?a[0].selector:b;L(g,{set:function(b,d,f){e();r(c,a,b,d,f);return this},get:function(b,d){var e=a;if(b){var f=
[],h="",g;d=!!d;for(g=0;g<e.length;g++){var k="";e[g].obj[b]&&(k=e[g].obj[b],"A"===p(k,1)&&(k=B(c,k,"object")));k&&""!==k||(k=e[g].indexElem.style[b]);k&&""!==k||(k=(k=e[g].indexElem.cssText.match(new RegExp(b+"s*:s*(.+?);")))?k[1].trim():"");k&&(h=k,d&&f.push(h))}b=d?f:h}else b=B(c,e,"object");return b},update:function(){var b=a,c,d;for(c=0;c<b.length;c++){if(!1!==b[c].indexElem._update){var e=b[c].indexElem._update();for(d in e)r(d,e[d],c)}if(b[c].children)w(b[c].children).update();else if(b[c].indexElem.style)for(d in b[c].indexElem.style._update)r(d,
b[c].indexElem.style._update[d](),c)}return this},"delete":function(b){var d=a,e;if("undefined"===typeof b)for(e=0;e<d.length;e++)d[e].children&&w(d[e].children).delete(b),K(d[e].indexElem),N(d[e].parent?d[e].parent:c,d[e].selector,d[e]);else for(e=0;e<d.length;e++)d[e].indexElem.style[b]="",d[e].children&&w(d[e].children).delete(b);return this},"export":function(b){return B(c,a,b)},parse:function(b){return B(c,a,b?"minCss":"css")},pos:function(d){return A(c,a,d,b,f)},first:function(){return A(c,
a,0,b,f)},last:function(){return A(c,a,-1,b,f)}});return g}function P(){var c=[{},!1,0,[],{}],a=function(b){try{return y(c,b)}catch(d){c[4].viewErr&&console.log(d),v.push(d)}};L(a,{version:"1.0b",init:function(b){b="length"in b?b:[b];for(var a=0;a<b.length;a++)if("sheet"in b[a]&&(b[a]=b[a].sheet),"cssRules"in b[a]){var f=(b[a].ownerNode.getAttribute("data-cssc-ignore")||"").toLowerCase();if("true"!==f&&"1"!==f)try{M(c,b[a].cssRules,null)}catch(e){c[4].viewErr&&console.log('Cannot init CSS from "'+
b[a].href+'"'),v.push('Cannot init CSS from "'+b[a].href+'"')}}},"import":function(b){return z(c,b)},"export":function(b){return y(c).export(b)},parse:function(b){return y(c).parse(b)},update:function(b){return y(c,b).update()},"new":function(){return P()},defineVars:function(b){c[3]=[b];return this},addVars:function(b){c[3].push(b);return this},getVars:function(){return c[3]},defineConf:function(b){c[4]=E(c[4],b);return this},setConf:function(b,a){c[4][b]=a;return this},getConf:function(b){return b?
c[4][b]:c[4]},parseVars:function(b,a){return G(b,a?a:c[3])},objFromCss:function(a){return J(a)},cssFromObj:function(a,c,f){return x(a,c,f)},_conf:Q,type:I,exportType:R,messages:v});a.defineConf(Q);return a}var I=H({rule:1,charset:2,"import":3,media:4,fontFace:5,page:6,keyframes:7,keyframe:8,namespace:10,counterStyle:11,supports:12,fontFeatureValues:14,viewport:15}),R=H({normal:"css",min:"minCss",obj:"obj",object:"object",notMDObject:"objNMD",array:"array"}),Q=H({styleId:"cssc-style",viewErr:!0,tabLen:2}),
v=[];return P()}();
