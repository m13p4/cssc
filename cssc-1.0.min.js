/*
@version 1.0b
@author m13p4
@copyright Meliantchenkov Pavel
*/
var CSSC=function(){var y;return function(m,M){var u={},z=!1,k=null,r=function(b,a){return a?Object.prototype.toString.call(b):Object.prototype.toString.call(b).replace(/(^\[.+\s|\]$)/g,"")},G=function(b,a,e){var h="",c;a=a||"";for(c in b){var f=b[c];var d=r(b[c]);if("Object"===d||"Array"===d)for("Object"===d&&(f=[b[c]]),d=0;d<f.length;d++){var g=G(f[d],a+"  ",e);""!==g&&(h=e===k.export.type.min?h+(c+"{"+g+"}"):h+(a+c.replace(/\s*,\s*/g,",\n"+a)+" {\n"+g+a+"}\n"))}else h=e===k.export.type.min?h+(c+
":"+f+";"):h+((2>a.length?"  ":a)+c+": "+f+";\n")}return h},A=function(b,a){return(b=b.match(new RegExp(a+"s*:s*(.+?);")))?b[1].trim():""},H=function(b,a){"@"===a.charAt(0)&&"@"===b.charAt(0)&&(a=a.substr(1));a="/"===a.charAt(0)?a.substr(1):","===a.charAt(0)?", "+a.substr(1).trim():" "+a;if(0<=b.indexOf(",")||0<a.indexOf(",")){b=b.split(",");var e,h="",c=a.split(",");if(","!==a.charAt(0))for(e=0;e<b.length;e++)for(a=0;a<c.length;a++)h+=b[e]+c[a]+", ";else for(e=0;e<b.length;e++)h+=b[e]+a+", ";return h.replace(/,+\s*$/,
"")}return b+a},I=function(b){var a=b.parentRule?b.parentRule:b.parentStyleSheet,e;for(e=0;e<a.cssRules.length;e++)a.cssRules[e]===b&&a.deleteRule(e)},C=function(){if(!z){if("cssRules"in m){var b=(m.ownerNode.getAttribute("data-cssc-ignore")||"").toLowerCase();if("true"!==b&&"1"!==b)try{B(m.cssRules,null)}catch(e){k.conf.viewErr&&console.log('Cannot init CSS from "'+m.href+'"'),k.messages.push('Cannot init CSS from "'+m.href+'"')}}else if("length"in m)for(var a=0;a<m.length;a++)if(b=(m[a].ownerNode.getAttribute("data-cssc-ignore")||
"").toLowerCase(),"true"!==b&&"1"!==b)try{B(m[a].cssRules,null)}catch(e){k.conf.viewErr&&console.log('Cannot init CSS from "'+m[a].href+'"'),k.messages.push('Cannot init CSS from "'+m[a].href+'"')}z=!0}},B=function(b,a){for(var e=0;e<b.length;e++){var h=b[e];h&&h.parentStyleSheet&&h.parentStyleSheet.ownerNode&&h.parentStyleSheet.ownerNode.id===k.conf.styleId||D(b[e],a)}},D=function(b,a,e){var h=b.cssText.substr(0,b.cssText.indexOf("{")).trim(),c=b.type,f=a?a.children:u;if(c!==k.type.rule&&c!==k.type.fontFace&&
c!==k.type.media&&c!==k.type.keyframes&&c!==k.type.keyframe&&c!==k.type.page&&c!==k.type.supports)console.log("unsuported type: ["+c+"] - "+k.type.names[c]);else{b._update=!1;c===k.type.rule&&(b.style._update={});a={indexElem:b,selector:h,csscSelector:e?e:h,children:!1,parent:a?a:!1,events:{},obj:{},type:c};f[h]?(f[h].content[0].indexElem===b&&(console.log('Dublicate "'+h+'": '),console.log(Error().stack+"\n\n")),a=f[h].content.push(a)-1):(f[h]={type:c,content:[a],events:{}},a=0);if(c===k.type.media||
c===k.type.keyframes||c===k.type.supports)f[h].content[a].children={},B(b.cssRules,f[h].content[a]);else{c=f[h].content[a];e=b.cssText.replace(/(^.*?{\s*|\s*}\s*$)/g,"");b=e.split(";");a={};if(""!==e)for(e=0;e<b.length;e++)if(""!==b[e]){var d=b[e].split(":");a[d[0].trim()]=d.slice(1).join(":").trim()}c.obj=a}return f[h]}},v=function(b,a,e,h){var c;if(!h&&!y){if(document.getElementById(k.conf.styleId)){for(c=0;10>c;c++)if(!document.getElementById(k.conf.styleId+"-"+c)){k.conf.styleId=k.conf.styleId+
"-"+c;break}if(document.getElementById(k.conf.styleId))throw Error("cann not create new element..");}c=document.createElement("style");c.setAttribute("type","text/css");c.setAttribute("id",k.conf.styleId);c.appendChild(document.createTextNode(""));document.head.appendChild(c);y=c}c=h?h.indexElem:y.sheet;var f=c.cssRules.length,d="";if(a){var g=r(a);if("Object"===g)for(var q in a)"Function"===r(a[q])?(e=a[q](),d+=q+":"+e+"; "):d+=q+":"+a[q]+"; ";else if("Function"===g)for(q in e=a(),e)d+=q+":"+e[q]+
"; ";else d=a+":"+e+";"}try{return"insertRule"in c?c.insertRule(b+"{"+d+"}",f):"appendRule"in c?c.appendRule(b+"{"+d+"}",f):"addRule"in c&&c.addRule(b,d,f),D(c.cssRules[f],h,b)}catch(p){k.conf.viewErr&&console.log('"'+b+'" -> '+p),k.messages.push('"'+b+'" -> '+p)}return!1},J=function(b,a){z||C();a=a?a:u;return a[b]?a[b]:null},K=function(b,a,e){a=a?a:u;if(a[b]){var h=e?a[b].content.indexOf(e):-1;e?0<=h&&(a[b].content.splice(h,1),0>=a[b].content.length&&delete a[b]):delete a[b]}},w=function(b,a,e){a=
a?a:u;var h=r(b);if("String"===h)return a=J(b,a),e?a?a.content:[]:t(a?a.content:[],b);if("RegExp"===h){h=[];for(var c in a)if(c.match(b))for(f=0;f<a[c].content.length;f++)h.push(a[c].content[f]);return e?h:t(h,b)}if("Array"===h){h=[];var f;for(f=0;f<b.length;f++){var d=J(b[f],a);if(null!==d)for(c=0;c<d.content.length;c++)h.push(d.content[c])}return e?h:t(h,b)}if("Null"===h||"Undefined"===h){h=[];for(c in a)for(f=0;f<a[c].content.length;f++)h.push(a[c].content[f]);return e?h:t(h,b)}return null},F=
function(b,a,e,h){var c=r(b);if("String"===c||"RegExp"===c||"Array"===c||"Null"===c||"Undefined"===c)return b=w(b,e,h),a?b.has(a):b;E(b,null,e)},E=function(b,a){var e;for(d in b){var h="Array"===r(b[d])?b[d]:[b[d]];for(e=0;e<h.length;e++)if("@"===d.charAt(0))if("@font-face"===d)v(d,h[e],null,a);else{if(d.match(/^@(media|keyframes|supports)/)||a&&(a.type===k.type.media||a.type===k.type.keyframes||a.type===k.type.supports)){var c=a;var f=d;if(a&&!f.match(/^@(media|keyframes|supports)/)){var d=H(a.csscSelector,
d);c=a.parent}var g=v(d,null,null,c);if(!g||g.content[g.content.length-1].selector!==g.content[g.content.length-1].csscSelector){if(g){var q=g.content.length-1;I(g.content[q].indexElem);K(g.content[q].selector,g.content[q].parent,g.content[q])}g=d;q=d+" {}";c=c||!1;var p=d;p=p.trim();if("@"!==p.charAt(0))var l=k.type.rule;else{p=p.substr(1);l=p.indexOf(" ");0<=l&&(p=p.substr(0,l));l=p;if(0<=p.indexOf("-")){var n=p.split("-");l=n[0];for(p=1;p<n.length;p++)l+=n[p].charAt(0).toUpperCase()+n[p].substr(1)}l=
l in k.type?k.type[l]:-1}c={csscSelector:g,cssText:q,parent:c,type:l,cssRules:{}};g=D(c,c.parent,d)}E(h[e],g.content[g.content.length-1]);a&&(a.obj[f]||(a.obj[f]=[]),a.obj[f].push(g.content[g.content.length-1]))}}else if(g=v(d,null,null,a))f=t([g.content[g.content.length-1]],d),f.set(h[e])}},t=function(b,a,e,h){var c=function(a,d){var g,f,b=[];for(g=0;g<c.e.length;g++)if(c.e[g].children){var l=F(a,d,c.e[g].children,!0);for(f=0;f<l.length;f++)b.push(l[f])}return t(b,a,null,c.e)};c.e=b;c.eLength=b.length;
c.set=function(f,d,g){if("number"===typeof g){if(this.e[g].indexElem.type===k.type.fontFace)return k.conf.viewErr&&console.log('Element of Type "'+k.type.names[this.e[g].indexElem.type]+'" is readonly.'),k.messages.push('Element of Type "'+k.type.names[this.e[g].indexElem.type]+'" is readonly.'),this;if(this.e[g].children)w(null,this.e[g].children).set(f,d);else{var b=r(d);if("Object"===b||"Array"===b){var c=H(this.e[g].selector,f);d="Object"===b?[d]:d;var l;for(l=0;l<d.length;l++)if(b=v(c,null,null,
this.e[g].parent))t([b.content[b.content.length-1]],n).set(d[l]),this.e[g].obj[f]&&"push"in this.e[g].obj[f]||(this.e[g].obj[f]=[]),this.e[g].obj[f].push(b.content[b.content.length-1])}else if("Function"===b){var n=this.pos(g).get(f);try{l=d(n),this.set(f,l,g),this.e[g].indexElem.style._update[f]=d}catch(L){k.conf.viewErr&&console.log(L),k.messages.push(L)}}else{if(isFinite(d))d=0===d%1?d+"px":Math.floor(100*d)/100+"px";else if("String"===r(d)&&(l=d.split(" "),0<l.length)){for(n=0;n<l.length;n++)isFinite(l[n])&&
(d=l[n],l[n]=0===d%1?d+"px":Math.floor(100*d)/100+"px");d=l.join(" ")}this.e[g].indexElem.style[f]=d;this.e[g].obj[f]=d}}}else{var x;g=r(f);"Object"===g?c=Object.keys(f).length:"Function"===g&&(x=f());if(0>=this.e.length&&!e&&"String"===r(a)){var m=[];if(h)for(m=[],l=0;l<h.length;l++){if(b=v(a,null,null,h[l].indexElem,h[l].children))for(n=0;n<b.content.length;n++)m.push(b.content[n])}else if(b=v(a,null,null))m=b.content;this.e=m;this.eLength=m.length}if("Array"===g||"Function"===g&&"Array"===r(x))for(g=
"Array"===g?f:x,l=0;l<g.length;l++)if(f=this.pos(l),1===f.e.length)f.set(g[l]);else break;else for(l=0;l<this.e.length;l++)if("Object"===g&&0<c)for(n in f)this.set(n,f[n],l);else if("Function"===g){for(n in x)this.set(n,x[n],l);this.e[l].indexElem._update=f}else this.set(f,d,l)}return this};c.get=function(a,b){if(!a){a=this.export(k.export.type.object);for(f in a){if(g)return a;var g=f}return a[g]}var f=[];g="";var d;b=!!b;for(d=0;d<this.e.length;d++){var c="";this.e[d].obj[a]&&!this.e[d].obj[a].selector&&
(c=this.e[d].obj[a]);c&&""!==c||(c=this.e[d].indexElem.style[a]);c&&""!==c||(c=A(this.e[d].indexElem.cssText,a));c&&(g=c,b&&f.push(g))}return b?f:g};c.has=function(b){var d=[];var g=r(b);if("String"===g){var c=b.split(":");for(g=0;g<this.e.length;g++){var f=A(this.e[g].indexElem.cssText,c[0]);""!==f&&(!c[1]||c[1]&&c[1].replace(/ |;/g,"")===f)&&d.push(this.e[g])}}else if("Array"===g)for(var e=0;e<b.length;e++)for(c=b[e].split(":"),g=0;g<this.e.length;g++)f=A(this.e[g].indexElem.cssText,c[0]),""!==
f&&(!c[1]||c[1]&&c[1].replace(/ |;/g,"")===f)&&d.push(this.e[g]);else if("RegExp"===g)for(g=0;g<this.e.length;g++)if(c=this.e[g].indexElem.cssText.match(/[\S]+:.+?;/g))for(e=0;e<c.length;e++)(f=c[e].match(b))&&d.push(this.e[g]);return t(d,a,!0)};c.update=function(){var a,b;for(a=0;a<this.e.length;a++){if(!1!==this.e[a].indexElem._update){var c=this.e[a].indexElem._update();for(b in c)this.set(b,c[b],a)}if(this.e[a].children)w(null,this.e[a].children).update();else for(b in this.e[a].indexElem.style._update)c=
this.e[a].indexElem.style._update[b](),this.set(b,c,a)}return this};c.delete=function(a){var b;if("undefined"===typeof a)for(b=0;b<this.e.length;b++){if(I(this.e[b].indexElem),K(this.e[b].selector,this.e[b].parent?this.e[b].parent:null,this.e[b]),this.e[b].children){var c=w(null,this.e[b].children);c.delete(a)}}else for(b=0;b<this.e.length;b++)this.e[b].indexElem.style[a]="",this.e[b].children&&(c=w(null,this.e[b].children),c.delete(a));return this};c.export=function(a,b){var c={},f,d,e,h=a;a===k.export.type.obj&&
(a=k.export.type.object);if(a===k.export.type.normal||a===k.export.type.min)a=k.export.type.notMDObject;b||(b=[]);for(d=0;d<this.e.length;d++)if(!(0<=b.indexOf(this.e[d]))){var m=Object.assign({},this.e[d].obj);for(e in this.e[d].obj)if("object"===typeof this.e[d].obj[e]&&"length"in this.e[d].obj[e])if(a===k.export.type.notMDObject)m[e]=null,delete m[e];else{m[e]=[];for(f=0;f<this.e[d].obj[e].length;f++){var r=t([this.e[d].obj[e][f]]);m[e][f]=r.export(a,b)[this.e[d].obj[e][f].selector];b.push(this.e[d].obj[e][f])}1===
m[e].length&&(m[e]=m[e][0])}this.e[d].children?(f=w(null,this.e[d].children),c[this.e[d].selector]?("length"in c[this.e[d].selector]||(c[this.e[d].selector]=[c[this.e[d].selector]]),c[this.e[d].selector].push(Object.assign(m,f.export(a,b)))):c[this.e[d].selector]=Object.assign(m,f.export(a,b))):c[this.e[d].selector]?("length"in c[this.e[d].selector]||(c[this.e[d].selector]=[c[this.e[d].selector]]),c[this.e[d].selector].push(m)):c[this.e[d].selector]=m}return h===k.export.type.normal||h===k.export.type.min?
G(c,null,h):c};c.pos=function(a){return t(this.e[a]?[this.e[a]]:[])};c.first=function(){return this.pos(0)};c.last=function(){return this.pos(this.e.length-1)};return c};k=function(b,a){try{return F(b,a)}catch(e){k.conf.viewErr&&console.log(e),k.messages.push(e)}};k.import=function(b){try{return E(b)}catch(a){k.conf.viewErr&&console.log(a),k.messages.push(a)}};k.export=function(b){return F().export(b)};k.update=function(b){if(b)b=k(b),b.update();else for(var a in u)b=t(u[a].content),b.update()};k.type=
{rule:1,charset:2,"import":3,media:4,fontFace:5,page:6,keyframes:7,keyframe:8,namespace:10,counterStyle:11,supports:12,fontFeatureValues:14,names:{1:"rule",2:"charset",3:"import",4:"media",5:"font-face",6:"page",7:"keyframes",8:"keyframe",10:"namespace",11:"counter-style",12:"supports",14:"font-feature-values"}};k.events={beforeChange:"beforechange",change:"change",beforeSet:"beforeset",set:"set",beforeCreate:"beforecreate",create:"create",beforeDelete:"beforedelete","delete":"delete",beforeDestroy:"beforedestroy",
destroy:"destroy"};k.export.type={normal:"css",min:"minCss",obj:"obj",object:"object",notMDObject:"objNMDO"};k.conf={styleId:"cssc-style",viewErr:!0};k.messages=[];M?C():window.addEventListener("load",function(){C()});return k}(document.styleSheets,!0)}();
