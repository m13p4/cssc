/*
@version 1.0b
@author m13p4
@copyright Meliantchenkov Pavel
*/
var CSSC=function(){var x;return function(l,H){var r={},y=!1,e=null,A=function(){if(!y){if("cssRules"in l){var a=(l.ownerNode.getAttribute("data-cssc-ignore")||"").toLowerCase();if("true"!==a&&"1"!==a)try{z(l.cssRules,null)}catch(h){e.conf.viewErr&&console.log('Cannot init CSS from "'+l.href+'"'),e.messages.push('Cannot init CSS from "'+l.href+'"')}}else if("length"in l)for(var b=0;b<l.length;b++)if(a=(l[b].ownerNode.getAttribute("data-cssc-ignore")||"").toLowerCase(),"true"!==a&&"1"!==a)try{z(l[b].cssRules,
null)}catch(h){e.conf.viewErr&&console.log('Cannot init CSS from "'+l[b].href+'"'),e.messages.push('Cannot init CSS from "'+l[b].href+'"')}y=!0}},z=function(a,b){for(var e=0;e<a.length;e++)m.isElemInOwnNode(a[e])||B(a[e],b)},B=function(a,b,h){var d=a.cssText.substr(0,a.cssText.indexOf("{")).trim(),c=a.type,f=b?b.children:r;if(c!==e.type.rule&&c!==e.type.fontFace&&c!==e.type.media&&c!==e.type.keyframes&&c!==e.type.keyframe&&c!==e.type.page&&c!==e.type.supports)console.log("unsuported type: ["+c+"] - "+
e.type.names[c]);else return a._update=!1,c===e.type.rule&&(a.style._update={}),b={indexElem:a,selector:d,csscSelector:h?h:d,children:!1,parent:b?b:!1,events:{},obj:{},type:c},f[d]?(f[d].content[0].indexElem===a&&(console.log('Dublicate "'+d+'": '),console.log(Error().stack+"\n\n")),b=f[d].content.push(b)-1):(f[d]={type:c,content:[b],events:{}},b=0),c===e.type.media||c===e.type.keyframes||c===e.type.supports?(f[d].content[b].children={},z(a.cssRules,f[d].content[b])):f[d].content[b].obj=m.objFromCssText(a.cssText),
f[d]},u=function(a,b,h,d){d||x||m.createNewStyleElem();var c=d?d.indexElem:x.sheet;var f=c.cssRules.length,g="";if(b){var k=m.elemType(b);if("Object"===k)for(var t in b)"Function"===m.elemType(b[t])?(h=b[t](),g+=t+":"+h+"; "):g+=t+":"+b[t]+"; ";else if("Function"===k)for(t in h=b(),h)g+=t+":"+h[t]+"; ";else g=b+":"+h+";"}try{return"insertRule"in c?c.insertRule(a+"{"+g+"}",f):"appendRule"in c?c.appendRule(a+"{"+g+"}",f):"addRule"in c&&c.addRule(a,g,f),B(c.cssRules[f],d,a)}catch(E){e.conf.viewErr&&
console.log('"'+a+'" -> '+E),e.messages.push('"'+a+'" -> '+E)}return!1},F=function(a,b){y||A();b=b?b:r;return b[a]?b[a]:null},v=function(a,b,e){b=b?b:r;var d=m.elemType(a);if("String"===d)return b=F(a,b),e?b?b.content:[]:q(b?b.content:[],a);if("RegExp"===d){d=[];for(var c in b)if(c.match(a))for(f=0;f<b[c].content.length;f++)d.push(b[c].content[f]);return e?d:q(d,a)}if("Array"===d){d=[];var f;for(f=0;f<a.length;f++){var g=F(a[f],b);if(null!==g)for(c=0;c<g.content.length;c++)d.push(g.content[c])}return e?
d:q(d,a)}if("Null"===d||"Undefined"===d){d=[];for(c in b)for(f=0;f<b[c].content.length;f++)d.push(b[c].content[f]);return e?d:q(d,a)}return null},D=function(a,b,e,d){var c=m.elemType(a);if("String"===c||"RegExp"===c||"Array"===c||"Null"===c||"Undefined"===c)return a=v(a,e,d),b?a.has(b):a;C(a,null,e)},C=function(a,b){var h;for(g in a){var d="Array"===m.elemType(a[g])?a[g]:[a[g]];for(h=0;h<d.length;h++)if("@"===g.charAt(0))if("@font-face"===g)u(g,d[h],null,b);else{if(g.match(/^@(media|keyframes|supports)/)||
b&&(b.type===e.type.media||b.type===e.type.keyframes||b.type===e.type.supports)){var c=b;var f=g;if(b&&-1===m.selectorType(g)){var g=m.genSelector(b.csscSelector,g);c=b.parent}var k=m.validateSelector(g)?u(g,null,null,c):!1;k||(c={csscSelector:g,cssText:g+" {}",parent:c||!1,type:m.selectorType(g),cssRules:{}},k=B(c,c.parent,g));C(d[h],k.content[k.content.length-1]);b&&(b.obj[f]||(b.obj[f]=[]),b.obj[f].push(k.content[k.content.length-1]))}}else if(k=u(g,null,null,b))f=q([k.content[k.content.length-
1]],g),f.set(d[h])}},q=function(a,b,h,d){var c=function(a,b){var f,g,e=[];for(f=0;f<c.e.length;f++)if(c.e[f].children){var d=D(a,b,c.e[f].children,!0);for(g=0;g<d.length;g++)e.push(d[g])}return q(e,a,null,c.e)};c.e=a;c.eLength=a.length;c.set=function(a,g,k){if("number"===typeof k){if(this.e[k].indexElem.type===e.type.fontFace)return e.conf.viewErr&&console.log('Element of Type "'+e.type.names[this.e[k].indexElem.type]+'" is readonly.'),e.messages.push('Element of Type "'+e.type.names[this.e[k].indexElem.type]+
'" is readonly.'),this;if(this.e[k].children)v(null,this.e[k].children).set(a,g);else{var f=m.elemType(g);if("Object"===f||"Array"===f){var c=m.genSelector(this.e[k].selector,a);g="Object"===f?[g]:g;var n;for(n=0;n<g.length;n++)if(f=u(c,null,null,this.e[k].parent))q([f.content[f.content.length-1]],p).set(g[n]),this.e[k].obj[a]&&"push"in this.e[k].obj[a]||(this.e[k].obj[a]=[]),this.e[k].obj[a].push(f.content[f.content.length-1])}else if("Function"===f){var p=this.pos(k).get(a);try{n=g(p),this.set(a,
n,k),this.e[k].indexElem.style._update[a]=g}catch(G){e.conf.viewErr&&console.log(G),e.messages.push(G)}}else g=m.parseValue(g),this.e[k].indexElem.style[a]=g,this.e[k].obj[a]=g}}else{var w;k=m.elemType(a);"Object"===k?c=Object.keys(a).length:"Function"===k&&(w=a());if(0>=this.e.length&&!h&&"String"===m.elemType(b)){var l=[];if(d)for(l=[],n=0;n<d.length;n++){if(f=u(b,null,null,d[n].indexElem,d[n].children))for(p=0;p<f.content.length;p++)l.push(f.content[p])}else if(f=u(b,null,null))l=f.content;this.e=
l;this.eLength=l.length}if("Array"===k||"Function"===k&&"Array"===m.elemType(w))for(g="Array"===k?a:w,n=0;n<g.length;n++)if(a=this.pos(n),1===a.e.length)a.set(g[n]);else break;else for(n=0;n<this.e.length;n++)if("Object"===k&&0<c)for(p in a)this.set(p,a[p],n);else if("Function"===k){for(p in w)this.set(p,w[p],n);this.e[n].indexElem._update=a}else this.set(a,g,n)}return this};c.get=function(a,b){if(!a){a=this.export(e.export.type.object);for(f in a){if(g)return a;var g=f}return a[g]}var f=[];g="";
var c;b=!!b;for(c=0;c<this.e.length;c++){var d="";this.e[c].obj[a]&&!this.e[c].obj[a].selector&&(d=this.e[c].obj[a]);d&&""!==d||(d=this.e[c].indexElem.style[a]);d&&""!==d||(d=m.findPropInCssText(this.e[c].indexElem.cssText,a));d&&(g=d,b&&f.push(g))}return b?f:g};c.has=function(a){var g=[];var c=m.elemType(a);if("String"===c){var f=a.split(":");for(c=0;c<this.e.length;c++){var e=m.findPropInCssText(this.e[c].indexElem.cssText,f[0]);""!==e&&(!f[1]||f[1]&&f[1].replace(/ |;/g,"")===e)&&g.push(this.e[c])}}else if("Array"===
c)for(var d=0;d<a.length;d++)for(f=a[d].split(":"),c=0;c<this.e.length;c++)e=m.findPropInCssText(this.e[c].indexElem.cssText,f[0]),""!==e&&(!f[1]||f[1]&&f[1].replace(/ |;/g,"")===e)&&g.push(this.e[c]);else if("RegExp"===c)for(c=0;c<this.e.length;c++)if(f=this.e[c].indexElem.cssText.match(/[\S]+:.+?;/g))for(d=0;d<f.length;d++)(e=f[d].match(a))&&g.push(this.e[c]);return q(g,b,!0)};c.update=function(){var a,b;for(a=0;a<this.e.length;a++){if(!1!==this.e[a].indexElem._update){var c=this.e[a].indexElem._update();
for(b in c)this.set(b,c[b],a)}if(this.e[a].children)v(null,this.e[a].children).update();else for(b in this.e[a].indexElem.style._update)c=this.e[a].indexElem.style._update[b](),this.set(b,c,a)}return this};c.delete=function(a){var c;if("undefined"===typeof a)for(c=0;c<this.e.length;c++){this.e[c].indexElem.parentRule?this.e[c].indexElem.parentRule.deleteRule(this.e[c]):this.e[c].indexElem.parentStyleSheet.deleteRule(this.e[c]);var f=this.e[c].parent?this.e[c].parent:null;f=f?f:r;f[b]&&delete f[b];
this.e[c].children&&(f=v(null,this.e[c].children),f.delete(a))}else for(c=0;c<this.e.length;c++)this.e[c].indexElem.style[a]="",this.e[c].children&&(f=v(null,this.e[c].children),f.delete(a));return this};c.export=function(a,b){var c={},f,d,g,h=a;a===e.export.type.obj&&(a=e.export.type.object);if(a===e.export.type.normal||a===e.export.type.min)a=e.export.type.notMDObject;b||(b=[]);for(d=0;d<this.e.length;d++)if(!(0<=b.indexOf(this.e[d]))){var l=Object.assign({},this.e[d].obj);for(g in this.e[d].obj)if("object"===
typeof this.e[d].obj[g]&&"length"in this.e[d].obj[g])if(a===e.export.type.notMDObject)l[g]=null,delete l[g];else{l[g]=[];for(f=0;f<this.e[d].obj[g].length;f++){var r=q([this.e[d].obj[g][f]]);l[g][f]=r.export(a,b)[this.e[d].obj[g][f].selector];b.push(this.e[d].obj[g][f])}1===l[g].length&&(l[g]=l[g][0])}this.e[d].children?(f=v(null,this.e[d].children),c[this.e[d].selector]?("length"in c[this.e[d].selector]||(c[this.e[d].selector]=[c[this.e[d].selector]]),c[this.e[d].selector].push(Object.assign(l,f.export(a,
b)))):c[this.e[d].selector]=Object.assign(l,f.export(a,b))):c[this.e[d].selector]?("length"in c[this.e[d].selector]||(c[this.e[d].selector]=[c[this.e[d].selector]]),c[this.e[d].selector].push(l)):c[this.e[d].selector]=l}return h===e.export.type.normal||h===e.export.type.min?m.cssTextFromObj(c,null,h):c};c.pos=function(a){return q(this.e[a]?[this.e[a]]:[])};c.first=function(){return this.pos(0)};c.last=function(){return this.pos(this.e.length-1)};return c},m={elemType:function(a,b){return b?Object.prototype.toString.call(a):
Object.prototype.toString.call(a).replace(/(^\[.+\s|\]$)/g,"")},createNewStyleElem:function(){if(document.getElementById(e.conf.styleId)){for(var a=0;10>a;a++)if(!document.getElementById(e.conf.styleId+"-"+a)){e.conf.styleId=e.conf.styleId+"-"+a;break}if(document.getElementById(e.conf.styleId))throw Error("cann not create new element..");}a=document.createElement("style");a.setAttribute("type","text/css");a.setAttribute("id",e.conf.styleId);a.appendChild(document.createTextNode(""));document.head.appendChild(a);
x=a},isElemInOwnNode:function(a){return a&&!!a.parentStyleSheet&&!!a.parentStyleSheet.ownerNode&&a.parentStyleSheet.ownerNode.id===e.conf.styleId},parseValue:function(a){if(isFinite(a))return 0===a%1?a+"px":Math.floor(100*a)/100+"px";if("String"===m.elemType(a)){var b=a.split(" ");if(0<b.length){for(var e=0;e<b.length;e++)isFinite(b[e])&&(a=b[e],b[e]=0===a%1?a+"px":Math.floor(100*a)/100+"px");return b.join(" ")}}return a},objFromCssText:function(a){var b=a.replace(/(^.*?{\s*|\s*}\s*$)/g,"");a=b.split(";");
var e={};if(""!==b)for(b=0;b<a.length;b++)if(""!==a[b]){var d=a[b].split(":");e[d[0].trim()]=d.slice(1).join(":").trim()}return e},cssTextFromObj:function(a,b,h){var d="",c;b=b||"";for(c in a){var f=m.elemType(a[c]);if("Object"===f){var g=m.cssTextFromObj(a[c],b+"    ",h);""!==g&&(d=h===e.export.type.min?d+(c+"{"+g+"}"):d+(b+c+" {\n"+g+b+"}\n"))}else if("Array"===f)for(f=0;f<a[c].length;f++)g=m.cssTextFromObj(a[c][f],b+"    ",h),""!==g&&(d=h===e.export.type.min?d+(c+"{"+g+"}"):d+(b+c+" {\n"+g+b+"}\n"));
else d=h===e.export.type.min?d+(c+":"+a[c]+";"):d+((4>b.length?"    ":b)+c+": "+a[c]+";\n")}return d},findPropInCssText:function(a,b){return(a=a.match(new RegExp(b+"s*:s*(.+?);")))?a[1].trim():""},validateSelector:function(a){a=a.trim();return 0>=a.length?!1:"@"===a.charAt(0)?!a.match(/(^@(media|keyframes|supports)|and|or|not|only|[<|>,:\-#'+~`\u00b4}\[{\\!"\u00a7%&/(=?@])\s*$/):!a.match(/[<|>,:\-#'+~`\u00b4}\]\[{\\!"\u00a7%&/()=?@]\s*$/)},selectorType:function(a){a=a.trim();if("@"!==a.charAt(0))return e.type.rule;
a=a.substr(1);var b=a.indexOf(" ");0<=b&&(a=a.substr(0,b));b=a;if(0<=a.indexOf("-")){a=a.split("-");var h;b=a[0];for(h=1;h<a.length;h++)b+=a[h].charAt(0).toUpperCase()+a[h].substr(1)}return b in e.type?e.type[b]:-1},genSelector:function(a,b){"@"===b.charAt(0)&&"@"===a.charAt(0)&&(b=b.substr(1));b="/"===b.charAt(0)?b.substr(1):","===b.charAt(0)?", "+b.substr(1).trim():" "+b;if(","!==b.charAt(0)&&(0<=a.indexOf(",")||0<b.indexOf(","))){a=a.split(",");var e="",d=b.split(","),c;for(b=0;b<a.length;b++)for(c=
0;c<d.length;c++)e+=a[b]+d[c]+", ";return e.replace(/,+\s*$/,"")}return a+b}};e=function(a,b){try{return D(a,b)}catch(h){e.conf.viewErr&&console.log(h),e.messages.push(h)}};e.import=function(a){try{return C(a)}catch(b){e.conf.viewErr&&console.log(b),e.messages.push(b)}};e.export=function(a){return D().export(a)};e.update=function(a){if(a)a=e(a),a.update();else for(var b in r)a=q(r[b].content),a.update()};e.type={rule:1,charset:2,"import":3,media:4,fontFace:5,page:6,keyframes:7,keyframe:8,namespace:10,
counterStyle:11,supports:12,fontFeatureValues:14,names:{1:"rule",2:"charset",3:"import",4:"media",5:"font-face",6:"page",7:"keyframes",8:"keyframe",10:"namespace",11:"counter-style",12:"supports",14:"font-feature-values"}};e.events={beforeChange:"beforechange",change:"change",beforeSet:"beforeset",set:"set",beforeCreate:"beforecreate",create:"create",beforeDelete:"beforedelete","delete":"delete",beforeDestroy:"beforedestroy",destroy:"destroy"};e.export.type={normal:"css",min:"minCss",obj:"obj",object:"object",
notMDObject:"objNMDO"};e.conf={styleId:"cssc-style",viewErr:!0};e.messages=[];H?A():window.addEventListener("load",function(){A()});return e}(document.styleSheets,!0)}();
