/* CSSC.js | @version 1.0b |  m13p4 */
var CSSC=function(){var y={},G=[],C,p=function(a,b){return b?Object.prototype.toString.call(a):Object.prototype.toString.call(a).replace(/(^\[.+\s|\]$)/g,"")},H=function(a){if(a.match(/^@(namespace|import|charset)/))return a.replace(/(^@(namespace|import|charset)\s*|\s*;\s*$)/g,"");var b=a.replace(/(^.*?{\s*|\s*}\s*$)/g,"");a=b.split(";");var f={};if(""!==b)for(b=0;b<a.length;b++)if(""!==a[b]){var c=a[b].split(":");f[c[0].trim()]=c.slice(1).join(":").trim()}return f},v=function(a,b,f,c,g){var e="",
k=Array((parseInt(f)||2)+1).join(" "),h,d=p(a);c=c||"";if("String"===d)return a;if("Array"===d)for(d=0;d<a.length;d++)e+=v(a[d],b,f,c,!0);else for(h in a){var n=a[h];d=p(a[h]);if("Object"===d||"Array"===d)if(g&&"Array"===d){var m=v(a[h],b,f,c+k,g);""!==m&&(e=b?e+(h.replace(/\s*(,|:)\s*/g,"$1")+"{"+m+"}"):e+(c+h.replace(/\s*,\s*/g,",\n"+c)+" {\n"+m+c+"}\n"))}else for("Object"===d&&(n=[a[h]]),d=0;d<n.length;d++)"@namespace"===h||"@import"===h||"@charset"===h?e+=h+" "+n[d]+";"+(b?"":"\n"):(m=v(n[d],
b,f,c+k,g),""!==m&&(e=b?e+(h.replace(/\s*(,|:)\s*/g,"$1")+"{"+m+"}"):e+(c+h.replace(/\s*,\s*/g,",\n"+c)+" {\n"+m+c+"}\n")));else e="@namespace"===h||"@import"===h||"@charset"===h?e+(h+" "+n+";"+(b?"":"\n")):b?e+(h+":"+n.trim().replace(/\s*,\s*/g,",")+";"):e+((c.length<k.length?k:c)+h+": "+n+";\n")}return e},D=function(a,b){return(a=a.match(new RegExp(b+"s*:s*(.+?);")))?a[1].trim():""},E=function(a,b){"@"===b.charAt(0)&&"@"===a.charAt(0)&&(b=b.substr(1));b="/"===b.charAt(0)?b.substr(1):","===b.charAt(0)?
", "+b.substr(1).trim():" "+b;if(0<=a.indexOf(",")||0<b.indexOf(",")){a=a.split(",");var f,c="",g=b.split(",");if(","!==b.charAt(0))for(f=0;f<a.length;f++)for(b=0;b<g.length;b++)c+=a[f]+g[b]+", ";else for(f=0;f<a.length;f++)c+=a[f]+b+", ";return c.replace(/,+\s*$/,"")}return a+b},I=function(a){var b=a.parentRule?a.parentRule:a.parentStyleSheet,f;for(f=0;f<b.cssRules.length;f++)b.cssRules[f]===a&&b.deleteRule(f)},F=function(a,b){b||(b={});a||(a="");for(var f=a.lastIndexOf("$"),c,g=0,e,k,h,d,n,m;0<=
f&&100>g;){g++;e=null;d=a.substr(f+1);c=d.search(/[^\w\.]/);c=0>c?a.length:c+f;n=a.substr(f+1,c-f);m=n.split(".");for(k=0;k<m.length;k++){h=typeof e;if(0===k&&m[k]in b)e=b[m[k]];else if(0===k&&m[k]in l.vars)e=l.vars[m[k]];else if(null!==e&&"object"===h&&m[k]in e)e=e[m[k]];else if("string"===h&&m[k].match(/^[0-9]+$/))e=e.charAt(m[k]);else{e="$"+n;break}if("function"===typeof e){if("("===a.charAt(c+1)){c++;for(h=d=c;h=a.indexOf("(",h+1),c=a.indexOf(")",c+1),-1<h&&h<c;);0>c&&(c=a.length);d=a.substr(d+
1,c-d-1);d=d.trim().split(/\s*,\s*/);e=e.apply(null,d)}else e=e();if("."===a.charAt(c+1))for(c++,h=c,d=a.substr(c+1),c=d.search(/[^\w\.]/),d=d.substr(0,-1<c?c:d.length),c=0>c?a.length:c+h,n=a.substr(f+1,c-f),d=d.split("."),h=0;h<d.length;h++)m.push(d[h])}}a=a.substr(0,f)+e+a.substr(c+1);"$"+n===e&&f--;if(0>f)break;f=a.lastIndexOf("$",f)}return a},J=function(a,b){var f;if(Object.defineProperty)for(f in b)Object.defineProperty(a,f,{enumerable:!0,value:b[f]});else for(f in b)a[f]=b[f]},w=function(a){if(Object.freeze)return Object.freeze(a);
if(Object.defineProperty){var b={},f;for(f in a)Object.defineProperty(b,f,{enumerable:!0,value:a[f]});Object.preventExtensions&&Object.preventExtensions(b);return b}return a},K=function(a,b){for(var f=0;f<a.length;f++){var c=a[f];c&&c.parentStyleSheet&&c.parentStyleSheet.ownerNode&&c.parentStyleSheet.ownerNode.id===l.conf.styleId||z(a[f],b)}},z=function(a,b,f){var c=a.cssText.substr(0,a.cssText.indexOf("{")).trim(),g=a.type,e=b?b.children:y;if(g!==l.type.rule&&g!==l.type.fontFace&&g!==l.type.media&&
g!==l.type.keyframes&&g!==l.type.keyframe&&g!==l.type.page&&g!==l.type.supports&&g!==l.type.namespace&&g!==l.type.import&&g!==l.type.charset)console.log("unsuported type: ["+g+"] - "+l.type.names[g]);else return g===l.type.namespace&&(c="@namespace"),g===l.type.import&&(c="@import"),g===l.type.charset&&(c="@charset"),a._update=!1,g===l.type.rule&&(a.style._update={}),b={indexElem:a,selector:c,csscSelector:f?f:c,children:!1,parent:b?b:!1,events:{},obj:{},type:g},e[c]?(e[c].content[0].indexElem===a&&
(console.log('Dublicate "'+c+'": '),console.log(Error().stack+"\n\n")),b=e[c].content.push(b)-1):(e[c]={type:g,content:[b],events:{}},b=0),G.push(e[c].content[b]),g===l.type.media||g===l.type.keyframes||g===l.type.supports?(e[c].content[b].children={},K(a.cssRules,e[c].content[b])):e[c].content[b].obj=H(a.cssText),e[c]},u=function(a,b,f,c){var g;if(!c&&!C){if(document.getElementById(l.conf.styleId)){for(g=0;10>g;g++)if(!document.getElementById(l.conf.styleId+"-"+g)){l.conf.styleId=l.conf.styleId+
"-"+g;break}if(document.getElementById(l.conf.styleId))throw Error("cann not create new element..");}g=document.createElement("style");g.setAttribute("type","text/css");g.setAttribute("id",l.conf.styleId);g.appendChild(document.createTextNode(""));document.head.appendChild(g);C=g}g=c?c.indexElem:C.sheet;var e=g.cssRules.length,k="";if(b){var h=p(b);if("Object"===h)for(var d in b)"Function"===p(b[d])?(f=b[d](),k+=d+":"+f+"; "):k+=d+":"+b[d]+"; ";else if("Function"===h)for(d in f=b(),f)k+=d+":"+f[d]+
"; ";else k=b+":"+f+";"}try{f=a+"{"+k+"}";if("@namespace"===a||"@import"===a||"@charset"===a)f=a+" "+b;return"@charset"!==a?("insertRule"in g?g.insertRule(f,e):"appendRule"in g?g.appendRule(f,e):"addRule"in g&&g.addRule(a,k,e),z(g.cssRules[e],c,a)):z({csscSelector:a,cssText:f,parent:!1,type:l.type.charset,cssRules:{}},c,d)}catch(n){a=(c?'"'+c.selector+'" > ':"")+'"'+a+'" -> '+n,l.conf.viewErr&&console.log(a),l.messages.push(a)}return!1},L=function(a,b){b=b?b:y;return b[a]?b[a]:null},M=function(a,
b,f){b=b?b:y;if(b[a]){var c=f?b[a].content.indexOf(f):-1;f?0<=c&&(b[a].content.splice(c,1),0>=b[a].content.length&&delete b[a]):delete b[a]}},t=function(a,b,f){b=b?b:y;var c=p(a);if("String"===c)return b=L(a,b),f?b?b.content:[]:q(b?b.content:[],a);if("RegExp"===c){c=[];for(var g in b)if(g.match(a))for(e=0;e<b[g].content.length;e++)c.push(b[g].content[e]);return f?c:q(c,a)}if("Array"===c){c=[];var e;for(e=0;e<a.length;e++){var k=L(a[e],b);if(null!==k)for(g=0;g<k.content.length;g++)c.push(k.content[g])}return f?
c:q(c,a)}if("Null"===c||"Undefined"===c){c=[];for(g in b)for(e=0;e<b[g].content.length;e++)c.push(b[g].content[e]);return f?c:q(c,a)}return null},x=function(a,b,f,c){var g=p(a);if("String"===g||"RegExp"===g||"Array"===g||"Null"===g||"Undefined"===g)return a=t(a,f,c),b?a.has(b):a;A(a)},A=function(a,b,f){var c,g={};f||b||("@charset"in a&&(g["@charset"]=a["@charset"]),"@import"in a&&(g["@import"]=a["@import"]),"@namespace"in a&&(g["@namespace"]=a["@namespace"]),"@font-face"in a&&(g["@font-face"]=a["@font-face"]),
0<Object.keys(g).length&&A(g,b,!0));for(e in a)if(!(e in g)){f="Array"===p(a[e])?a[e]:[a[e]];var e=F(e);for(c=0;c<f.length;c++)if("@"===e.charAt(0))if("@font-face"===e||"@namespace"===e||"@import"===e||"@charset"===e)u(e,f[c],null,b);else{if(e.match(/^@(media|keyframes|supports)/)||b&&(b.type===l.type.media||b.type===l.type.keyframes||b.type===l.type.supports)){var k=b;var h=e;b&&!h.match(/^@(media|keyframes|supports)/)&&(e=E(b.csscSelector,e),k=b.parent);var d=u(e,null,null,k);if(!d||d.content[d.content.length-
1].selector!==d.content[d.content.length-1].csscSelector){if(d){var n=d.content.length-1;I(d.content[n].indexElem);M(d.content[n].selector,d.content[n].parent,d.content[n])}d=e;n=e+" {}";k=k||!1;var m=e;m=m.trim();if("@"!==m.charAt(0))var r=l.type.rule;else{m=m.substr(1);r=m.indexOf(" ");0<=r&&(m=m.substr(0,r));r=m;if(0<=m.indexOf("-")){var B=m.split("-");r=B[0];for(m=1;m<B.length;m++)r+=B[m].charAt(0).toUpperCase()+B[m].substr(1)}r=r in l.type?l.type[r]:-1}k={csscSelector:d,cssText:n,parent:k,type:r,
cssRules:{}};d=z(k,k.parent,e)}A(f[c],d.content[d.content.length-1]);b&&(b.obj[h]||(b.obj[h]=[]),b.obj[h].push(d.content[d.content.length-1]))}}else if(d=u(e,null,null,b))h=q([d.content[d.content.length-1]],e),h.set(f[c])}},q=function(a,b,f,c){var g=function(){if(0>=e.e.length&&!f&&"String"===p(b)){var a,h=[],d,n;if(c)for(d=0;d<c.length;d++){if(a=u(b,null,null,c[d]))for(n=0;n<a.content.length;n++)h.push(a.content[n])}else if(a=u(b,null,null))h=a.content;e.e=h;e.eLength=h.length}};var e=function(a,
b){var d,k,h=[];g();for(d=0;d<e.e.length;d++)if(e.e[d].children){var c=x(a,b,e.e[d].children,!0);for(k=0;k<c.length;k++)h.push(c[k])}return q(h,a,null,e.e)};e.e=a;e.eLength=a.length;e.set=function(a,b,d){if("number"===typeof d){if(this.e[d].indexElem.type===l.type.fontFace)return l.conf.viewErr&&console.log('Element of Type "'+l.type.names[this.e[d].indexElem.type]+'" is readonly.'),l.messages.push('Element of Type "'+l.type.names[this.e[d].indexElem.type]+'" is readonly.'),this;a=F(a);if(this.e[d].children)t(null,
this.e[d].children).set(a,b);else{var c,e=p(b);if("Object"===e||"Array"===e){var k=E(this.e[d].selector,a);b="Object"===e?[b]:b;for(c=0;c<b.length;c++){e=null;if("@"===a.charAt(0)){if(e=t(this.e[d].parent?E(this.e[d].parent.selector,a):a),e=e(this.e[d].selector),e.set(b[c]),e=e.e[e.e.length-1],this.e[d].parent){var h=this.e[d].parent;h.obj[a]&&"push"in h.obj[a]||(h.obj[a]=[]);h.obj[a].push(e.parent)}}else if(h=u(k,null,null,this.e[d].parent))e=q([h.content[h.content.length-1]],f),e.set(b[c]),e=h.content[h.content.length-
1];null!==e&&(this.e[d].obj[a]&&"push"in this.e[d].obj[a]||(this.e[d].obj[a]=[]),this.e[d].obj[a].push(e))}}else if("Function"===e){var f=this.pos(d).get(a);try{c=b(f),this.set(a,c,d),this.e[d].indexElem.style._update[a]=b}catch(N){l.conf.viewErr&&console.log(N),l.messages.push(N)}}else{a:if(isFinite(b))c=0===b%1?b+"px":Math.floor(100*b)/100+"px";else{if("String"===p(b)&&(c=b.split(" "),0<c.length)){for(b=0;b<c.length;b++)isFinite(c[b])&&(f=c[b],c[b]=0===f%1?f+"px":Math.floor(100*f)/100+"px");c=c.join(" ");
break a}c=b}this.e[d].indexElem.style[a]=c;this.e[d].obj[a]=c}}}else if(d=p(a),"Object"===d?k=Object.keys(a).length:"Function"===d&&(e=a()),g(),"Array"===d||"Function"===d&&"Array"===p(e))for(d="Array"===d?a:e,c=0;c<d.length;c++)if(a=this.pos(c),1===a.e.length)a.set(d[c]);else break;else for(c=0;c<this.e.length;c++)if("Object"===d&&0<k)for(f in a)this.set(f,a[f],c);else if("Function"===d){for(f in e)this.set(f,e[f],c);this.e[c].indexElem._update=a}else this.set(a,b,c);return this};e.get=function(a,
b){if(!a)return this.export(l.export.type.object);var d=[],c="",e;b=!!b;for(e=0;e<this.e.length;e++){var f="";this.e[e].obj[a]&&(f=this.e[e].obj[a],"Array"===p(f)&&(f=q(f),f=f.export(l.export.type.object)));f&&""!==f||(f=this.e[e].indexElem.style[a]);f&&""!==f||(f=D(this.e[e].indexElem.cssText,a));f&&(c=f,b&&d.push(c))}return b?d:c};e.has=function(a){var c=[];var d=p(a);if("String"===d){var e=a.split(":");for(d=0;d<this.e.length;d++){var f=D(this.e[d].indexElem.cssText,e[0]);""!==f&&(!e[1]||e[1]&&
e[1].replace(/ |;/g,"")===f)&&c.push(this.e[d])}}else if("Array"===d)for(var k=0;k<a.length;k++)for(e=a[k].split(":"),d=0;d<this.e.length;d++)f=D(this.e[d].indexElem.cssText,e[0]),""!==f&&(!e[1]||e[1]&&e[1].replace(/ |;/g,"")===f)&&c.push(this.e[d]);else if("RegExp"===d)for(d=0;d<this.e.length;d++)if(e=this.e[d].indexElem.cssText.match(/[\S]+:.+?;/g))for(k=0;k<e.length;k++)(f=e[k].match(a))&&c.push(this.e[d]);return q(c,b,!0)};e.update=function(){var a,b;for(a=0;a<this.e.length;a++){if(!1!==this.e[a].indexElem._update){var d=
this.e[a].indexElem._update();for(b in d)this.set(b,d[b],a)}if(this.e[a].children)t(null,this.e[a].children).update();else if(this.e[a].indexElem.style)for(b in this.e[a].indexElem.style._update)d=this.e[a].indexElem.style._update[b](),this.set(b,d,a)}return this};e.delete=function(a){var b;if("undefined"===typeof a)for(b=0;b<this.e.length;b++){if(I(this.e[b].indexElem),M(this.e[b].selector,this.e[b].parent?this.e[b].parent:null,this.e[b]),this.e[b].children){var d=t(null,this.e[b].children);d.delete(a)}}else for(b=
0;b<this.e.length;b++)this.e[b].indexElem.style[a]="",this.e[b].children&&(d=t(null,this.e[b].children),d.delete(a));return this};e.export=function(a,b){var d={},c,e,f,g=a;a===l.export.type.obj&&(a=l.export.type.object);if(a===l.export.type.normal||a===l.export.type.min)a=l.export.type.array;b||(b=[]);for(c=0;c<this.e.length;c++)if(!(0<=b.indexOf(this.e[c]))){if(this.e[c].type===l.type.namespace||this.e[c].type===l.type.import||this.e[c].type===l.type.charset)var h=this.e[c].obj;else for(f in h=Object.assign({},
this.e[c].obj),this.e[c].obj)if("object"===typeof this.e[c].obj[f]&&"length"in this.e[c].obj[f])if(a===l.export.type.notMDObject||a===l.export.type.array)h[f]=null,delete h[f];else{h[f]=[];for(e=0;e<this.e[c].obj[f].length;e++)if(!(0<=b.indexOf(this.e[c].obj[f][e]))){var k=q([this.e[c].obj[f][e]]);k=k.export(a,b)[this.e[c].obj[f][e].selector];b.push(this.e[c].obj[f][e]);!k||0>=Object.keys(k).length||(h[f][e]=k)}0===h[f].length?delete h[f]:1===h[f].length&&(h[f]=h[f][0])}this.e[c].children&&(k=t(null,
this.e[c].children),h=Object.assign(k.export(a,b),h));0>=Object.keys(h).length||(a===l.export.type.array?(k=G.indexOf(this.e[c]),k="@charset"===this.e[c].selector?0:"@import"===this.e[c].selector?k+1E5:"@namespace"===this.e[c].selector?k+2E5:"@font-face"===this.e[c].selector?k+3E5:k+1E6,d[k]={},d[k][this.e[c].selector]=h):d[this.e[c].selector]?("object"===typeof d[this.e[c].selector]&&"length"in d[this.e[c].selector]||(d[this.e[c].selector]=[d[this.e[c].selector]]),d[this.e[c].selector].push(h)):
d[this.e[c].selector]=h,b.push(this.e[c]))}if(a===l.export.type.array)return d=Object.values(d),a===g?d:v(d,g===l.export.type.min);a={};d["@charset"]&&(a["@charset"]=d["@charset"]);d["@import"]&&(a["@import"]=d["@import"]);d["@namespace"]&&(a["@namespace"]=d["@namespace"]);d["@font-face"]&&(a["@font-face"]=d["@font-face"]);if(k=0<Object.keys(a).length)for(c in d)a[c]||(a[c]=d[c]);return k?a:d};e.parse=function(a){return this.export(a?l.export.type.min:l.export.type.normal)};e.pos=function(a){return q(this.e[a]?
[this.e[a]]:[])};e.first=function(){return this.pos(0)};e.last=function(){return this.pos(this.e.length-1)};return e};var l=function(a,b){try{return x(a,b)}catch(f){l.conf.viewErr&&console.log(f),l.messages.push(f)}};J(l,{version:"1.0b","import":function(a,b){return A(a)},"export":function(a){return x().export(a)},parse:function(a){return x().parse(a)},update:function(a){return x(a).update()},init:function(a){a="length"in a?a:[a];for(var b=0;b<a.length;b++)if("sheet"in a[b]&&(a[b]=a[b].sheet),"cssRules"in
a[b]){var f=(a[b].ownerNode.getAttribute("data-cssc-ignore")||"").toLowerCase();if("true"!==f&&"1"!==f)try{K(a[b].cssRules,null)}catch(c){l.conf.viewErr&&console.log('Cannot init CSS from "'+a[b].href+'"'),l.messages.push('Cannot init CSS from "'+a[b].href+'"')}}},parseVars:function(a,b){return F(a,b)},objFromCss:function(a){return H(a)},cssFromObj:function(a,b,f){return v(a,b,f)},conf:w({styleId:"cssc-style",viewErr:!0}),type:w({rule:1,charset:2,"import":3,media:4,fontFace:5,page:6,keyframes:7,keyframe:8,
namespace:10,counterStyle:11,supports:12,fontFeatureValues:14,viewport:15,names:w({1:"rule",2:"charset",3:"import",4:"media",5:"font-face",6:"page",7:"keyframes",8:"keyframe",10:"namespace",11:"counter-style",12:"supports",14:"font-feature-values",15:"viewport"})}),events:w({beforeChange:"beforechange",change:"change",beforeSet:"beforeset",set:"set",beforeCreate:"beforecreate",create:"create",beforeDelete:"beforedelete","delete":"delete",beforeDestroy:"beforedestroy",destroy:"destroy"})});J(l.export,
{type:w({normal:"css",min:"minCss",obj:"obj",object:"object",notMDObject:"objNMD",array:"array"})});l.messages=[];l.vars={};return l}();
