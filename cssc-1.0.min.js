/* CSSC.js | @version 1.0b |  m13p4 */
var CSSC=function(){function r(a,b){return b?Object.prototype.toString.call(a):Object.prototype.toString.call(a).replace(/(^\[.+\s|\]$)/g,"")}function H(a){if(a.match(/^@(namespace|import|charset)/))return a.replace(/(^@(namespace|import|charset)\s*|\s*;\s*$)/g,"");var b=a.replace(/(^.*?{\s*|\s*}\s*$)/g,"");a=b.split(";");var c={};if(""!==b)for(b=0;b<a.length;b++)if(""!==a[b]){var d=a[b].split(":");c[d[0].trim()]=d.slice(1).join(":").trim()}return c}function w(a,b,c,d,f){var e="",k=Array((parseInt(c)||
2)+1).join(" "),l,g=r(a);d=d||"";if("String"===g)return a;if("Array"===g)for(g=0;g<a.length;g++)e+=w(a[g],b,c,d,!0);else for(l in a){var p=a[l];g=r(a[l]);if("Object"===g||"Array"===g)if(f&&"Array"===g){var h=w(a[l],b,c,d+k,f);""!==h&&(e=b?e+(l.replace(/\s*(,|:)\s*/g,"$1")+"{"+h+"}"):e+(d+l.replace(/\s*,\s*/g,",\n"+d)+" {\n"+h+d+"}\n"))}else for("Object"===g&&(p=[a[l]]),g=0;g<p.length;g++)"@namespace"===l||"@import"===l||"@charset"===l?e+=l+" "+p[g]+";"+(b?"":"\n"):(h=w(p[g],b,c,d+k,f),""!==h&&(e=
b?e+(l.replace(/\s*(,|:)\s*/g,"$1")+"{"+h+"}"):e+(d+l.replace(/\s*,\s*/g,",\n"+d)+" {\n"+h+d+"}\n")));else e="@namespace"===l||"@import"===l||"@charset"===l?e+(l+" "+p+";"+(b?"":"\n")):b?e+(l+":"+p.trim().replace(/\s*,\s*/g,",")+";"):e+((d.length<k.length?k:d)+l+": "+p+";\n")}return e}function E(a,b){"@"===b.charAt(0)&&"@"===a.charAt(0)&&(b=b.substr(1));b="/"===b.charAt(0)?b.substr(1):","===b.charAt(0)?", "+b.substr(1).trim():" "+b;if(0<=a.indexOf(",")||0<b.indexOf(",")){a=a.split(",");var c,d="",
f=b.split(",");if(","!==b.charAt(0))for(c=0;c<a.length;c++)for(b=0;b<f.length;b++)d+=a[c]+f[b]+", ";else for(c=0;c<a.length;c++)d+=a[c]+b+", ";return d.replace(/,+\s*$/,"")}return a+b}function I(a){var b=a.parentRule?a.parentRule:a.parentStyleSheet,c;for(c=0;c<b.cssRules.length;c++)b.cssRules[c]===a&&b.deleteRule(c)}function F(a,b){b||(b={});a||(a="");for(var c=a.lastIndexOf("$"),d,f=0,e,n,l,g,p,h;0<=c&&100>f;){f++;e=null;g=a.substr(c+1);d=g.search(/[^\w\.]/);d=0>d?a.length:d+c;p=a.substr(c+1,d-c);
h=p.split(".");for(n=0;n<h.length;n++)if(!(1>h[n].length)){l=typeof e;if(0===n&&h[n]in b)e=b[h[n]];else if(0===n&&h[n]in k.vars)e=k.vars[h[n]];else if(null!==e&&"object"===l&&h[n]in e)e=e[h[n]];else if("string"===l&&h[n].match(/^[0-9]+$/))e=e.charAt(h[n]);else{e="$"+p;break}if("function"===typeof e){if("("===a.charAt(d+1)){d++;l=g=d;do l=a.indexOf("(",l+1),d=a.indexOf(")",d+1);while(-1<l&&l<d);0>d&&(d=a.length);g=a.substr(g+1,d-g-1);g=g.trim().split(/\s*,\s*/);e=e.apply(null,g)}else e=e();if("."===
a.charAt(d+1))for(d++,l=d,g=a.substr(d+1),d=g.search(/[^\w\.]/),g=g.substr(0,0>d?g.length:d),d=0>d?a.length:d+l,p=a.substr(c+1,d-c),g=g.split("."),l=0;l<g.length;l++)h.push(g[l])}}a=a.substr(0,c)+e+a.substr(d+1);d="$"+p===e?c:d+(e.length-1);if(0>--d)break;c=a.lastIndexOf("$",d)}return a}function J(a,b){var c;if(Object.defineProperty)for(c in b)Object.defineProperty(a,c,{enumerable:!0,value:b[c]});else for(c in b)a[c]=b[c]}function x(a){if(Object.freeze)return Object.freeze(a);if(Object.defineProperty){var b=
{},c;for(c in a)Object.defineProperty(b,c,{enumerable:!0,value:a[c]});a=b}Object.preventExtensions&&Object.preventExtensions(a);return a}function K(a,b){for(var c=0;c<a.length;c++){var d=a[c];d&&d.parentStyleSheet&&d.parentStyleSheet.ownerNode&&d.parentStyleSheet.ownerNode.id===k.conf.styleId||A(a[c],b)}}function A(a,b,c){var d=a.cssText.substr(0,a.cssText.indexOf("{")).trim(),f=a.type,e=b?b.children:B;if(f!==k.type.rule&&f!==k.type.fontFace&&f!==k.type.media&&f!==k.type.keyframes&&f!==k.type.keyframe&&
f!==k.type.page&&f!==k.type.supports&&f!==k.type.namespace&&f!==k.type.import&&f!==k.type.charset)console.log("unsuported type: ["+f+"] - "+k.type.names[f]);else return f===k.type.namespace&&(d="@namespace"),f===k.type.import&&(d="@import"),f===k.type.charset&&(d="@charset"),a._update=!1,f===k.type.rule&&(a.style._update={}),b={indexElem:a,selector:d,csscSelector:c?c:d,children:!1,parent:b?b:!1,events:{},obj:{},type:f},e[d]?(e[d].content[0].indexElem===a&&(console.log('Dublicate "'+d+'": '),console.log(Error().stack+
"\n\n")),b=e[d].content.push(b)-1):(e[d]={type:f,content:[b],events:{}},b=0),L.push(e[d].content[b]),f===k.type.media||f===k.type.keyframes||f===k.type.supports?(e[d].content[b].children={},K(a.cssRules,e[d].content[b])):e[d].content[b].obj=H(a.cssText),e[d]}function u(a,b,c,d){var f;if(!d&&!G){if(document.getElementById(k.conf.styleId)){for(f=0;10>f;f++)if(!document.getElementById(k.conf.styleId+"-"+f)){k.conf.styleId=k.conf.styleId+"-"+f;break}if(document.getElementById(k.conf.styleId))throw Error("cann not create new element..");
}f=document.createElement("style");f.setAttribute("type","text/css");f.setAttribute("id",k.conf.styleId);f.appendChild(document.createTextNode(""));document.head.appendChild(f);G=f}f=d?d.indexElem:G.sheet;var e=f.cssRules.length,n="";if(b){var l=r(b);if("Object"===l)for(var g in b)"Function"===r(b[g])?(c=b[g](),n+=g+":"+c+"; "):n+=g+":"+b[g]+"; ";else if("Function"===l)for(g in c=b(),c)n+=g+":"+c[g]+"; ";else n=b+":"+c+";"}try{c=a+"{"+n+"}";if("@namespace"===a||"@import"===a||"@charset"===a)c=a+" "+
b;return"@charset"!==a?("insertRule"in f?f.insertRule(c,e):"appendRule"in f?f.appendRule(c,e):"addRule"in f&&f.addRule(a,n,e),A(f.cssRules[e],d,a)):A({csscSelector:a,cssText:c,parent:!1,type:k.type.charset,cssRules:{}},d,g)}catch(p){a=(d?'"'+d.selector+'" > ':"")+'"'+a+'" -> '+p,k.conf.viewErr&&console.log(a),k.messages.push(a)}return!1}function M(a,b){b=b?b:B;return b[a]?b[a]:null}function N(a,b,c){b=b?b:B;if(b[a]){var d=c?b[a].content.indexOf(c):-1;c?0<=d&&(b[a].content.splice(d,1),0>=b[a].content.length&&
delete b[a]):delete b[a]}}function v(a,b,c){b=b?b:B;var d=r(a);if("String"===d)return b=M(a,b),c?b?b.content:[]:t(b?b.content:[],a);if("RegExp"===d){d=[];for(var f in b)if(f.match(a))for(e=0;e<b[f].content.length;e++)d.push(b[f].content[e]);return c?d:t(d,a)}if("Array"===d){d=[];var e;for(e=0;e<a.length;e++){var k=M(a[e],b);if(null!==k)for(f=0;f<k.content.length;f++)d.push(k.content[f])}return c?d:t(d,a)}if("Null"===d||"Undefined"===d){d=[];for(f in b)for(e=0;e<b[f].content.length;e++)d.push(b[f].content[e]);
return c?d:t(d,a)}return null}function y(a,b,c,d){var f=r(a);if("String"===f||"RegExp"===f||"Array"===f||"Null"===f||"Undefined"===f)a=v(a,c,d);else return z(a);return b?a.has(b):a}function z(a,b,c){var d,f={};c||b||("@charset"in a&&(f["@charset"]=a["@charset"]),"@import"in a&&(f["@import"]=a["@import"]),"@namespace"in a&&(f["@namespace"]=a["@namespace"]),"@font-face"in a&&(f["@font-face"]=a["@font-face"]),0<Object.keys(f).length&&z(f,b,!0));for(e in a)if(!(e in f)){c="Array"===r(a[e])?a[e]:[a[e]];
var e=F(e);for(d=0;d<c.length;d++)if("@"===e.charAt(0))if("@font-face"===e||"@namespace"===e||"@import"===e||"@charset"===e)u(e,c[d],null,b);else{if(e.match(/^@(media|keyframes|supports)/)||b&&(b.type===k.type.media||b.type===k.type.keyframes||b.type===k.type.supports)){var n=b;var l=e;b&&!l.match(/^@(media|keyframes|supports)/)&&(e=E(b.csscSelector,e),n=b.parent);var g=u(e,null,null,n);var p=(g?g.content.length:0)-1;if(-1<p&&g.content[p].selector===g.content[p].csscSelector)z(c[d],g.content[p]);
else{-1<p&&(I(g.content[p].indexElem),N(g.content[p].selector,g.content[p].parent,g.content[p]));g=e;p=e+" {}";n=n||!1;var h=e;h=h.trim();if("@"!==h.charAt(0))var m=k.type.rule;else{h=h.substr(1);m=h.indexOf(" ");0<=m&&(h=h.substr(0,m));m=h;if(0<=h.indexOf("-")){var C=h.split("-");m=C[0];for(h=1;h<C.length;h++)m+=C[h].charAt(0).toUpperCase()+C[h].substr(1)}m=m in k.type?k.type[m]:-1}n={csscSelector:g,cssText:p,parent:n,type:m,cssRules:{}};g=A(n,n.parent,e);z(c[d],g.content[g.content.length-1])}b&&
(b.obj[l]||(b.obj[l]=[]),b.obj[l].push(g.content[g.content.length-1]))}}else if(g=u(e,null,null,b))l=t([g.content[g.content.length-1]],e),l.set(c[d])}}function t(a,b,c,d){function f(){if(0>=a.length&&!c&&"String"===r(b)){var m,e=[],f,D;if(d)for(f=0;f<d.length;f++){if(m=u(b,null,null,d[f]))for(D=0;D<m.content.length;D++)e.push(m.content[D])}else if(m=u(b,null,null))e=m.content;a=e;h.e=a;h.eLength=e.length}}function e(b,d,c){f();if("number"===typeof c){if(a[c].indexElem.type===k.type.fontFace)return k.conf.viewErr&&
console.log('Element of Type "'+k.type.names[a[c].indexElem.type]+'" is readonly.'),k.messages.push('Element of Type "'+k.type.names[a[c].indexElem.type]+'" is readonly.'),this;b=F(b);if(a[c].children)v(null,a[c].children).set(b,d);else{var m,g=r(d),q;if("Object"===g||"Array"===g){var h="@"===b.charAt(0);d="Object"===g?[d]:d;g=E(a[c].selector,b);h&&(g=a[c].parent?E(a[c].parent.selector,b):b);for(m=0;m<d.length;m++)if(q=u(g,null,null,h?!1:a[c].parent)){var l=q.content.length-1;q=t([q.content[l]],g);
h&&(q=q(a[c].selector));q.set(d[m]);q=q.e[q.e.length-1];h&&a[c].parent&&(l=a[c].parent,l.obj[b]&&"push"in l.obj[b]||(l.obj[b]=[]),l.obj[b].push(q.parent));a[c].obj[b]&&"push"in a[c].obj[b]||(a[c].obj[b]=[]);a[c].obj[b].push(q)}}else if("Function"===g){h=p(c).get(b);try{m=d(h),e(b,m,c),a[c].indexElem.style._update[b]=d}catch(O){k.conf.viewErr&&console.log(O),k.messages.push(O)}}else{a:if(isFinite(d))m=0===d%1?d+"px":Math.floor(100*d)/100+"px";else{if("String"===r(d)&&(m=d.split(" "),0<m.length)){for(h=
0;h<m.length;h++)isFinite(m[h])&&(d=m[h],m[h]=0===d%1?d+"px":Math.floor(100*d)/100+"px");m=m.join(" ");break a}m=d}a[c].indexElem.style[b]=m;a[c].obj[b]=m}}}else if(c=r(b),"Object"===c?h=Object.keys(b).length:"Function"===c&&(q=b()),"Array"===c||"Function"===c&&"Array"===r(q))for(c="Array"===c?b:q,m=0;m<c.length;m++)if(b=p(m),1===b.e.length)b.set(c[m]);else break;else for(m=0;m<a.length;m++)if("Object"===c&&0<h)for(g in b)e(g,b[g],m);else if("Function"===c){for(g in q)e(g,q[g],m);a[m].indexElem._update=
b}else e(b,d,m);return this}function n(b,d){var c={},e,m,f,g=b;b===k.expType.obj&&(b=k.expType.object);if(b===k.expType.normal||b===k.expType.min)b=k.expType.array;d||(d=[]);for(e=0;e<a.length;e++)if(!(0<=d.indexOf(a[e]))){if(a[e].type===k.type.namespace||a[e].type===k.type.import||a[e].type===k.type.charset)var h=a[e].obj;else for(f in h=Object.assign({},a[e].obj),a[e].obj)if("object"===typeof a[e].obj[f]&&"length"in a[e].obj[f])if(b===k.expType.notMDObject||b===k.expType.array)h[f]=null,delete h[f];
else{h[f]=[];for(m=0;m<a[e].obj[f].length;m++)if(!(0<=d.indexOf(a[e].obj[f][m]))){var l=t([a[e].obj[f][m]]);l=l.export(b,d)[a[e].obj[f][m].selector];d.push(a[e].obj[f][m]);!l||0>=Object.keys(l).length||(h[f][m]=l)}0===h[f].length?delete h[f]:1===h[f].length&&(h[f]=h[f][0])}a[e].children&&(l=v(null,a[e].children),h=Object.assign(l.export(b,d),h));0>=Object.keys(h).length||(b===k.expType.array?(l=L.indexOf(a[e]),l="@charset"===a[e].selector?0:"@import"===a[e].selector?l+1E5:"@namespace"===a[e].selector?
l+2E5:"@font-face"===a[e].selector?l+3E5:l+1E6,c[l]={},c[l][a[e].selector]=h):c[a[e].selector]?("object"===typeof c[a[e].selector]&&"length"in c[a[e].selector]||(c[a[e].selector]=[c[a[e].selector]]),c[a[e].selector].push(h)):c[a[e].selector]=h,d.push(a[e]))}if(b===k.expType.array)return c=Object.values(c),b===g?c:w(c,g===k.expType.min);b={};c["@charset"]&&(b["@charset"]=c["@charset"]);c["@import"]&&(b["@import"]=c["@import"]);c["@namespace"]&&(b["@namespace"]=c["@namespace"]);c["@font-face"]&&(b["@font-face"]=
c["@font-face"]);if(l=0<Object.keys(b).length)for(e in c)b[e]||(b[e]=c[e]);return l?b:c}function l(){var b,c;for(b=0;b<a.length;b++){if(!1!==a[b].indexElem._update){var d=a[b].indexElem._update();for(c in d)e(c,d[c],b)}if(a[b].children)v(null,a[b].children).update();else if(a[b].indexElem.style)for(c in a[b].indexElem.style._update)e(c,a[b].indexElem.style._update[c](),b)}return this}function g(b){var c;if("undefined"===typeof b)for(c=0;c<a.length;c++)a[c].children&&v(null,a[c].children).delete(b),
I(a[c].indexElem),N(a[c].selector,a[c].parent?a[c].parent:null,a[c]);else for(c=0;c<a.length;c++)a[c].indexElem.style[b]="",a[c].children&&v(null,a[c].children).delete(b);return this}function p(b){0>b&&(b=a.length+b);return t(a[b]?[a[b]]:[])}var h=function(a,b){var c,d,e=[];f();for(c=0;c<h.e.length;c++)if(h.e[c].children){var g=y(a,b,h.e[c].children,!0);for(d=0;d<g.length;d++)e.push(g[d])}return t(e,a,null,h.e)};h.e=a;h.eLength=a.length;J(h,{set:function(a,b,c){return e(a,b,c)},get:function(b,c){if(b){var d=
[],e="",f;c=!!c;for(f=0;f<a.length;f++){var g="";a[f].obj[b]&&(g=a[f].obj[b],"Array"===r(g)&&(g=t(g),g=g.export(k.expType.object)));g&&""!==g||(g=a[f].indexElem.style[b]);g&&""!==g||(g=(g=a[f].indexElem.cssText.match(new RegExp(b+"s*:s*(.+?);")))?g[1].trim():"");g&&(e=g,c&&d.push(e))}b=c?d:e}else b=n(k.expType.object);return b},update:function(){return l()},"delete":function(a){return g(a)},"export":function(a){return n(a)},parse:function(a){return n(a?k.expType.min:k.expType.normal)},pos:function(a){return p(a)},
first:function(){return p(0)},last:function(){return p(-1)}});return h}var B={},L=[],G;var k=function(a,b){try{return y(a,b)}catch(c){k.conf.viewErr&&console.log(c),k.messages.push(c)}};J(k,{version:"1.0b",init:function(a){a="length"in a?a:[a];for(var b=0;b<a.length;b++)if("sheet"in a[b]&&(a[b]=a[b].sheet),"cssRules"in a[b]){var c=(a[b].ownerNode.getAttribute("data-cssc-ignore")||"").toLowerCase();if("true"!==c&&"1"!==c)try{K(a[b].cssRules,null)}catch(d){k.conf.viewErr&&console.log('Cannot init CSS from "'+
a[b].href+'"'),k.messages.push('Cannot init CSS from "'+a[b].href+'"')}}},"import":function(a,b){return z(a)},"export":function(a){return y().export(a)},parse:function(a){return y().parse(a)},update:function(a){return y(a).update()},parseVars:function(a,b){return F(a,b)},objFromCss:function(a){return H(a)},cssFromObj:function(a,b,c){return w(a,b,c)},conf:x({styleId:"cssc-style",viewErr:!0}),type:x({rule:1,charset:2,"import":3,media:4,fontFace:5,page:6,keyframes:7,keyframe:8,namespace:10,counterStyle:11,
supports:12,fontFeatureValues:14,viewport:15,names:x({1:"rule",2:"charset",3:"import",4:"media",5:"font-face",6:"page",7:"keyframes",8:"keyframe",10:"namespace",11:"counter-style",12:"supports",14:"font-feature-values",15:"viewport"})}),expType:x({normal:"css",min:"minCss",obj:"obj",object:"object",notMDObject:"objNMD",array:"array"}),events:x({beforeChange:"beforechange",change:"change",beforeSet:"beforeset",set:"set",beforeCreate:"beforecreate",create:"create",beforeDelete:"beforedelete","delete":"delete",
beforeDestroy:"beforedestroy",destroy:"destroy"})});k.messages=[];k.vars={};return k}();
