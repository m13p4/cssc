/* CSSC.js | @version 1.0b |  m13p4 */
var CSSC=function(){function n(b,a,c){if(c)return Object.prototype.toString.call(b);c=Object.prototype.toString.call(b).replace(/(^\[.+\s|\]$)/g,"");"Number"===c&&(c=Math.floor(b)===b?"int":"float");return a?c.substr(0,a):c}function A(){if(Object.assign)return Object.assign.apply(null,arguments);var b,a;for(a=1;a<arguments.length;a++)for(b in arguments[a])arguments[0][b]=arguments[a][b];return arguments[0]}function H(b,a){var c;if(Object.defineProperty)for(c in a)Object.defineProperty(b,c,{enumerable:!0,
value:a[c]});else for(c in a)b[c]=a[c]}function B(b){if(Object.freeze)return Object.freeze(b);if(Object.defineProperty){var a={},c;for(c in b)Object.defineProperty(a,c,{enumerable:!0,value:b[c]});b=a}Object.preventExtensions&&Object.preventExtensions(b);return b}function I(b){if(b.match(/^@(namespace|import|charset)/))return b.replace(/(^@(namespace|import|charset)\s*|\s*;\s*$)/g,"");var a=b.replace(/(^.*?{\s*|\s*}\s*$)/g,"");b=a.split(";");var c={};if(""!==a)for(a=0;a<b.length;a++)if(""!==b[a]){var d=
b[a].split(":");c[d[0].trim()]=d.slice(1).join(":").trim()}return c}function w(b,a,c,d,g){var e=Array((parseInt(c)||2)+1).join(" "),h="",f,l=n(b,1);d=d||"";if("S"===l)return b;if("A"===l)for(l=0;l<b.length;l++)h+=w(b[l],a,c,d,!0);else for(f in b){var k=b[f];l=n(b[f],1);if("O"===l||"A"===l)if(g&&"A"===l){var m=w(b[f],a,c,d+e,g);""!==m&&(h=a?h+(f.replace(/\s*(,|:)\s*/g,"$1")+"{"+m+"}"):h+(d+f.replace(/\s*,\s*/g,",\n"+d)+" {\n"+m+d+"}\n"))}else for("O"===l&&(k=[b[f]]),l=0;l<k.length;l++)"@namespace"===
f||"@import"===f||"@charset"===f?h+=f+" "+k[l]+";"+(a?"":"\n"):(m=w(k[l],a,c,d+e,g),""!==m&&(h=a?h+(f.replace(/\s*(,|:)\s*/g,"$1")+"{"+m+"}"):h+(d+f.replace(/\s*,\s*/g,",\n"+d)+" {\n"+m+d+"}\n")));else h="@namespace"===f||"@import"===f||"@charset"===f?h+(f+" "+k+";"+(a?"":"\n")):a?h+(f+":"+k.trim().replace(/\s*,\s*/g,",")+";"):h+((d.length<e.length?e:d)+f+": "+k+";\n")}return h}function J(b){b=b.trim();if("@"!==b.charAt(0))return 1;b=b.substr(1);var a=b.indexOf(" ");0<=a&&(b=b.substr(0,a));a=b;if(0<=
b.indexOf("-")){b=b.split("-");var c;a=b[0];for(c=1;c<b.length;c++)a+=b[c].charAt(0).toUpperCase()+b[c].substr(1)}return a in C?C[a]:-1}function D(b,a){"@"===a.charAt(0)&&"@"===b.charAt(0)&&(a=a.substr(1));a="/"===a.charAt(0)?a.substr(1):","===a.charAt(0)?", "+a.substr(1).trim():" "+a;if(0<=b.indexOf(",")||0<a.indexOf(",")){b=b.split(",");var c,d="",g=a.split(",");if(","!==a.charAt(0))for(c=0;c<b.length;c++)for(a=0;a<g.length;a++)d+=b[c]+g[a]+", ";else for(c=0;c<b.length;c++)d+=b[c]+a+", ";return d.replace(/,+\s*$/,
"")}return b+a}function K(b){var a=b.parentRule?b.parentRule:b.parentStyleSheet,c;for(c=0;c<a.cssRules.length;c++)a.cssRules[c]===b&&a.deleteRule(c)}function E(b,a){a?"A"!==n(a,1)&&(a=[a]):a=[{}];b||(b="");for(var c=b.lastIndexOf("$"),d,g=0,e,h,f,l,k,m;0<=c&&100>g;){g++;e=null;l=b.substr(c+1);d=l.search(/[^\w\.]/);d=0>d?b.length:d+c;k=b.substr(c+1,d-c);m=k.split(".");for(h=0;h<m.length;h++)if(!(1>m[h].length)){f=n(e,1);if(0===h)for(f=a.length-1;0<=f;f--){if(m[h]in a[f]){e=a[f][m[h]];break}}else if(null!==
e&&f.match(/[OA]/)&&m[h]in e)e=e[m[h]];else if("S"===f&&m[h].match(/^[0-9]+$/))e=e.charAt(m[h]);else{e="$"+k;break}if("F"===n(e,1)){if("("===b.charAt(d+1)){d++;f=l=d;do f=b.indexOf("(",f+1),d=b.indexOf(")",d+1);while(-1<f&&f<d);0>d&&(d=b.length);l=b.substr(l+1,d-l-1);l=l.trim().split(/\s*,\s*/);e=e.apply(null,l)}else e=e();if("."===b.charAt(d+1))for(d++,f=d,l=b.substr(d+1),d=l.search(/[^\w\.]/),l=l.substr(0,0>d?l.length:d),d=0>d?b.length:d+f,k=b.substr(c+1,d-c),l=l.split("."),f=0;f<l.length;f++)m.push(l[f])}}b=
b.substr(0,c)+e+b.substr(d+1);d="$"+k===e?c:d+(e.length-1);if(0>--d)break;c=b.lastIndexOf("$",d)}return b}function L(b,a,c){for(var d=0;d<a.length;d++)a[d]&&a[d].parentStyleSheet&&a[d].parentStyleSheet.ownerNode&&a[d].parentStyleSheet.ownerNode.id===b[4].styleId&&y(b,a[d],c)}function y(b,a,c,d){var g=a.cssText.substr(0,a.cssText.indexOf("{")).trim(),e=a.type,h=c?c.children:b[0];if(1!==e&&5!==e&&4!==e&&7!==e&&8!==e&&6!==e&&12!==e&&10!==e&&3!==e&&2!==e)console.log("unsuported type: "+e);else return 10===
e&&(g="@namespace"),3===e&&(g="@import"),2===e&&(g="@charset"),a._update=!1,1===e&&(a.style._update={}),b[2]++,b={indexElem:a,selector:g,csscSelector:d?d:g,children:!1,parent:c?c:!1,events:{},obj:{},type:e,p:b[2]},h[g]?(h[g].content[0].indexElem===a&&(console.log('Dublicate "'+g+'": '),console.log(Error().stack+"\n\n")),c=h[g].content.push(b)-1):(h[g]={type:e,content:[b],events:{}},c=0),4===e||7===e||12===e?(h[g].content[c].children={},L(a.cssRules,h[g].content[c])):h[g].content[c].obj=I(a.cssText),
b}function q(b,a,c,d,g){var e;if(!g&&!b[1]){if(document.getElementById(b[4].styleId)){for(e=0;10>e;e++)if(!document.getElementById(b[4].styleId+"-"+e)){b[4].styleId=b[4].styleId+"-"+e;break}if(document.getElementById(b[4].styleId))throw Error("cann not create new element..");}e=document.createElement("style");e.setAttribute("type","text/css");e.setAttribute("id",b[4].styleId);e.appendChild(document.createTextNode(""));document.head.appendChild(e);b[1]=e}e=g?g.indexElem:b[1].sheet;var h=e.cssRules.length,
f="";if(c){var l=n(c,1);if("O"===l)for(var k in c)"F"===n(c[k],1)?(d=c[k](),f+=k+":"+d+"; "):f+=k+":"+c[k]+"; ";else if("F"===l)for(k in d=c(),d)f+=k+":"+d[k]+"; ";else f=c+":"+d+";"}d=a+"{"+f+"}";l=!1;if("@namespace"===a||"@import"===a||"@charset"===a)d=a+" "+c;try{"insertRule"in e?e.insertRule(d,h):"appendRule"in e?e.appendRule(d,h):"addRule"in e&&e.addRule(a,f,h),l=y(b,e.cssRules[h],g,a)}catch(m){c=(g?'"'+g.selector+'" > ':"")+'"'+a+'" -> '+m,b[4].viewErr&&console.log(c),u.push(c)}return l?l:y(b,
{csscSelector:a,cssText:d,parent:g||!1,type:J(a),placeholder:!0,cssRules:{},style:{}},g,k)}function M(b,a,c){if(b&&b[a]){var d=c?b[a].content.indexOf(c):-1;c?0<=d&&(b[a].content.splice(d,1),0>=b[a].content.length&&delete b[a]):delete b[a]}}function v(b,a,c){var d=n(a,1),g="A"===n(b,1)?b[0]:b;if("S"===d)return c?g[a]?g[a].content:[]:r(b,g[a]?g[a].content:[],a);if("R"===d){d=[];for(var e in g)if(e.match(a))for(h=0;h<g[e].content.length;h++)d.push(g[e].content[h]);return c?d:r(b,d,a)}if("A"===d){d=[];
var h;for(h=0;h<a.length;h++)if(g[a])for(e=0;e<g[a].content.length;e++)d.push(g[a].content[e]);return c?d:r(b,d,a)}if("N"===d||"U"===d){d=[];for(e in g)for(h=0;h<g[e].content.length;h++)d.push(g[e].content[h]);return c?d:r(b,d,a)}return null}function x(b,a,c){var d=n(a,1);return"S"===d||"R"===d||"A"===d||"N"===d||"U"===d?v(b,a,c):z(b,a)}function z(b,a,c,d){var g,e,h={};d||c||("@charset"in a&&(h["@charset"]=a["@charset"]),"@import"in a&&(h["@import"]=a["@import"]),"@namespace"in a&&(h["@namespace"]=
a["@namespace"]),"@font-face"in a&&(h["@font-face"]=a["@font-face"]),0<Object.keys(h).length&&z(b,h,c,!0));for(f in a)if(!(f in h)){d="A"===n(a[f],1)?a[f]:[a[f]];var f=E(f,b[3]);for(g=0;g<d.length;g++)if("@"===f.charAt(0))if("@font-face"===f||"@namespace"===f||"@import"===f||"@charset"===f)q(b,f,d[g],null,c);else{if(f.match(/^@(media|keyframes|supports)/)||c&&(4===c.type||7===c.type||12===c.type)){var l=f;(e=c)&&!f.match(/^@(media|keyframes|supports)/)&&(f=D(c.csscSelector,f),e=c.parent);var k=q(b,
f,null,null,e);k&&k.selector===k.csscSelector||(k&&(K(k.indexElem),M(k.parent?k.parent:b[0],k.selector,k)),e={csscSelector:f,cssText:f+" {}",parent:e||!1,placeholder:!0,type:J(f),cssRules:{}},k=y(b,e,e.parent,f));z(b,d[g],k);c&&(c.obj[l]||(c.obj[l]=[]),c.obj[l].push(k))}}else(k=q(b,f,null,null,c))&&p(b,[k],d[g])}}function p(b,a,c,d,g){if("i"===n(g,1))if(5===a[g].indexElem.type)b[4].viewErr&&console.log("@font-face rules are readonly."),u.push("@font-face rules are readonly.");else if(c=E(c,b[3]),
a[g].children)p(b,v(a[g].children,null,!0),c,d);else{var e=n(d,1);if("O"===e||"A"===e){var h="@"===c.charAt(0);e="O"===e?[d]:d;var f,l=D(a[g].selector,c);h&&(l=a[g].parent?D(a[g].parent.selector,c):c);for(f=0;f<e.length;f++)if(d=q(b,l,null,null,h?!1:a[g].parent)){if(h){var k=d;(d=q(b,a[g].selector,null,null,d))||(d=k)}p(b,[d],e[f]);h&&a[g].parent&&(k=a[g].parent,k.obj[c]&&"push"in k.obj[c]||(k.obj[c]=[]),k.obj[c].push(d.parent));a[g].obj[c]&&"push"in a[g].obj[c]||(a[g].obj[c]=[]);a[g].obj[c].push(d)}}else if("F"===
e){h=N(b,[a[g]],c);try{f=d(h),p(b,a,c,f,g),a[g].indexElem.style._update[c]=d}catch(m){b[4].viewErr&&console.log(m),u.push(m)}}else{a:if(isFinite(d))b=0===d%1?d+"px":Math.floor(100*d)/100+"px";else{if("S"===n(d,1)&&(b=d.split(" "),0<b.length)){for(d=0;d<b.length;d++)isFinite(b[d])&&(f=b[d],b[d]=0===f%1?f+"px":Math.floor(100*f)/100+"px");b=b.join(" ");break a}b=d}a[g].indexElem.style[c]=b;a[g].obj[c]=b}}else if(g=n(c,1),"O"===g?h=Object.keys(c).length:"F"===g&&(l=c()),"A"===g||"F"===g&&"A"===n(l,1))for(c=
"A"===g?c:l,f=0;f<c.length;f++)if(a.length>f)p(b,[a[f]],c[f]);else break;else for(f=0;f<a.length;f++)if("O"===g&&0<h)for(e in c)p(b,a,e,c[e],f);else if("F"===g){for(e in l)p(b,a,e,l[e],f);a[f].indexElem._update=c}else p(b,a,c,d,f)}function N(b,a,c,d){if(!c)return t(b,a,"object");var g=[],e="",h;d=!!d;for(h=0;h<a.length;h++){var f="";a[h].obj[c]&&(f=a[h].obj[c],"A"===n(f,1)&&(f=t(b,f,"object")));f&&""!==f||(f=a[h].indexElem.style[c]);f&&""!==f||(f=(f=a[h].indexElem.cssText.match(new RegExp(c+"s*:s*(.+?);")))?
f[1].trim():"");f&&(e=f,d&&g.push(e))}return d?g:e}function t(b,a,c,d){var g={},e,h,f,l=c;"obj"===c&&(c="object");if("css"===c||"min"===c)c="array";d||(d=[]);for(e=0;e<a.length;e++)if(!(0<=d.indexOf(a[e]))){if(10===a[e].type||3===a[e].type||2===a[e].type)var k=a[e].obj;else for(f in k=A({},a[e].obj),a[e].obj)if("A"===n(a[e].obj[f],1))if("objNMD"===c||"array"===c)k[f]=null,delete k[f];else{k[f]=[];for(h=0;h<a[e].obj[f].length;h++)if(!(0<=d.indexOf(a[e].obj[f][h]))){var m=t(b,[a[e].obj[f][h]],c,d)[a[e].obj[f][h].selector];
d.push(a[e].obj[f][h]);!m||0>=Object.keys(m).length||(k[f][h]=m)}0===k[f].length?delete k[f]:1===k[f].length&&(k[f]=k[f][0])}a[e].children&&(k=A(t(b,v(a[e].children,null,!0),c,d),k));0>=Object.keys(k).length||("array"===c?(g[a[e].p]={},g[a[e].p][a[e].selector]=k):g[a[e].selector]?("A"!==n(g[a[e].selector],1)&&(g[a[e].selector]=[g[a[e].selector]]),g[a[e].selector].push(k)):g[a[e].selector]=k,d.push(a[e]))}if("array"===c)return g=Object.values(g),c===l?g:w(g,"min"===l,b[4].tabLen);b={};g["@charset"]&&
(b["@charset"]=g["@charset"]);g["@import"]&&(b["@import"]=g["@import"]);g["@namespace"]&&(b["@namespace"]=g["@namespace"]);g["@font-face"]&&(b["@font-face"]=g["@font-face"]);if(m=0<Object.keys(b).length)for(e in g)b[e]||(b[e]=g[e]);return m?b:g}function O(b,a){var c,d;for(c=0;c<a.length;c++){if(!1!==a[c].indexElem._update){var g=a[c].indexElem._update();for(d in g)p(b,a,d,g[d],c)}if(a[c].children)O(b,v(a[c].children,null,!0));else if(a[c].indexElem.style)for(d in a[c].indexElem.style._update)p(b,
a,d,a[c].indexElem.style._update[d](),c)}}function F(b,a,c){var d;if(n(c,1).match(/[NU]/))for(d=0;d<a.length;d++)a[d].children&&F(b,v(a[d].children,null,!0)),K(a[d].indexElem),M(a[d].parent?a[d].parent:b,a[d].selector,a[d]);else for(d=0;d<a.length;d++)a[d].indexElem.style[c]="",a[d].children&&F(b,v(a[d].children,null,!0),c)}function G(b,a,c,d,g){0>c&&(c+=a.length);return a[c]?r(b,[a[c]],d,!1,a[c].parent?a[c].parent:!1):r(b,[],d,!1,g)}function P(b,a){for(var c=[],d=0;d<a.length;d++)a[d].indexElem&&
c.push(a[d].indexElem.placeholder?t(b,[a[d]],"obj"):a[d].indexElem);return c}function r(b,a,c,d,g){function e(){if(0>=a.length&&!d&&"S"===n(c,1)){var f,e=[],k,m;if(g)for(k=0;k<g.length;k++){if(f=q(c,null,null,g[k]))for(m=0;m<f.content.length;m++)e.push(f.content[m])}else if(f=q(c,null,null))e=f.content;a=e;h.e=P(b,a);h.selector=1===a.length?a[0].selector:c}}var h=function(c){var d,f,g=[];e();for(d=0;d<a.length;d++)if(a[d].children){var h=x(a[d].children,c,!0);for(f=0;f<h.length;f++)g.push(h[f])}return r(b,
g,c,null,a)};h.e=P(b,a);h.selector=1===a.length?a[0].selector:c;H(h,{set:function(c,d,g){e();p(b,a,c,d,g);return this},get:function(c,d){return N(b,a,c,d)},update:function(){O(b,a);return this},"delete":function(c){F(b,a,c);return this},"export":function(c){return t(b,a,c)},parse:function(c){return t(b,a,c?"min":"css")},pos:function(d){return G(b,a,d,c,g)},first:function(){return G(b,a,0,c,g)},last:function(){return G(b,a,-1,c,g)}});return h}function Q(){var b=[{},!1,0,[],{}],a=function(a){try{return x(b,
a)}catch(d){b[4].viewErr&&console.log(d),u.push(d)}};H(a,{version:"1.0b",init:function(a){a="length"in a?a:[a];for(var c=0;c<a.length;c++)if("sheet"in a[c]&&(a[c]=a[c].sheet),"cssRules"in a[c]){var g=(a[c].ownerNode.getAttribute("data-cssc-ignore")||"").toLowerCase();if("true"!==g&&"1"!==g)try{L(b,a[c].cssRules,null)}catch(e){b[4].viewErr&&console.log('Cannot init CSS from "'+a[c].href+'"'),u.push('Cannot init CSS from "'+a[c].href+'"')}}},"import":function(a){return z(b,a)},"export":function(a){return x(b).export(a)},
parse:function(a){return x(b).parse(a)},update:function(a){return x(b,a).update()},"new":function(){return Q()},defineVars:function(a){b[3]=[a];return this},addVars:function(a){b[3].push(a);return this},getVars:function(){return b[3]},defineConf:function(a){b[4]=A(b[4],a);return this},setConf:function(a,d){b[4][a]=d;return this},getConf:function(a){return a?b[4][a]:b[4]},parseVars:function(a,d){return E(a,d?d:b[3])},objFromCss:function(a){return I(a)},cssFromObj:function(a,b,g){return w(a,b,g)},_conf:R,
type:C,exportType:S,messages:u});a.defineConf(R);return a}var C=B({rule:1,charset:2,"import":3,media:4,fontFace:5,page:6,keyframes:7,keyframe:8,namespace:10,counterStyle:11,supports:12,fontFeatureValues:14,viewport:15}),S=B({css:"css",min:"min",obj:"obj",object:"object",notMDObject:"objNMD",array:"array"}),R=B({styleId:"cssc-style",viewErr:!0,tabLen:2}),u=[];return Q()}();
