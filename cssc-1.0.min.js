/* CSSC.js | @version 1.0b |  m13p4 */
var CSSC=function(){var z;return function(n,M){var v={},A=!1,d=null,t=function(a,b){return b?Object.prototype.toString.call(a):Object.prototype.toString.call(a).replace(/(^\[.+\s|\]$)/g,"")},G=function(a,b,k){var f="",c;b=b||"";if("String"===t(a))return a;for(c in a){var h=a[c];var e=t(a[c]);if("Object"===e||"Array"===e)for("Object"===e&&(h=[a[c]]),e=0;e<h.length;e++)if("@namespace"===c||"@import"===c||"@charset"===c)f+=c+" "+h[e]+";"+(k===d.export.type.min?"":"\n");else{var g=G(h[e],b+"  ",k);""!==
g&&(f=k===d.export.type.min?f+(c+"{"+g+"}"):f+(b+c.replace(/\s*,\s*/g,",\n"+b)+" {\n"+g+b+"}\n"))}else f="@namespace"===c||"@import"===c||"@charset"===c?f+(c+" "+h+";"+(k===d.export.type.min?"":"\n")):k===d.export.type.min?f+(c+":"+h+";"):f+((2>b.length?"  ":b)+c+": "+h+";\n")}return f},B=function(a,b){return(a=a.match(new RegExp(b+"s*:s*(.+?);")))?a[1].trim():""},H=function(a,b){"@"===b.charAt(0)&&"@"===a.charAt(0)&&(b=b.substr(1));b="/"===b.charAt(0)?b.substr(1):","===b.charAt(0)?", "+b.substr(1).trim():
" "+b;if(0<=a.indexOf(",")||0<b.indexOf(",")){a=a.split(",");var d,f="",c=b.split(",");if(","!==b.charAt(0))for(d=0;d<a.length;d++)for(b=0;b<c.length;b++)f+=a[d]+c[b]+", ";else for(d=0;d<a.length;d++)f+=a[d]+b+", ";return f.replace(/,+\s*$/,"")}return a+b},I=function(a){var b=a.parentRule?a.parentRule:a.parentStyleSheet,d;for(d=0;d<b.cssRules.length;d++)b.cssRules[d]===a&&b.deleteRule(d)},D=function(){if(!A){if("cssRules"in n){var a=(n.ownerNode.getAttribute("data-cssc-ignore")||"").toLowerCase();
if("true"!==a&&"1"!==a)try{C(n.cssRules,null)}catch(k){d.conf.viewErr&&console.log('Cannot init CSS from "'+n.href+'"'),d.messages.push('Cannot init CSS from "'+n.href+'"')}}else if("length"in n)for(var b=0;b<n.length;b++)if(a=(n[b].ownerNode.getAttribute("data-cssc-ignore")||"").toLowerCase(),"true"!==a&&"1"!==a)try{C(n[b].cssRules,null)}catch(k){d.conf.viewErr&&console.log('Cannot init CSS from "'+n[b].href+'"'),d.messages.push('Cannot init CSS from "'+n[b].href+'"')}A=!0}},C=function(a,b){for(var k=
0;k<a.length;k++){var f=a[k];f&&f.parentStyleSheet&&f.parentStyleSheet.ownerNode&&f.parentStyleSheet.ownerNode.id===d.conf.styleId||y(a[k],b)}},y=function(a,b,k){var f=a.cssText.substr(0,a.cssText.indexOf("{")).trim(),c=a.type,h=b?b.children:v;if(c!==d.type.rule&&c!==d.type.fontFace&&c!==d.type.media&&c!==d.type.keyframes&&c!==d.type.keyframe&&c!==d.type.page&&c!==d.type.supports&&c!==d.type.namespace&&c!==d.type.import&&c!==d.type.charset)console.log("unsuported type: ["+c+"] - "+d.type.names[c]);
else{c===d.type.namespace&&(f="@namespace");c===d.type.import&&(f="@import");c===d.type.charset&&(f="@charset");a._update=!1;c===d.type.rule&&(a.style._update={});b={indexElem:a,selector:f,csscSelector:k?k:f,children:!1,parent:b?b:!1,events:{},obj:{},type:c};h[f]?(h[f].content[0].indexElem===a&&(console.log('Dublicate "'+f+'": '),console.log(Error().stack+"\n\n")),b=h[f].content.push(b)-1):(h[f]={type:c,content:[b],events:{}},b=0);if(c===d.type.media||c===d.type.keyframes||c===d.type.supports)h[f].content[b].children=
{},C(a.cssRules,h[f].content[b]);else{c=h[f].content[b];a=a.cssText;if(a.match(/^@(namespace|import|charset)/))a=a.replace(/(^@(namespace|import|charset)\s*|\s*;\s*$)/g,"");else{k=a.replace(/(^.*?{\s*|\s*}\s*$)/g,"");a=k.split(";");b={};if(""!==k)for(k=0;k<a.length;k++)if(""!==a[k]){var e=a[k].split(":");b[e[0].trim()]=e.slice(1).join(":").trim()}a=b}c.obj=a}return h[f]}},w=function(a,b,k,f){var c;if(!f&&!z){if(document.getElementById(d.conf.styleId)){for(c=0;10>c;c++)if(!document.getElementById(d.conf.styleId+
"-"+c)){d.conf.styleId=d.conf.styleId+"-"+c;break}if(document.getElementById(d.conf.styleId))throw Error("cann not create new element..");}c=document.createElement("style");c.setAttribute("type","text/css");c.setAttribute("id",d.conf.styleId);c.appendChild(document.createTextNode(""));document.head.appendChild(c);z=c}c=f?f.indexElem:z.sheet;var h=c.cssRules.length,e="";if(b){var g=t(b);if("Object"===g)for(var r in b)"Function"===t(b[r])?(k=b[r](),e+=r+":"+k+"; "):e+=r+":"+b[r]+"; ";else if("Function"===
g)for(r in k=b(),k)e+=r+":"+k[r]+"; ";else e=b+":"+k+";"}try{k=a+"{"+e+"}";if("@namespace"===a||"@import"===a||"@charset"===a)k=a+" "+b;return"@charset"!==a?("insertRule"in c?c.insertRule(k,h):"appendRule"in c?c.appendRule(k,h):"addRule"in c&&c.addRule(a,e,h),y(c.cssRules[h],f,a)):y({csscSelector:a,cssText:k,parent:!1,type:d.type.charset,cssRules:{}},f,r)}catch(p){a=(f?'"'+f.selector+'" > ':"")+'"'+a+'" -> '+p,d.conf.viewErr&&console.log(a),d.messages.push(a)}return!1},J=function(a,b){A||D();b=b?
b:v;return b[a]?b[a]:null},K=function(a,b,d){b=b?b:v;if(b[a]){var f=d?b[a].content.indexOf(d):-1;d?0<=f&&(b[a].content.splice(f,1),0>=b[a].content.length&&delete b[a]):delete b[a]}},x=function(a,b,d){b=b?b:v;var f=t(a);if("String"===f)return b=J(a,b),d?b?b.content:[]:u(b?b.content:[],a);if("RegExp"===f){f=[];for(var c in b)if(c.match(a))for(h=0;h<b[c].content.length;h++)f.push(b[c].content[h]);return d?f:u(f,a)}if("Array"===f){f=[];var h;for(h=0;h<a.length;h++){var e=J(a[h],b);if(null!==e)for(c=0;c<
e.content.length;c++)f.push(e.content[c])}return d?f:u(f,a)}if("Null"===f||"Undefined"===f){f=[];for(c in b)for(h=0;h<b[c].content.length;h++)f.push(b[c].content[h]);return d?f:u(f,a)}return null},F=function(a,b,d,f){var c=t(a);if("String"===c||"RegExp"===c||"Array"===c||"Null"===c||"Undefined"===c)return a=x(a,d,f),b?a.has(b):a;E(a,null,d)},E=function(a,b){var k;for(e in a){var f="Array"===t(a[e])?a[e]:[a[e]];for(k=0;k<f.length;k++)if("@"===e.charAt(0))if("@font-face"===e||"@namespace"===e||"@import"===
e||"@charset"===e)w(e,f[k],null,b);else{if(e.match(/^@(media|keyframes|supports)/)||b&&(b.type===d.type.media||b.type===d.type.keyframes||b.type===d.type.supports)){var c=b;var h=e;if(b&&!h.match(/^@(media|keyframes|supports)/)){var e=H(b.csscSelector,e);c=b.parent}var g=w(e,null,null,c);if(!g||g.content[g.content.length-1].selector!==g.content[g.content.length-1].csscSelector){if(g){var r=g.content.length-1;I(g.content[r].indexElem);K(g.content[r].selector,g.content[r].parent,g.content[r])}g=e;r=
e+" {}";c=c||!1;var p=e;p=p.trim();if("@"!==p.charAt(0))var l=d.type.rule;else{p=p.substr(1);l=p.indexOf(" ");0<=l&&(p=p.substr(0,l));l=p;if(0<=p.indexOf("-")){var m=p.split("-");l=m[0];for(p=1;p<m.length;p++)l+=m[p].charAt(0).toUpperCase()+m[p].substr(1)}l=l in d.type?d.type[l]:-1}c={csscSelector:g,cssText:r,parent:c,type:l,cssRules:{}};g=y(c,c.parent,e)}E(f[k],g.content[g.content.length-1]);b&&(b.obj[h]||(b.obj[h]=[]),b.obj[h].push(g.content[g.content.length-1]))}}else if(g=w(e,null,null,b))h=u([g.content[g.content.length-
1]],e),h.set(f[k])}},u=function(a,b,k,f){var c=function(b,a){var g,h,e=[];for(g=0;g<c.e.length;g++)if(c.e[g].children){var d=F(b,a,c.e[g].children,!0);for(h=0;h<d.length;h++)e.push(d[h])}return u(e,b,null,c.e)};c.e=a;c.eLength=a.length;c.set=function(a,e,g){if("number"===typeof g){if(this.e[g].indexElem.type===d.type.fontFace)return d.conf.viewErr&&console.log('Element of Type "'+d.type.names[this.e[g].indexElem.type]+'" is readonly.'),d.messages.push('Element of Type "'+d.type.names[this.e[g].indexElem.type]+
'" is readonly.'),this;if(this.e[g].children)x(null,this.e[g].children).set(a,e);else{var c=t(e);if("Object"===c||"Array"===c){var h=H(this.e[g].selector,a);e="Object"===c?[e]:e;var l;for(l=0;l<e.length;l++)if(c=w(h,null,null,this.e[g].parent))u([c.content[c.content.length-1]],m).set(e[l]),this.e[g].obj[a]&&"push"in this.e[g].obj[a]||(this.e[g].obj[a]=[]),this.e[g].obj[a].push(c.content[c.content.length-1])}else if("Function"===c){var m=this.pos(g).get(a);try{l=e(m),this.set(a,l,g),this.e[g].indexElem.style._update[a]=
e}catch(L){d.conf.viewErr&&console.log(L),d.messages.push(L)}}else{if(isFinite(e))e=0===e%1?e+"px":Math.floor(100*e)/100+"px";else if("String"===t(e)&&(l=e.split(" "),0<l.length)){for(m=0;m<l.length;m++)isFinite(l[m])&&(e=l[m],l[m]=0===e%1?e+"px":Math.floor(100*e)/100+"px");e=l.join(" ")}this.e[g].indexElem.style[a]=e;this.e[g].obj[a]=e}}}else{var q;g=t(a);"Object"===g?h=Object.keys(a).length:"Function"===g&&(q=a());if(0>=this.e.length&&!k&&"String"===t(b)){var n=[];if(f)for(n=[],l=0;l<f.length;l++){if(c=
w(b,null,null,f[l].indexElem,f[l].children))for(m=0;m<c.content.length;m++)n.push(c.content[m])}else if(c=w(b,null,null))n=c.content;this.e=n;this.eLength=n.length}if("Array"===g||"Function"===g&&"Array"===t(q))for(g="Array"===g?a:q,l=0;l<g.length;l++)if(a=this.pos(l),1===a.e.length)a.set(g[l]);else break;else for(l=0;l<this.e.length;l++)if("Object"===g&&0<h)for(m in a)this.set(m,a[m],l);else if("Function"===g){for(m in q)this.set(m,q[m],l);this.e[l].indexElem._update=a}else this.set(a,e,l)}return this};
c.get=function(a,b){if(!a){a=this.export(d.export.type.object);for(e in a){if(c)return a;var c=e}return a[c]}var e=[];c="";var h;b=!!b;for(h=0;h<this.e.length;h++){var f="";this.e[h].obj[a]&&!this.e[h].obj[a].selector&&(f=this.e[h].obj[a]);f&&""!==f||(f=this.e[h].indexElem.style[a]);f&&""!==f||(f=B(this.e[h].indexElem.cssText,a));f&&(c=f,b&&e.push(c))}return b?e:c};c.has=function(a){var c=[];var g=t(a);if("String"===g){var d=a.split(":");for(g=0;g<this.e.length;g++){var h=B(this.e[g].indexElem.cssText,
d[0]);""!==h&&(!d[1]||d[1]&&d[1].replace(/ |;/g,"")===h)&&c.push(this.e[g])}}else if("Array"===g)for(var f=0;f<a.length;f++)for(d=a[f].split(":"),g=0;g<this.e.length;g++)h=B(this.e[g].indexElem.cssText,d[0]),""!==h&&(!d[1]||d[1]&&d[1].replace(/ |;/g,"")===h)&&c.push(this.e[g]);else if("RegExp"===g)for(g=0;g<this.e.length;g++)if(d=this.e[g].indexElem.cssText.match(/[\S]+:.+?;/g))for(f=0;f<d.length;f++)(h=d[f].match(a))&&c.push(this.e[g]);return u(c,b,!0)};c.update=function(){var a,b;for(a=0;a<this.e.length;a++){if(!1!==
this.e[a].indexElem._update){var c=this.e[a].indexElem._update();for(b in c)this.set(b,c[b],a)}if(this.e[a].children)x(null,this.e[a].children).update();else for(b in this.e[a].indexElem.style._update)c=this.e[a].indexElem.style._update[b](),this.set(b,c,a)}return this};c.delete=function(a){var b;if("undefined"===typeof a)for(b=0;b<this.e.length;b++){if(I(this.e[b].indexElem),K(this.e[b].selector,this.e[b].parent?this.e[b].parent:null,this.e[b]),this.e[b].children){var c=x(null,this.e[b].children);
c.delete(a)}}else for(b=0;b<this.e.length;b++)this.e[b].indexElem.style[a]="",this.e[b].children&&(c=x(null,this.e[b].children),c.delete(a));return this};c.export=function(a,b){var c={},f,e,h,k=a;a===d.export.type.obj&&(a=d.export.type.object);if(a===d.export.type.normal||a===d.export.type.min)a=d.export.type.notMDObject;b||(b=[]);for(e=0;e<this.e.length;e++)if(!(0<=b.indexOf(this.e[e]))){if(this.e[e].type===d.type.namespace||this.e[e].type===d.type.import||this.e[e].type===d.type.charset)var q=this.e[e].obj;
else for(h in q=Object.assign({},this.e[e].obj),this.e[e].obj)if("object"===typeof this.e[e].obj[h]&&"length"in this.e[e].obj[h])if(a===d.export.type.notMDObject)q[h]=null,delete q[h];else{q[h]=[];for(f=0;f<this.e[e].obj[h].length;f++){var n=u([this.e[e].obj[h][f]]);q[h][f]=n.export(a,b)[this.e[e].obj[h][f].selector];b.push(this.e[e].obj[h][f])}1===q[h].length&&(q[h]=q[h][0])}this.e[e].children?(f=x(null,this.e[e].children),c[this.e[e].selector]?("length"in c[this.e[e].selector]||(c[this.e[e].selector]=
[c[this.e[e].selector]]),c[this.e[e].selector].push(Object.assign(q,f.export(a,b)))):c[this.e[e].selector]=Object.assign(q,f.export(a,b))):c[this.e[e].selector]?("object"===typeof c[this.e[e].selector]&&"length"in c[this.e[e].selector]||(c[this.e[e].selector]=[c[this.e[e].selector]]),c[this.e[e].selector].push(q)):c[this.e[e].selector]=q}return k===d.export.type.normal||k===d.export.type.min?G(c,null,k):c};c.pos=function(a){return u(this.e[a]?[this.e[a]]:[])};c.first=function(){return this.pos(0)};
c.last=function(){return this.pos(this.e.length-1)};return c};d=function(a,b){try{return F(a,b)}catch(k){d.conf.viewErr&&console.log(k),d.messages.push(k)}};d.import=function(a){try{return E(a)}catch(b){d.conf.viewErr&&console.log(b),d.messages.push(b)}};d.export=function(a){return F().export(a)};d.update=function(a){if(a)a=d(a),a.update();else for(var b in v)a=u(v[b].content),a.update()};d.type={rule:1,charset:2,"import":3,media:4,fontFace:5,page:6,keyframes:7,keyframe:8,namespace:10,counterStyle:11,
supports:12,fontFeatureValues:14,names:{1:"rule",2:"charset",3:"import",4:"media",5:"font-face",6:"page",7:"keyframes",8:"keyframe",10:"namespace",11:"counter-style",12:"supports",14:"font-feature-values"}};d.events={beforeChange:"beforechange",change:"change",beforeSet:"beforeset",set:"set",beforeCreate:"beforecreate",create:"create",beforeDelete:"beforedelete","delete":"delete",beforeDestroy:"beforedestroy",destroy:"destroy"};d.export.type={normal:"css",min:"minCss",obj:"obj",object:"object",notMDObject:"objNMDO"};
d.conf={styleId:"cssc-style",viewErr:!0};d.messages=[];M?D():window.addEventListener("load",function(){D()});return d}(document.styleSheets,!0)}();
