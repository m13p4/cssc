/*
@version 1.0b
@author m13p4
@copyright Meliantchenkov Pavel
*/
var CSSC=function(){var y;return function(m,H){var u={},z=!1,e=null,B=function(){if(!z){if("cssRules"in m){var a=(m.ownerNode.getAttribute("data-cssc-ignore")||"").toLowerCase();if("true"!==a&&"1"!==a)try{A(m.cssRules,null)}catch(g){e.conf.viewErr&&console.log('Cannot init CSS from "'+m.href+'"'),e.messages.push('Cannot init CSS from "'+m.href+'"')}}else if("length"in m)for(var c=0;c<m.length;c++)if(a=(m[c].ownerNode.getAttribute("data-cssc-ignore")||"").toLowerCase(),"true"!==a&&"1"!==a)try{A(m[c].cssRules,
null)}catch(g){e.conf.viewErr&&console.log('Cannot init CSS from "'+m[c].href+'"'),e.messages.push('Cannot init CSS from "'+m[c].href+'"')}z=!0}},A=function(a,c){for(var e=0;e<a.length;e++)l.isElemInOwnNode(a[e])||D(a[e],c)},D=function(a,c,g){var d=a.cssText.substr(0,a.cssText.indexOf("{")).trim(),b=a.type,f=c?c.children:u;if(b!==e.ruleType.rule&&b!==e.ruleType.fontFace&&b!==e.ruleType.media&&b!==e.ruleType.keyframes&&b!==e.ruleType.keyframe&&b!==e.ruleType.page&&b!==e.ruleType.supports)console.log("unsuported type: ["+
b+"] - "+e.ruleType.names[b]);else return a._update=!1,b===e.ruleType.rule&&(a.style._update={}),c={indexElem:a,selector:d,csscSelector:g?g:d,children:!1,parent:c?c:!1,events:{},obj:{},type:b},f[d]?(f[d].content[0].indexElem===a&&(console.log('Dublicate "'+d+'": '),console.log(Error().stack+"\n\n")),c=f[d].content.push(c)-1):(f[d]={type:b,content:[c],events:{}},c=0),b===e.ruleType.media||b===e.ruleType.keyframes||b===e.ruleType.supports?(f[d].content[c].children={},A(a.cssRules,f[d].content[c])):
f[d].content[c].obj=l.objFromCssText(a.cssText),f[d]},t=function(a,c,g,d){d||y||l.createNewStyleElem();var b=d?d.indexElem:y.sheet;var f=b.cssRules.length,h="";if(c){var v=l.elemType(c);if("Object"===v)for(var r in c)"Function"===l.elemType(c[r])?(g=c[r](),h+=r+":"+g+"; "):h+=r+":"+c[r]+"; ";else if("Function"===v)for(r in g=c(),g)h+=r+":"+g[r]+"; ";else h=c+":"+g+";"}try{return"insertRule"in b?b.insertRule(a+"{"+h+"}",f):"appendRule"in b?b.appendRule(a+"{"+h+"}",f):"addRule"in b&&b.addRule(a,h,f),
D(b.cssRules[f],d,a)}catch(E){e.conf.viewErr&&console.log('"'+a+'" -> '+E),e.messages.push('"'+a+'" -> '+E)}return!1},F=function(a,c){z||B();c=c?c:u;return c[a]?c[a]:null},w=function(a,c,e){c=c?c:u;var d=l.elemType(a);if("String"===d)return c=F(a,c),e?c?c.content:[]:q(c?c.content:[],a);if("RegExp"===d){d=[];for(var b in c)if(b.match(a))for(f=0;f<c[b].content.length;f++)d.push(c[b].content[f]);return e?d:q(d,a)}if("Array"===d){d=[];var f;for(f=0;f<a.length;f++){var h=F(a[f],c);if(null!==h)for(b=0;b<
h.content.length;b++)d.push(h.content[b])}return e?d:q(d,a)}if("Null"===d||"Undefined"===d){d=[];for(b in c)for(f=0;f<c[b].content.length;f++)d.push(c[b].content[f]);return e?d:q(d,a)}return null},C=function(a,c,e,d){var b=l.elemType(a);if("String"===b||"RegExp"===b||"Array"===b||"Null"===b||"Undefined"===b)return a=w(a,e,d),c?a.has(c):a;x(a,null,e)},x=function(a,c){var g,d,b;for(d in a){var f="Array"===l.elemType(a[d])?a[d]:[a[d]];for(b=0;b<f.length;b++)if("@"===d.charAt(0))if("@font-face"===d)t(d,
f[b],null,c);else if(d.match(/^@(media|keyframes|supports)/))if(g=d.match(/^@(media|keyframes|supports)$/)?!1:t(d,null,null,c)){var h=g.content.length-1;x(f[b],g.content[h])}else g={csscSelector:d,parent:c,type:null},d.match(/^@media/)?g.type=e.ruleType.media:d.match(/^@keyframes/)?g.type=e.ruleType.keyframes:d.match(/^@suports/)&&(g.type=e.ruleType.supports),x(f[b],g);else c&&(c.type===e.ruleType.media||c.type===e.ruleType.keyframes||c.type===e.ruleType.supports)&&(g=c.csscSelector+" "+d.substr(1),
g=t(g,null,null,c.parent))&&(h=g.content.length-1,x(f[b],g.content[h]));else if(g=t(d,null,null,c))g=q([g.content[g.content.length-1]],d),g.set(f[b])}},q=function(a,c,g,d){var b=function(a,c){var f,h,e=[];for(f=0;f<b.e.length;f++)if(b.e[f].children){var d=C(a,c,b.e[f].children,!0);for(h=0;h<d.length;h++)e.push(d[h])}return q(e,a,null,b.e)};b.e=a;b.eLength=a.length;b.set=function(a,h,b){if("number"===typeof b){if(this.e[b].indexElem.type===e.ruleType.fontFace)return e.conf.viewErr&&console.log('Element of Type "'+
e.ruleType.names[this.e[b].indexElem.type]+'" is readonly.'),e.messages.push('Element of Type "'+e.ruleType.names[this.e[b].indexElem.type]+'" is readonly.'),this;if(this.e[b].children)w(null,this.e[b].children).set(a,h);else{var f=l.elemType(h);if("Object"===f||"Array"===f){var v=this.e[b].selector+("/"===a.charAt(0)?"":" ")+a.replace(/^\//,"");h="Object"===f?[h]:h;var k;for(k=0;k<h.length;k++)if(f=t(v,null,null,this.e[b].parent))q([f.content[f.content.length-1]],p).set(h[k]),this.e[b].obj[a]&&"push"in
this.e[b].obj[a]||(this.e[b].obj[a]=[]),this.e[b].obj[a].push(f.content[f.content.length-1])}else if("Function"===f){var p=this.pos(b).get(a);try{k=h(p),this.set(a,k,b),this.e[b].indexElem.style._update[a]=h}catch(G){e.conf.viewErr&&console.log(G),e.messages.push(G)}}else h=l.parseValue(h),this.e[b].indexElem.style[a]=h,this.e[b].obj[a]=h}}else{var n;b=l.elemType(a);"Object"===b?v=Object.keys(a).length:"Function"===b&&(n=a());if(0>=this.e.length&&!g&&"String"===l.elemType(c)){var m=[];if(d)for(m=
[],k=0;k<d.length;k++){if(f=t(c,null,null,d[k].indexElem,d[k].children))for(p=0;p<f.content.length;p++)m.push(f.content[p])}else if(f=t(c,null,null))m=f.content;this.e=m;this.eLength=m.length}if("Array"===b||"Function"===b&&"Array"===l.elemType(n))for(h="Array"===b?a:n,k=0;k<h.length;k++)if(a=this.pos(k),1===a.e.length)a.set(h[k]);else break;else for(k=0;k<this.e.length;k++)if("Object"===b&&0<v)for(p in a)this.set(p,a[p],k);else if("Function"===b){for(p in n)this.set(p,n[p],k);this.e[k].indexElem._update=
a}else this.set(a,h,k)}return this};b.get=function(a,c){if(!a)return this.export(e.export.type.object);var b=[],f="",h;c=!!c;for(h=0;h<this.e.length;h++){var d="";this.e[h].obj[a]&&!this.e[h].obj[a].selector&&(d=this.e[h].obj[a]);d&&""!==d||(d=this.e[h].indexElem.style[a]);d&&""!==d||(d=l.findPropInCssText(this.e[h].indexElem.cssText,a));d&&(f=d,c&&b.push(f))}return c?b:f};b.has=function(a){var b=[];var f=l.elemType(a);if("String"===f){var d=a.split(":");for(f=0;f<this.e.length;f++){var e=l.findPropInCssText(this.e[f].indexElem.cssText,
d[0]);""!==e&&(!d[1]||d[1]&&d[1].replace(/ |;/g,"")===e)&&b.push(this.e[f])}}else if("Array"===f)for(var g=0;g<a.length;g++)for(d=a[g].split(":"),f=0;f<this.e.length;f++)e=l.findPropInCssText(this.e[f].indexElem.cssText,d[0]),""!==e&&(!d[1]||d[1]&&d[1].replace(/ |;/g,"")===e)&&b.push(this.e[f]);else if("RegExp"===f)for(f=0;f<this.e.length;f++)if(d=this.e[f].indexElem.cssText.match(/[\S]+:.+?;/g))for(g=0;g<d.length;g++)(e=d[g].match(a))&&b.push(this.e[f]);return q(b,c,!0)};b.update=function(){var a,
c;for(a=0;a<this.e.length;a++){if(!1!==this.e[a].indexElem._update){var b=this.e[a].indexElem._update();for(c in b)this.set(c,b[c],a)}if(this.e[a].children)w(null,this.e[a].children).update();else for(c in this.e[a].indexElem.style._update)b=this.e[a].indexElem.style._update[c](),this.set(c,b,a)}return this};b.delete=function(a){var b;if("undefined"===typeof a)for(b=0;b<this.e.length;b++){this.e[b].indexElem.parentRule?this.e[b].indexElem.parentRule.deleteRule(this.e[b]):this.e[b].indexElem.parentStyleSheet.deleteRule(this.e[b]);
var d=this.e[b].parent?this.e[b].parent:null;d=d?d:u;d[c]&&delete d[c];this.e[b].children&&(d=w(null,this.e[b].children),d.delete(a))}else for(b=0;b<this.e.length;b++)this.e[b].indexElem.style[a]="",this.e[b].children&&(d=w(null,this.e[b].children),d.delete(a));return this};b.export=function(a,b){var c={},d,f,g,h=a;a===e.export.type.obj&&(a=e.export.type.object);if(a===e.export.type.normal||a===e.export.type.min)a=e.export.type.notMDObject;b||(b=[]);for(d=0;d<this.e.length;d++)if(!(0<=b.indexOf(this.e[d]))){var n=
Object.assign({},this.e[d].obj);for(g in this.e[d].obj)if("object"===typeof this.e[d].obj[g]&&"length"in this.e[d].obj[g])if(a===e.export.type.notMDObject)n[g]=null,delete n[g];else{n[g]=[];for(f=0;f<this.e[d].obj[g].length;f++){var m=q([this.e[d].obj[g][f]]);n[g][f]=m.export(a,b)[this.e[d].obj[g][f].selector];b.push(this.e[d].obj[g][f])}1===n[g].length&&(n[g]=n[g][0])}this.e[d].children?(n=w(null,this.e[d].children),c[this.e[d].selector]?("length"in c[this.e[d].selector]||(c[this.e[d].selector]=
[c[this.e[d].selector]]),c[this.e[d].selector].push(n.export(a,b))):c[this.e[d].selector]=n.export(a,b)):c[this.e[d].selector]?("length"in c[this.e[d].selector]||(c[this.e[d].selector]=[c[this.e[d].selector]]),c[this.e[d].selector].push(n)):c[this.e[d].selector]=n}return h===e.export.type.normal||h===e.export.type.min?l.cssTextFromObj(c,null,h):c};b.pos=function(a){return q(this.e[a]?[this.e[a]]:[])};b.first=function(){return this.pos(0)};b.last=function(){return this.pos(this.e.length-1)};return b},
l={elemType:function(a,c){return c?Object.prototype.toString.call(a):Object.prototype.toString.call(a).replace(/(^\[.+\s|\]$)/g,"")},createNewStyleElem:function(){if(document.getElementById(e.conf.styleId)){for(var a=0;10>a;a++)if(!document.getElementById(e.conf.styleId+"-"+a)){e.conf.styleId=e.conf.styleId+"-"+a;break}if(document.getElementById(e.conf.styleId))throw Error("cann not create new element..");}a=document.createElement("style");a.setAttribute("type","text/css");a.setAttribute("id",e.conf.styleId);
a.appendChild(document.createTextNode(""));document.head.appendChild(a);y=a},isElemInOwnNode:function(a){return a&&!!a.parentStyleSheet&&!!a.parentStyleSheet.ownerNode&&a.parentStyleSheet.ownerNode.id===e.conf.styleId},parseValue:function(a){if(isFinite(a))return 0===a%1?a+"px":Math.floor(100*a)/100+"px";if("String"===l.elemType(a)){var c=a.split(" ");if(0<c.length){for(var e=0;e<c.length;e++)isFinite(c[e])&&(a=c[e],c[e]=0===a%1?a+"px":Math.floor(100*a)/100+"px");return c.join(" ")}}return a},objFromCssText:function(a){var c=
a.replace(/(^.*?{\s*|\s*}\s*$)/g,"");a=c.split(";");var e={};if(""!==c)for(c=0;c<a.length;c++)if(""!==a[c]){var d=a[c].split(":");e[d[0].trim()]=d.slice(1).join(":").trim()}return e},cssTextFromObj:function(a,c,g){var d="",b;c=c||"";for(b in a){var f=l.elemType(a[b]);if("Object"===f){var h=l.cssTextFromObj(a[b],c+"    ",g);""!==h&&(d=g===e.export.type.min?d+(b+"{"+h+"}"):d+(c+b+" {\n"+h+c+"}\n"))}else if("Array"===f)for(f=0;f<a[b].length;f++)h=l.cssTextFromObj(a[b][f],c+"    ",g),""!==h&&(d=g===e.export.type.min?
d+(b+"{"+h+"}"):d+(c+b+" {\n"+h+c+"}\n"));else d=g===e.export.type.min?d+(b+":"+a[b]+";"):d+((4>c.length?"    ":c)+b+": "+a[b]+";\n")}return d},findPropInCssText:function(a,c){return(a=a.match(new RegExp(c+"s*:s*(.+?);")))?a[1].trim():""}};e=function(a,c){try{return C(a,c)}catch(g){e.conf.viewErr&&console.log(g),e.messages.push(g)}};e.import=function(a){try{return x(a)}catch(c){e.conf.viewErr&&console.log(c),e.messages.push(c)}};e.export=function(a){return C().export(a)};e.update=function(a){if(a)a=
e(a),a.update();else for(var c in u)a=q(u[c].content),a.update()};e.ruleType={rule:1,charset:2,"import":3,media:4,fontFace:5,page:6,keyframes:7,keyframe:8,namespace:10,counterStyle:11,supports:12,fontFeatureValues:14,names:{1:"rule",2:"charset",3:"import",4:"media",5:"fontFace",6:"page",7:"keyframes",8:"keyframe",10:"namespace",11:"counterStyle",12:"supports",14:"fontFeatureValues"}};e.events={beforeChange:"beforechange",change:"change",beforeSet:"beforeset",set:"set",beforeCreate:"beforecreate",
create:"create",beforeDelete:"beforedelete","delete":"delete",beforeDestroy:"beforedestroy",destroy:"destroy"};e.export.type={normal:"css",min:"minCss",obj:"obj",object:"object",notMDObject:"objNMDO"};e.conf={styleId:"cssc-style",viewErr:!0};e.messages=[];H?B():window.addEventListener("load",function(){B()});return e}(document.styleSheets,!0)}();
