/* CSSC.js | @version 1.0b |  m13p4 */
var CSSC=function(){var y;return function(n,M){var u={},z=!1,d=null,r=function(a,b){return b?Object.prototype.toString.call(a):Object.prototype.toString.call(a).replace(/(^\[.+\s|\]$)/g,"")},G=function(a,b,l){var e="",c;b=b||"";if("String"===r(a))return a;for(c in a){var k=a[c];var f=r(a[c]);if("Object"===f||"Array"===f)for("Object"===f&&(k=[a[c]]),f=0;f<k.length;f++)if("@namespace"===c||"@import"===c)e+=c+" "+k[f]+";"+(l===d.export.type.min?"":"\n");else{var g=G(k[f],b+"  ",l);""!==g&&(e=l===d.export.type.min?
e+(c+"{"+g+"}"):e+(b+c.replace(/\s*,\s*/g,",\n"+b)+" {\n"+g+b+"}\n"))}else e="@namespace"===c||"@import"===c?e+(c+" "+k+";"+(l===d.export.type.min?"":"\n")):l===d.export.type.min?e+(c+":"+k+";"):e+((2>b.length?"  ":b)+c+": "+k+";\n")}return e},A=function(a,b){return(a=a.match(new RegExp(b+"s*:s*(.+?);")))?a[1].trim():""},H=function(a,b){"@"===b.charAt(0)&&"@"===a.charAt(0)&&(b=b.substr(1));b="/"===b.charAt(0)?b.substr(1):","===b.charAt(0)?", "+b.substr(1).trim():" "+b;if(0<=a.indexOf(",")||0<b.indexOf(",")){a=
a.split(",");var d,e="",c=b.split(",");if(","!==b.charAt(0))for(d=0;d<a.length;d++)for(b=0;b<c.length;b++)e+=a[d]+c[b]+", ";else for(d=0;d<a.length;d++)e+=a[d]+b+", ";return e.replace(/,+\s*$/,"")}return a+b},I=function(a){var b=a.parentRule?a.parentRule:a.parentStyleSheet,d;for(d=0;d<b.cssRules.length;d++)b.cssRules[d]===a&&b.deleteRule(d)},C=function(){if(!z){if("cssRules"in n){var a=(n.ownerNode.getAttribute("data-cssc-ignore")||"").toLowerCase();if("true"!==a&&"1"!==a)try{B(n.cssRules,null)}catch(l){d.conf.viewErr&&
console.log('Cannot init CSS from "'+n.href+'"'),d.messages.push('Cannot init CSS from "'+n.href+'"')}}else if("length"in n)for(var b=0;b<n.length;b++)if(a=(n[b].ownerNode.getAttribute("data-cssc-ignore")||"").toLowerCase(),"true"!==a&&"1"!==a)try{B(n[b].cssRules,null)}catch(l){d.conf.viewErr&&console.log('Cannot init CSS from "'+n[b].href+'"'),d.messages.push('Cannot init CSS from "'+n[b].href+'"')}z=!0}},B=function(a,b){for(var l=0;l<a.length;l++){var e=a[l];e&&e.parentStyleSheet&&e.parentStyleSheet.ownerNode&&
e.parentStyleSheet.ownerNode.id===d.conf.styleId||D(a[l],b)}},D=function(a,b,l){var e=a.cssText.substr(0,a.cssText.indexOf("{")).trim(),c=a.type,k=b?b.children:u;if(c!==d.type.rule&&c!==d.type.fontFace&&c!==d.type.media&&c!==d.type.keyframes&&c!==d.type.keyframe&&c!==d.type.page&&c!==d.type.supports&&c!==d.type.namespace&&c!==d.type.import)console.log("unsuported type: ["+c+"] - "+d.type.names[c]);else{c===d.type.namespace&&(e="@namespace");c===d.type.import&&(e="@import");a._update=!1;c===d.type.rule&&
(a.style._update={});b={indexElem:a,selector:e,csscSelector:l?l:e,children:!1,parent:b?b:!1,events:{},obj:{},type:c};k[e]?(k[e].content[0].indexElem===a&&(console.log('Dublicate "'+e+'": '),console.log(Error().stack+"\n\n")),b=k[e].content.push(b)-1):(k[e]={type:c,content:[b],events:{}},b=0);if(c===d.type.media||c===d.type.keyframes||c===d.type.supports)k[e].content[b].children={},B(a.cssRules,k[e].content[b]);else{c=k[e].content[b];a=a.cssText;if(a.match(/^@(namespace|import)/))a=a.replace(/(^@(namespace|import)\s*|\s*;\s*$)/g,
"");else{l=a.replace(/(^.*?{\s*|\s*}\s*$)/g,"");a=l.split(";");b={};if(""!==l)for(l=0;l<a.length;l++)if(""!==a[l]){var f=a[l].split(":");b[f[0].trim()]=f.slice(1).join(":").trim()}a=b}c.obj=a}return k[e]}},v=function(a,b,l,e){var c;if(!e&&!y){if(document.getElementById(d.conf.styleId)){for(c=0;10>c;c++)if(!document.getElementById(d.conf.styleId+"-"+c)){d.conf.styleId=d.conf.styleId+"-"+c;break}if(document.getElementById(d.conf.styleId))throw Error("cann not create new element..");}c=document.createElement("style");
c.setAttribute("type","text/css");c.setAttribute("id",d.conf.styleId);c.appendChild(document.createTextNode(""));document.head.appendChild(c);y=c}c=e?e.indexElem:y.sheet;var k=c.cssRules.length,f="";if(b){var g=r(b);if("Object"===g)for(var p in b)"Function"===r(b[p])?(l=b[p](),f+=p+":"+l+"; "):f+=p+":"+b[p]+"; ";else if("Function"===g)for(p in l=b(),l)f+=p+":"+l[p]+"; ";else f=b+":"+l+";"}try{p=a+"{"+f+"}";if("@namespace"===a||"@import"===a)p=a+" "+b;"insertRule"in c?c.insertRule(p,k):"appendRule"in
c?c.appendRule(p,k):"addRule"in c&&c.addRule(a,f,k);return D(c.cssRules[k],e,a)}catch(q){a=(e?'"'+e.selector+'" > ':"")+'"'+a+'" -> '+q,d.conf.viewErr&&console.log(a),d.messages.push(a)}return!1},J=function(a,b){z||C();b=b?b:u;return b[a]?b[a]:null},K=function(a,b,d){b=b?b:u;if(b[a]){var e=d?b[a].content.indexOf(d):-1;d?0<=e&&(b[a].content.splice(e,1),0>=b[a].content.length&&delete b[a]):delete b[a]}},w=function(a,b,d){b=b?b:u;var e=r(a);if("String"===e)return b=J(a,b),d?b?b.content:[]:t(b?b.content:
[],a);if("RegExp"===e){e=[];for(var c in b)if(c.match(a))for(k=0;k<b[c].content.length;k++)e.push(b[c].content[k]);return d?e:t(e,a)}if("Array"===e){e=[];var k;for(k=0;k<a.length;k++){var f=J(a[k],b);if(null!==f)for(c=0;c<f.content.length;c++)e.push(f.content[c])}return d?e:t(e,a)}if("Null"===e||"Undefined"===e){e=[];for(c in b)for(k=0;k<b[c].content.length;k++)e.push(b[c].content[k]);return d?e:t(e,a)}return null},F=function(a,b,d,e){var c=r(a);if("String"===c||"RegExp"===c||"Array"===c||"Null"===
c||"Undefined"===c)return a=w(a,d,e),b?a.has(b):a;E(a,null,d)},E=function(a,b){var l;for(f in a){var e="Array"===r(a[f])?a[f]:[a[f]];for(l=0;l<e.length;l++)if("@"===f.charAt(0))if("@font-face"===f||"@namespace"===f||"@import"===f)v(f,e[l],null,b);else{if(f.match(/^@(media|keyframes|supports)/)||b&&(b.type===d.type.media||b.type===d.type.keyframes||b.type===d.type.supports)){var c=b;var k=f;if(b&&!k.match(/^@(media|keyframes|supports)/)){var f=H(b.csscSelector,f);c=b.parent}var g=v(f,null,null,c);
if(!g||g.content[g.content.length-1].selector!==g.content[g.content.length-1].csscSelector){if(g){var p=g.content.length-1;I(g.content[p].indexElem);K(g.content[p].selector,g.content[p].parent,g.content[p])}g=f;p=f+" {}";c=c||!1;var q=f;q=q.trim();if("@"!==q.charAt(0))var h=d.type.rule;else{q=q.substr(1);h=q.indexOf(" ");0<=h&&(q=q.substr(0,h));h=q;if(0<=q.indexOf("-")){var m=q.split("-");h=m[0];for(q=1;q<m.length;q++)h+=m[q].charAt(0).toUpperCase()+m[q].substr(1)}h=h in d.type?d.type[h]:-1}c={csscSelector:g,
cssText:p,parent:c,type:h,cssRules:{}};g=D(c,c.parent,f)}E(e[l],g.content[g.content.length-1]);b&&(b.obj[k]||(b.obj[k]=[]),b.obj[k].push(g.content[g.content.length-1]))}}else if(g=v(f,null,null,b))k=t([g.content[g.content.length-1]],f),k.set(e[l])}},t=function(a,b,l,e){var c=function(b,a){var g,k,f=[];for(g=0;g<c.e.length;g++)if(c.e[g].children){var d=F(b,a,c.e[g].children,!0);for(k=0;k<d.length;k++)f.push(d[k])}return t(f,b,null,c.e)};c.e=a;c.eLength=a.length;c.set=function(a,f,g){if("number"===
typeof g){if(this.e[g].indexElem.type===d.type.fontFace)return d.conf.viewErr&&console.log('Element of Type "'+d.type.names[this.e[g].indexElem.type]+'" is readonly.'),d.messages.push('Element of Type "'+d.type.names[this.e[g].indexElem.type]+'" is readonly.'),this;if(this.e[g].children)w(null,this.e[g].children).set(a,f);else{var c=r(f);if("Object"===c||"Array"===c){var k=H(this.e[g].selector,a);f="Object"===c?[f]:f;var h;for(h=0;h<f.length;h++)if(c=v(k,null,null,this.e[g].parent))t([c.content[c.content.length-
1]],m).set(f[h]),this.e[g].obj[a]&&"push"in this.e[g].obj[a]||(this.e[g].obj[a]=[]),this.e[g].obj[a].push(c.content[c.content.length-1])}else if("Function"===c){var m=this.pos(g).get(a);try{h=f(m),this.set(a,h,g),this.e[g].indexElem.style._update[a]=f}catch(L){d.conf.viewErr&&console.log(L),d.messages.push(L)}}else{if(isFinite(f))f=0===f%1?f+"px":Math.floor(100*f)/100+"px";else if("String"===r(f)&&(h=f.split(" "),0<h.length)){for(m=0;m<h.length;m++)isFinite(h[m])&&(f=h[m],h[m]=0===f%1?f+"px":Math.floor(100*
f)/100+"px");f=h.join(" ")}this.e[g].indexElem.style[a]=f;this.e[g].obj[a]=f}}}else{var x;g=r(a);"Object"===g?k=Object.keys(a).length:"Function"===g&&(x=a());if(0>=this.e.length&&!l&&"String"===r(b)){var n=[];if(e)for(n=[],h=0;h<e.length;h++){if(c=v(b,null,null,e[h].indexElem,e[h].children))for(m=0;m<c.content.length;m++)n.push(c.content[m])}else if(c=v(b,null,null))n=c.content;this.e=n;this.eLength=n.length}if("Array"===g||"Function"===g&&"Array"===r(x))for(g="Array"===g?a:x,h=0;h<g.length;h++)if(a=
this.pos(h),1===a.e.length)a.set(g[h]);else break;else for(h=0;h<this.e.length;h++)if("Object"===g&&0<k)for(m in a)this.set(m,a[m],h);else if("Function"===g){for(m in x)this.set(m,x[m],h);this.e[h].indexElem._update=a}else this.set(a,f,h)}return this};c.get=function(a,b){if(!a){a=this.export(d.export.type.object);for(f in a){if(c)return a;var c=f}return a[c]}var f=[];c="";var k;b=!!b;for(k=0;k<this.e.length;k++){var h="";this.e[k].obj[a]&&!this.e[k].obj[a].selector&&(h=this.e[k].obj[a]);h&&""!==h||
(h=this.e[k].indexElem.style[a]);h&&""!==h||(h=A(this.e[k].indexElem.cssText,a));h&&(c=h,b&&f.push(c))}return b?f:c};c.has=function(a){var c=[];var g=r(a);if("String"===g){var d=a.split(":");for(g=0;g<this.e.length;g++){var k=A(this.e[g].indexElem.cssText,d[0]);""!==k&&(!d[1]||d[1]&&d[1].replace(/ |;/g,"")===k)&&c.push(this.e[g])}}else if("Array"===g)for(var h=0;h<a.length;h++)for(d=a[h].split(":"),g=0;g<this.e.length;g++)k=A(this.e[g].indexElem.cssText,d[0]),""!==k&&(!d[1]||d[1]&&d[1].replace(/ |;/g,
"")===k)&&c.push(this.e[g]);else if("RegExp"===g)for(g=0;g<this.e.length;g++)if(d=this.e[g].indexElem.cssText.match(/[\S]+:.+?;/g))for(h=0;h<d.length;h++)(k=d[h].match(a))&&c.push(this.e[g]);return t(c,b,!0)};c.update=function(){var a,b;for(a=0;a<this.e.length;a++){if(!1!==this.e[a].indexElem._update){var c=this.e[a].indexElem._update();for(b in c)this.set(b,c[b],a)}if(this.e[a].children)w(null,this.e[a].children).update();else for(b in this.e[a].indexElem.style._update)c=this.e[a].indexElem.style._update[b](),
this.set(b,c,a)}return this};c.delete=function(a){var b;if("undefined"===typeof a)for(b=0;b<this.e.length;b++){if(I(this.e[b].indexElem),K(this.e[b].selector,this.e[b].parent?this.e[b].parent:null,this.e[b]),this.e[b].children){var c=w(null,this.e[b].children);c.delete(a)}}else for(b=0;b<this.e.length;b++)this.e[b].indexElem.style[a]="",this.e[b].children&&(c=w(null,this.e[b].children),c.delete(a));return this};c.export=function(a,b){var c={},f,e,h,k=a;a===d.export.type.obj&&(a=d.export.type.object);
if(a===d.export.type.normal||a===d.export.type.min)a=d.export.type.notMDObject;b||(b=[]);for(e=0;e<this.e.length;e++)if(!(0<=b.indexOf(this.e[e]))){if(this.e[e].type===d.type.namespace||this.e[e].type===d.type.import)var l=this.e[e].obj;else for(h in l=Object.assign({},this.e[e].obj),this.e[e].obj)if("object"===typeof this.e[e].obj[h]&&"length"in this.e[e].obj[h])if(a===d.export.type.notMDObject)l[h]=null,delete l[h];else{l[h]=[];for(f=0;f<this.e[e].obj[h].length;f++){var n=t([this.e[e].obj[h][f]]);
l[h][f]=n.export(a,b)[this.e[e].obj[h][f].selector];b.push(this.e[e].obj[h][f])}1===l[h].length&&(l[h]=l[h][0])}this.e[e].children?(f=w(null,this.e[e].children),c[this.e[e].selector]?("length"in c[this.e[e].selector]||(c[this.e[e].selector]=[c[this.e[e].selector]]),c[this.e[e].selector].push(Object.assign(l,f.export(a,b)))):c[this.e[e].selector]=Object.assign(l,f.export(a,b))):c[this.e[e].selector]?("object"===typeof c[this.e[e].selector]&&"length"in c[this.e[e].selector]||(c[this.e[e].selector]=
[c[this.e[e].selector]]),c[this.e[e].selector].push(l)):c[this.e[e].selector]=l}return k===d.export.type.normal||k===d.export.type.min?G(c,null,k):c};c.pos=function(a){return t(this.e[a]?[this.e[a]]:[])};c.first=function(){return this.pos(0)};c.last=function(){return this.pos(this.e.length-1)};return c};d=function(a,b){try{return F(a,b)}catch(l){d.conf.viewErr&&console.log(l),d.messages.push(l)}};d.import=function(a){try{return E(a)}catch(b){d.conf.viewErr&&console.log(b),d.messages.push(b)}};d.export=
function(a){return F().export(a)};d.update=function(a){if(a)a=d(a),a.update();else for(var b in u)a=t(u[b].content),a.update()};d.type={rule:1,charset:2,"import":3,media:4,fontFace:5,page:6,keyframes:7,keyframe:8,namespace:10,counterStyle:11,supports:12,fontFeatureValues:14,names:{1:"rule",2:"charset",3:"import",4:"media",5:"font-face",6:"page",7:"keyframes",8:"keyframe",10:"namespace",11:"counter-style",12:"supports",14:"font-feature-values"}};d.events={beforeChange:"beforechange",change:"change",
beforeSet:"beforeset",set:"set",beforeCreate:"beforecreate",create:"create",beforeDelete:"beforedelete","delete":"delete",beforeDestroy:"beforedestroy",destroy:"destroy"};d.export.type={normal:"css",min:"minCss",obj:"obj",object:"object",notMDObject:"objNMDO"};d.conf={styleId:"cssc-style",viewErr:!0};d.messages=[];M?C():window.addEventListener("load",function(){C()});return d}(document.styleSheets,!0)}();
