/* CSSC.js | @version 1.0b |  m13p4 */
var CSSC=function(){function p(a,b){return b?Object.prototype.toString.call(a):Object.prototype.toString.call(a).replace(/(^\[.+\s|\]$)/g,"")}function I(a){if(a.match(/^@(namespace|import|charset)/))return a.replace(/(^@(namespace|import|charset)\s*|\s*;\s*$)/g,"");var b=a.replace(/(^.*?{\s*|\s*}\s*$)/g,"");a=b.split(";");var e={};if(""!==b)for(b=0;b<a.length;b++)if(""!==a[b]){var c=a[b].split(":");e[c[0].trim()]=c.slice(1).join(":").trim()}return e}function w(a,b,e,c,d){var f="",h=Array((parseInt(e)||
2)+1).join(" "),k,g=p(a);c=c||"";if("String"===g)return a;if("Array"===g)for(g=0;g<a.length;g++)f+=w(a[g],b,e,c,!0);else for(k in a){var l=a[k];g=p(a[k]);if("Object"===g||"Array"===g)if(d&&"Array"===g){var m=w(a[k],b,e,c+h,d);""!==m&&(f=b?f+(k.replace(/\s*(,|:)\s*/g,"$1")+"{"+m+"}"):f+(c+k.replace(/\s*,\s*/g,",\n"+c)+" {\n"+m+c+"}\n"))}else for("Object"===g&&(l=[a[k]]),g=0;g<l.length;g++)"@namespace"===k||"@import"===k||"@charset"===k?f+=k+" "+l[g]+";"+(b?"":"\n"):(m=w(l[g],b,e,c+h,d),""!==m&&(f=
b?f+(k.replace(/\s*(,|:)\s*/g,"$1")+"{"+m+"}"):f+(c+k.replace(/\s*,\s*/g,",\n"+c)+" {\n"+m+c+"}\n")));else f="@namespace"===k||"@import"===k||"@charset"===k?f+(k+" "+l+";"+(b?"":"\n")):b?f+(k+":"+l.trim().replace(/\s*,\s*/g,",")+";"):f+((c.length<h.length?h:c)+k+": "+l+";\n")}return f}function F(a,b){"@"===b.charAt(0)&&"@"===a.charAt(0)&&(b=b.substr(1));b="/"===b.charAt(0)?b.substr(1):","===b.charAt(0)?", "+b.substr(1).trim():" "+b;if(0<=a.indexOf(",")||0<b.indexOf(",")){a=a.split(",");var e,c="",
d=b.split(",");if(","!==b.charAt(0))for(e=0;e<a.length;e++)for(b=0;b<d.length;b++)c+=a[e]+d[b]+", ";else for(e=0;e<a.length;e++)c+=a[e]+b+", ";return c.replace(/,+\s*$/,"")}return a+b}function J(a){var b=a.parentRule?a.parentRule:a.parentStyleSheet,e;for(e=0;e<b.cssRules.length;e++)b.cssRules[e]===a&&b.deleteRule(e)}function G(a,b){b||(b={});a||(a="");for(var e=a.lastIndexOf("$"),c,d=0,f,h,k,g,l,m;0<=e&&100>d;){d++;f=null;g=a.substr(e+1);c=g.search(/[^\w\.]/);c=0>c?a.length:c+e;l=a.substr(e+1,c-e);
m=l.split(".");for(h=0;h<m.length;h++)if(!(1>m[h].length)){k=typeof f;if(0===h&&m[h]in b)f=b[m[h]];else if(0===h&&m[h]in n.vars)f=n.vars[m[h]];else if(null!==f&&"object"===k&&m[h]in f)f=f[m[h]];else if("string"===k&&m[h].match(/^[0-9]+$/))f=f.charAt(m[h]);else{f="$"+l;break}if("function"===typeof f){if("("===a.charAt(c+1)){c++;k=g=c;do k=a.indexOf("(",k+1),c=a.indexOf(")",c+1);while(-1<k&&k<c);0>c&&(c=a.length);g=a.substr(g+1,c-g-1);g=g.trim().split(/\s*,\s*/);f=f.apply(null,g)}else f=f();if("."===
a.charAt(c+1))for(c++,k=c,g=a.substr(c+1),c=g.search(/[^\w\.]/),g=g.substr(0,0>c?g.length:c),c=0>c?a.length:c+k,l=a.substr(e+1,c-e),g=g.split("."),k=0;k<g.length;k++)m.push(g[k])}}a=a.substr(0,e)+f+a.substr(c+1);c="$"+l===f?e:c+(f.length-1);if(0>--c)break;e=a.lastIndexOf("$",c)}return a}function K(a,b){var e;if(Object.defineProperty)for(e in b)Object.defineProperty(a,e,{enumerable:!0,value:b[e]});else for(e in b)a[e]=b[e]}function B(a){if(Object.freeze)return Object.freeze(a);if(Object.defineProperty){var b=
{},e;for(e in a)Object.defineProperty(b,e,{enumerable:!0,value:a[e]});a=b}Object.preventExtensions&&Object.preventExtensions(a);return a}function L(a,b){for(var e=0;e<a.length;e++){var c=a[e];c&&c.parentStyleSheet&&c.parentStyleSheet.ownerNode&&c.parentStyleSheet.ownerNode.id===n.conf.styleId||C(a[e],b)}}function C(a,b,e){var c=a.cssText.substr(0,a.cssText.indexOf("{")).trim(),d=a.type,f=b?b.children:D;if(1!==d&&5!==d&&4!==d&&7!==d&&8!==d&&6!==d&&12!==d&&10!==d&&3!==d&&2!==d)console.log("unsuported type: "+
d);else return 10===d&&(c="@namespace"),3===d&&(c="@import"),2===d&&(c="@charset"),a._update=!1,1===d&&(a.style._update={}),b={indexElem:a,selector:c,csscSelector:e?e:c,children:!1,parent:b?b:!1,events:{},obj:{},type:d},f[c]?(f[c].content[0].indexElem===a&&(console.log('Dublicate "'+c+'": '),console.log(Error().stack+"\n\n")),b=f[c].content.push(b)-1):(f[c]={type:d,content:[b],events:{}},b=0),M.push(f[c].content[b]),4===d||7===d||12===d?(f[c].content[b].children={},L(a.cssRules,f[c].content[b])):
f[c].content[b].obj=I(a.cssText),f[c]}function t(a,b,e,c){var d;if(!c&&!H){if(document.getElementById(n.conf.styleId)){for(d=0;10>d;d++)if(!document.getElementById(n.conf.styleId+"-"+d)){n.conf.styleId=n.conf.styleId+"-"+d;break}if(document.getElementById(n.conf.styleId))throw Error("cann not create new element..");}d=document.createElement("style");d.setAttribute("type","text/css");d.setAttribute("id",n.conf.styleId);d.appendChild(document.createTextNode(""));document.head.appendChild(d);H=d}d=c?
c.indexElem:H.sheet;var f=d.cssRules.length,h="";if(b){var k=p(b);if("Object"===k)for(var g in b)"Function"===p(b[g])?(e=b[g](),h+=g+":"+e+"; "):h+=g+":"+b[g]+"; ";else if("Function"===k)for(g in e=b(),e)h+=g+":"+e[g]+"; ";else h=b+":"+e+";"}try{e=a+"{"+h+"}";if("@namespace"===a||"@import"===a||"@charset"===a)e=a+" "+b;return"@charset"!==a?("insertRule"in d?d.insertRule(e,f):"appendRule"in d?d.appendRule(e,f):"addRule"in d&&d.addRule(a,h,f),C(d.cssRules[f],c,a)):C({csscSelector:a,cssText:e,parent:!1,
type:2,cssRules:{}},c,g)}catch(l){a=(c?'"'+c.selector+'" > ':"")+'"'+a+'" -> '+l,n.conf.viewErr&&console.log(a),n.messages.push(a)}return!1}function N(a,b){b=b?b:D;return b[a]?b[a]:null}function O(a,b,e){b=b?b:D;if(b[a]){var c=e?b[a].content.indexOf(e):-1;e?0<=c&&(b[a].content.splice(c,1),0>=b[a].content.length&&delete b[a]):delete b[a]}}function v(a,b,e){b=b?b:D;var c=p(a);if("String"===c)return b=N(a,b),e?b?b.content:[]:u(b?b.content:[],a);if("RegExp"===c){c=[];for(var d in b)if(d.match(a))for(f=
0;f<b[d].content.length;f++)c.push(b[d].content[f]);return e?c:u(c,a)}if("Array"===c){c=[];var f;for(f=0;f<a.length;f++){var h=N(a[f],b);if(null!==h)for(d=0;d<h.content.length;d++)c.push(h.content[d])}return e?c:u(c,a)}if("Null"===c||"Undefined"===c){c=[];for(d in b)for(f=0;f<b[d].content.length;f++)c.push(b[d].content[f]);return e?c:u(c,a)}return null}function x(a,b,e,c){var d=p(a);if("String"===d||"RegExp"===d||"Array"===d||"Null"===d||"Undefined"===d)a=v(a,e,c);else return y(a);return b?a.has(b):
a}function y(a,b,e){var c,d={};e||b||("@charset"in a&&(d["@charset"]=a["@charset"]),"@import"in a&&(d["@import"]=a["@import"]),"@namespace"in a&&(d["@namespace"]=a["@namespace"]),"@font-face"in a&&(d["@font-face"]=a["@font-face"]),0<Object.keys(d).length&&y(d,b,!0));for(f in a)if(!(f in d)){e="Array"===p(a[f])?a[f]:[a[f]];var f=G(f);for(c=0;c<e.length;c++)if("@"===f.charAt(0))if("@font-face"===f||"@namespace"===f||"@import"===f||"@charset"===f)t(f,e[c],null,b);else{if(f.match(/^@(media|keyframes|supports)/)||
b&&(4===b.type||7===b.type||12===b.type)){var h=b;var k=f;b&&!k.match(/^@(media|keyframes|supports)/)&&(f=F(b.csscSelector,f),h=b.parent);var g=t(f,null,null,h);var l=(g?g.content.length:0)-1;if(-1<l&&g.content[l].selector===g.content[l].csscSelector)y(e[c],g.content[l]);else{-1<l&&(J(g.content[l].indexElem),O(g.content[l].selector,g.content[l].parent,g.content[l]));g=f;l=f+" {}";h=h||!1;var m=f;m=m.trim();if("@"!==m.charAt(0))var q=1;else{m=m.substr(1);q=m.indexOf(" ");0<=q&&(m=m.substr(0,q));q=
m;if(0<=m.indexOf("-")){var E=m.split("-");q=E[0];for(m=1;m<E.length;m++)q+=E[m].charAt(0).toUpperCase()+E[m].substr(1)}q=q in n.type?n.type[q]:-1}h={csscSelector:g,cssText:l,parent:h,type:q,cssRules:{}};g=C(h,h.parent,f);y(e[c],g.content[g.content.length-1])}b&&(b.obj[k]||(b.obj[k]=[]),b.obj[k].push(g.content[g.content.length-1]))}}else(g=t(f,null,null,b))&&r([g.content[g.content.length-1]],e[c])}}function r(a,b,e,c){if("number"===typeof c)if(5===a[c].indexElem.type)n.conf.viewErr&&console.log("@font-face rules are readonly."),
n.messages.push("@font-face rules are readonly.");else if(b=G(b),a[c].children)v(null,a[c].children).set(b,e);else{var d,f=p(e);if("Object"===f||"Array"===f){var h="@"===b.charAt(0),k;f="Object"===f?[e]:e;var g=F(a[c].selector,b);h&&(g=a[c].parent?F(a[c].parent.selector,b):b);for(d=0;d<f.length;d++)if(k=t(g,null,null,h?!1:a[c].parent)){var l=k.content.length-1;h&&(e=k,(k=t(a[c].selector,null,null,k.content[l]))?l=k.content.length-1:k=e);e=k.content[l];r([e],f[d]);h&&a[c].parent&&(k=a[c].parent,k.obj[b]&&
"push"in k.obj[b]||(k.obj[b]=[]),k.obj[b].push(e.parent));a[c].obj[b]&&"push"in a[c].obj[b]||(a[c].obj[b]=[]);a[c].obj[b].push(e)}}else if("Function"===f){h=z(c).get(b);try{d=e(h),r(a,b,d,c),a[c].indexElem.style._update[b]=e}catch(m){n.conf.viewErr&&console.log(m),n.messages.push(m)}}else{a:if(isFinite(e))d=0===e%1?e+"px":Math.floor(100*e)/100+"px";else{if("String"===p(e)&&(d=e.split(" "),0<d.length)){for(h=0;h<d.length;h++)isFinite(d[h])&&(e=d[h],d[h]=0===e%1?e+"px":Math.floor(100*e)/100+"px");d=
d.join(" ");break a}d=e}a[c].indexElem.style[b]=d;a[c].obj[b]=d}}else if(c=p(b),"Object"===c?h=Object.keys(b).length:"Function"===c&&(g=b()),"Array"===c||"Function"===c&&"Array"===p(g))for(b="Array"===c?b:g,d=0;d<b.length;d++)if(a=z(d),1===a.e.length)a.set(b[d]);else break;else for(d=0;d<a.length;d++)if("Object"===c&&0<h)for(f in b)r(a,f,b[f],d);else if("Function"===c){for(f in g)r(a,f,g[f],d);a[d].indexElem._update=b}else r(a,b,e,d)}function A(a,b,e){var c={},d,f,h,k=b;"obj"===b&&(b="object");if("css"===
b||"minCss"===b)b="array";e||(e=[]);for(d=0;d<a.length;d++)if(!(0<=e.indexOf(a[d]))){if(10===a[d].type||3===a[d].type||2===a[d].type)var g=a[d].obj;else for(h in g=Object.assign({},a[d].obj),a[d].obj)if("object"===typeof a[d].obj[h]&&"length"in a[d].obj[h])if("objNMD"===b||"array"===b)g[h]=null,delete g[h];else{g[h]=[];for(f=0;f<a[d].obj[h].length;f++)if(!(0<=e.indexOf(a[d].obj[h][f]))){var l=A([a[d].obj[h][f]],b,e)[a[d].obj[h][f].selector];e.push(a[d].obj[h][f]);!l||0>=Object.keys(l).length||(g[h][f]=
l)}0===g[h].length?delete g[h]:1===g[h].length&&(g[h]=g[h][0])}a[d].children&&(l=v(null,a[d].children),g=Object.assign(l.export(b,e),g));0>=Object.keys(g).length||("array"===b?(l=M.indexOf(a[d]),l="@charset"===a[d].selector?0:"@import"===a[d].selector?l+1E5:"@namespace"===a[d].selector?l+2E5:"@font-face"===a[d].selector?l+3E5:l+1E6,c[l]={},c[l][a[d].selector]=g):c[a[d].selector]?("object"===typeof c[a[d].selector]&&"length"in c[a[d].selector]||(c[a[d].selector]=[c[a[d].selector]]),c[a[d].selector].push(g)):
c[a[d].selector]=g,e.push(a[d]))}if("array"===b)return c=Object.values(c),b===k?c:w(c,"minCss"===k);a={};c["@charset"]&&(a["@charset"]=c["@charset"]);c["@import"]&&(a["@import"]=c["@import"]);c["@namespace"]&&(a["@namespace"]=c["@namespace"]);c["@font-face"]&&(a["@font-face"]=c["@font-face"]);if(l=0<Object.keys(a).length)for(d in c)a[d]||(a[d]=c[d]);return l?a:c}function z(a,b,e,c){0>b&&(b+=a.length);return a[b]?u([a[b]],e,!1,a[b].parent?a[b].parent:!1):u([],e,!1,c)}function P(a){for(var b=[],e=0;e<
a.length;e++)a[e].indexElem&&b.push(a[e].indexElem);return b}function u(a,b,e,c){function d(){if(0>=a.length&&!e&&"String"===p(b)){var d,k=[],g,l;if(c)for(g=0;g<c.length;g++){if(d=t(b,null,null,c[g]))for(l=0;l<d.content.length;l++)k.push(d.content[l])}else if(d=t(b,null,null))k=d.content;a=k;f.e=P(a);f.selector=1===a.length?a[0].selector:b}}var f=function(b,c){var e,f,h=[];d();for(e=0;e<a.length;e++)if(a[e].children){var k=x(b,c,a[e].children,!0);for(f=0;f<k.length;f++)h.push(k[f])}return u(h,b,null,
a)};f.e=P(a);f.selector=1===a.length?a[0].selector:b;K(f,{set:function(b,c,e){d();r(a,b,c,e);return this},get:function(b,c){var d=a;if(b){var e=[],f="",h;c=!!c;for(h=0;h<d.length;h++){var k="";d[h].obj[b]&&(k=d[h].obj[b],"Array"===p(k)&&(k=A(k,"object")));k&&""!==k||(k=d[h].indexElem.style[b]);k&&""!==k||(k=(k=d[h].indexElem.cssText.match(new RegExp(b+"s*:s*(.+?);")))?k[1].trim():"");k&&(f=k,c&&e.push(f))}b=c?e:f}else b=A("object");return b},update:function(){var b=a,c,d;for(c=0;c<b.length;c++){if(!1!==
b[c].indexElem._update){var e=b[c].indexElem._update();for(d in e)r(d,e[d],c)}if(b[c].children)v(null,b[c].children).update();else if(b[c].indexElem.style)for(d in b[c].indexElem.style._update)r(d,b[c].indexElem.style._update[d](),c)}return this},"delete":function(b){var c=a,d;if("undefined"===typeof b)for(d=0;d<c.length;d++)c[d].children&&v(null,c[d].children).delete(b),J(c[d].indexElem),O(c[d].selector,c[d].parent?c[d].parent:null,c[d]);else for(d=0;d<c.length;d++)c[d].indexElem.style[b]="",c[d].children&&
v(null,c[d].children).delete(b);return this},"export":function(b){return A(a,b)},parse:function(b){return A(a,b?"minCss":"css")},pos:function(d){return z(a,d,b,c)},first:function(){return z(a,0,b,c)},last:function(){return z(a,-1,b,c)}});return f}var D={},M=[],H;var n=function(a,b){try{return x(a,b)}catch(e){n.conf.viewErr&&console.log(e),n.messages.push(e)}};K(n,{version:"1.0b",init:function(a){a="length"in a?a:[a];for(var b=0;b<a.length;b++)if("sheet"in a[b]&&(a[b]=a[b].sheet),"cssRules"in a[b]){var e=
(a[b].ownerNode.getAttribute("data-cssc-ignore")||"").toLowerCase();if("true"!==e&&"1"!==e)try{L(a[b].cssRules,null)}catch(c){n.conf.viewErr&&console.log('Cannot init CSS from "'+a[b].href+'"'),n.messages.push('Cannot init CSS from "'+a[b].href+'"')}}},"import":function(a,b){return y(a)},"export":function(a){return x().export(a)},parse:function(a){return x().parse(a)},update:function(a){return x(a).update()},parseVars:function(a,b){return G(a,b)},objFromCss:function(a){return I(a)},cssFromObj:function(a,
b,e){return w(a,b,e)},conf:B({styleId:"cssc-style",viewErr:!0}),type:B({rule:1,charset:2,"import":3,media:4,fontFace:5,page:6,keyframes:7,keyframe:8,namespace:10,counterStyle:11,supports:12,fontFeatureValues:14,viewport:15}),exportType:B({normal:"css",min:"minCss",obj:"obj",object:"object",notMDObject:"objNMD",array:"array"}),events:B({beforeChange:"beforechange",change:"change",beforeSet:"beforeset",set:"set",beforeCreate:"beforecreate",create:"create",beforeDelete:"beforedelete","delete":"delete",
beforeDestroy:"beforedestroy",destroy:"destroy"})});n.messages=[];n.vars={};return n}();
