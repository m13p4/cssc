/* CSSC.js | @version 1.0b |  m13p4 */
var CSSC=function(){function p(a,b){return b?Object.prototype.toString.call(a):Object.prototype.toString.call(a).replace(/(^\[.+\s|\]$)/g,"")}function G(a){if(a.match(/^@(namespace|import|charset)/))return a.replace(/(^@(namespace|import|charset)\s*|\s*;\s*$)/g,"");var b=a.replace(/(^.*?{\s*|\s*}\s*$)/g,"");a=b.split(";");var f={};if(""!==b)for(b=0;b<a.length;b++)if(""!==a[b]){var c=a[b].split(":");f[c[0].trim()]=c.slice(1).join(":").trim()}return f}function v(a,b,f,c,g){var e="",h=Array((parseInt(f)||
2)+1).join(" "),k,d=p(a);c=c||"";if("String"===d)return a;if("Array"===d)for(d=0;d<a.length;d++)e+=v(a[d],b,f,c,!0);else for(k in a){var n=a[k];d=p(a[k]);if("Object"===d||"Array"===d)if(g&&"Array"===d){var m=v(a[k],b,f,c+h,g);""!==m&&(e=b?e+(k.replace(/\s*(,|:)\s*/g,"$1")+"{"+m+"}"):e+(c+k.replace(/\s*,\s*/g,",\n"+c)+" {\n"+m+c+"}\n"))}else for("Object"===d&&(n=[a[k]]),d=0;d<n.length;d++)"@namespace"===k||"@import"===k||"@charset"===k?e+=k+" "+n[d]+";"+(b?"":"\n"):(m=v(n[d],b,f,c+h,g),""!==m&&(e=
b?e+(k.replace(/\s*(,|:)\s*/g,"$1")+"{"+m+"}"):e+(c+k.replace(/\s*,\s*/g,",\n"+c)+" {\n"+m+c+"}\n")));else e="@namespace"===k||"@import"===k||"@charset"===k?e+(k+" "+n+";"+(b?"":"\n")):b?e+(k+":"+n.trim().replace(/\s*,\s*/g,",")+";"):e+((c.length<h.length?h:c)+k+": "+n+";\n")}return e}function C(a,b){return(a=a.match(new RegExp(b+"s*:s*(.+?);")))?a[1].trim():""}function D(a,b){"@"===b.charAt(0)&&"@"===a.charAt(0)&&(b=b.substr(1));b="/"===b.charAt(0)?b.substr(1):","===b.charAt(0)?", "+b.substr(1).trim():
" "+b;if(0<=a.indexOf(",")||0<b.indexOf(",")){a=a.split(",");var f,c="",g=b.split(",");if(","!==b.charAt(0))for(f=0;f<a.length;f++)for(b=0;b<g.length;b++)c+=a[f]+g[b]+", ";else for(f=0;f<a.length;f++)c+=a[f]+b+", ";return c.replace(/,+\s*$/,"")}return a+b}function H(a){var b=a.parentRule?a.parentRule:a.parentStyleSheet,f;for(f=0;f<b.cssRules.length;f++)b.cssRules[f]===a&&b.deleteRule(f)}function E(a,b){b||(b={});a||(a="");for(var f=a.lastIndexOf("$"),c,g=0,e,h,k,d,n,m;0<=f&&100>g;){g++;e=null;d=a.substr(f+
1);c=d.search(/[^\w\.]/);c=0>c?a.length:c+f;n=a.substr(f+1,c-f);m=n.split(".");for(h=0;h<m.length;h++){k=typeof e;if(0===h&&m[h]in b)e=b[m[h]];else if(0===h&&m[h]in l.vars)e=l.vars[m[h]];else if(null!==e&&"object"===k&&m[h]in e)e=e[m[h]];else if("string"===k&&m[h].match(/^[0-9]+$/))e=e.charAt(m[h]);else{e="$"+n;break}if("function"===typeof e){if("("===a.charAt(c+1)){c++;for(k=d=c;k=a.indexOf("(",k+1),c=a.indexOf(")",c+1),-1<k&&k<c;);0>c&&(c=a.length);d=a.substr(d+1,c-d-1);d=d.trim().split(/\s*,\s*/);
e=e.apply(null,d)}else e=e();if("."===a.charAt(c+1))for(c++,k=c,d=a.substr(c+1),c=d.search(/[^\w\.]/),d=d.substr(0,0>c?d.length:c),c=0>c?a.length:c+k,n=a.substr(f+1,c-f),d=d.split("."),k=0;k<d.length;k++)m.push(d[k])}}a=a.substr(0,f)+e+a.substr(c+1);c="$"+n===e?f:c+(e.length-1);f=a.lastIndexOf("$",--c)}return a}function w(a){if(Object.freeze)return Object.freeze(a);if(Object.defineProperty){var b={},f;for(f in a)Object.defineProperty(b,f,{enumerable:!0,value:a[f]});a=b}Object.preventExtensions&&Object.preventExtensions(a);
return a}function I(a,b){for(var f=0;f<a.length;f++){var c=a[f];c&&c.parentStyleSheet&&c.parentStyleSheet.ownerNode&&c.parentStyleSheet.ownerNode.id===l.conf.styleId||z(a[f],b)}}function z(a,b,f){var c=a.cssText.substr(0,a.cssText.indexOf("{")).trim(),g=a.type,e=b?b.children:A;if(g!==l.type.rule&&g!==l.type.fontFace&&g!==l.type.media&&g!==l.type.keyframes&&g!==l.type.keyframe&&g!==l.type.page&&g!==l.type.supports&&g!==l.type.namespace&&g!==l.type.import&&g!==l.type.charset)console.log("unsuported type: ["+
g+"] - "+l.type.names[g]);else return g===l.type.namespace&&(c="@namespace"),g===l.type.import&&(c="@import"),g===l.type.charset&&(c="@charset"),a._update=!1,g===l.type.rule&&(a.style._update={}),b={indexElem:a,selector:c,csscSelector:f?f:c,children:!1,parent:b?b:!1,events:{},obj:{},type:g},e[c]?(e[c].content[0].indexElem===a&&(console.log('Dublicate "'+c+'": '),console.log(Error().stack+"\n\n")),b=e[c].content.push(b)-1):(e[c]={type:g,content:[b],events:{}},b=0),J.push(e[c].content[b]),g===l.type.media||
g===l.type.keyframes||g===l.type.supports?(e[c].content[b].children={},I(a.cssRules,e[c].content[b])):e[c].content[b].obj=G(a.cssText),e[c]}function t(a,b,f,c){var g;if(!c&&!F){if(document.getElementById(l.conf.styleId)){for(g=0;10>g;g++)if(!document.getElementById(l.conf.styleId+"-"+g)){l.conf.styleId=l.conf.styleId+"-"+g;break}if(document.getElementById(l.conf.styleId))throw Error("cann not create new element..");}g=document.createElement("style");g.setAttribute("type","text/css");g.setAttribute("id",
l.conf.styleId);g.appendChild(document.createTextNode(""));document.head.appendChild(g);F=g}g=c?c.indexElem:F.sheet;var e=g.cssRules.length,h="";if(b){var k=p(b);if("Object"===k)for(var d in b)"Function"===p(b[d])?(f=b[d](),h+=d+":"+f+"; "):h+=d+":"+b[d]+"; ";else if("Function"===k)for(d in f=b(),f)h+=d+":"+f[d]+"; ";else h=b+":"+f+";"}try{f=a+"{"+h+"}";if("@namespace"===a||"@import"===a||"@charset"===a)f=a+" "+b;return"@charset"!==a?("insertRule"in g?g.insertRule(f,e):"appendRule"in g?g.appendRule(f,
e):"addRule"in g&&g.addRule(a,h,e),z(g.cssRules[e],c,a)):z({csscSelector:a,cssText:f,parent:!1,type:l.type.charset,cssRules:{}},c,d)}catch(n){a=(c?'"'+c.selector+'" > ':"")+'"'+a+'" -> '+n,l.conf.viewErr&&console.log(a),l.messages.push(a)}return!1}function K(a,b){b=b?b:A;return b[a]?b[a]:null}function L(a,b,f){b=b?b:A;if(b[a]){var c=f?b[a].content.indexOf(f):-1;f?0<=c&&(b[a].content.splice(c,1),0>=b[a].content.length&&delete b[a]):delete b[a]}}function u(a,b,f){b=b?b:A;var c=p(a);if("String"===c)return b=
K(a,b),f?b?b.content:[]:q(b?b.content:[],a);if("RegExp"===c){c=[];for(var g in b)if(g.match(a))for(e=0;e<b[g].content.length;e++)c.push(b[g].content[e]);return f?c:q(c,a)}if("Array"===c){c=[];var e;for(e=0;e<a.length;e++){var h=K(a[e],b);if(null!==h)for(g=0;g<h.content.length;g++)c.push(h.content[g])}return f?c:q(c,a)}if("Null"===c||"Undefined"===c){c=[];for(g in b)for(e=0;e<b[g].content.length;e++)c.push(b[g].content[e]);return f?c:q(c,a)}return null}function x(a,b,f,c){var g=p(a);if("String"===
g||"RegExp"===g||"Array"===g||"Null"===g||"Undefined"===g)a=u(a,f,c);else return y(a);return b?a.has(b):a}function y(a,b,f){var c,g={};f||b||("@charset"in a&&(g["@charset"]=a["@charset"]),"@import"in a&&(g["@import"]=a["@import"]),"@namespace"in a&&(g["@namespace"]=a["@namespace"]),"@font-face"in a&&(g["@font-face"]=a["@font-face"]),0<Object.keys(g).length&&y(g,b,!0));for(e in a)if(!(e in g)){f="Array"===p(a[e])?a[e]:[a[e]];var e=E(e);for(c=0;c<f.length;c++)if("@"===e.charAt(0))if("@font-face"===
e||"@namespace"===e||"@import"===e||"@charset"===e)t(e,f[c],null,b);else{if(e.match(/^@(media|keyframes|supports)/)||b&&(b.type===l.type.media||b.type===l.type.keyframes||b.type===l.type.supports)){var h=b;var k=e;b&&!k.match(/^@(media|keyframes|supports)/)&&(e=D(b.csscSelector,e),h=b.parent);var d=t(e,null,null,h);var n=(d?d.content.length:0)-1;if(-1<n&&d.content[n].selector===d.content[n].csscSelector)y(f[c],d.content[n]);else{-1<n&&(H(d.content[n].indexElem),L(d.content[n].selector,d.content[n].parent,
d.content[n]));d=e;n=e+" {}";h=h||!1;var m=e;m=m.trim();if("@"!==m.charAt(0))var r=l.type.rule;else{m=m.substr(1);r=m.indexOf(" ");0<=r&&(m=m.substr(0,r));r=m;if(0<=m.indexOf("-")){var B=m.split("-");r=B[0];for(m=1;m<B.length;m++)r+=B[m].charAt(0).toUpperCase()+B[m].substr(1)}r=r in l.type?l.type[r]:-1}h={csscSelector:d,cssText:n,parent:h,type:r,cssRules:{}};d=z(h,h.parent,e);y(f[c],d.content[d.content.length-1])}b&&(b.obj[k]||(b.obj[k]=[]),b.obj[k].push(d.content[d.content.length-1]))}}else if(d=
t(e,null,null,b))k=q([d.content[d.content.length-1]],e),k.set(f[c])}}function q(a,b,f,c){function g(){if(0>=e.e.length&&!f&&"String"===p(b)){var a,k=[],d,n;if(c)for(d=0;d<c.length;d++){if(a=t(b,null,null,c[d]))for(n=0;n<a.content.length;n++)k.push(a.content[n])}else if(a=t(b,null,null))k=a.content;e.e=k;e.eLength=k.length}}var e=function(a,b){var d,h,c=[];g();for(d=0;d<e.e.length;d++)if(e.e[d].children){var k=x(a,b,e.e[d].children,!0);for(h=0;h<k.length;h++)c.push(k[h])}return q(c,a,null,e.e)};e.e=
a;e.eLength=a.length;e.set=function(a,b,d){g();if("number"===typeof d){if(this.e[d].indexElem.type===l.type.fontFace)return l.conf.viewErr&&console.log('Element of Type "'+l.type.names[this.e[d].indexElem.type]+'" is readonly.'),l.messages.push('Element of Type "'+l.type.names[this.e[d].indexElem.type]+'" is readonly.'),this;a=E(a);if(this.e[d].children)u(null,this.e[d].children).set(a,b);else{var c,e=p(b),h;if("Object"===e||"Array"===e){var k="@"===a.charAt(0);b="Object"===e?[b]:b;e=D(this.e[d].selector,
a);k&&(e=this.e[d].parent?D(this.e[d].parent.selector,a):a);for(c=0;c<b.length;c++)if(h=t(e,null,null,k?!1:this.e[d].parent)){var f=h.content.length-1;h=q([h.content[f]],e);k&&(h=h(this.e[d].selector));h.set(b[c]);h=h.e[h.e.length-1];k&&this.e[d].parent&&(f=this.e[d].parent,f.obj[a]&&"push"in f.obj[a]||(f.obj[a]=[]),f.obj[a].push(h.parent));this.e[d].obj[a]&&"push"in this.e[d].obj[a]||(this.e[d].obj[a]=[]);this.e[d].obj[a].push(h)}}else if("Function"===e){k=this.pos(d).get(a);try{c=b(k),this.set(a,
c,d),this.e[d].indexElem.style._update[a]=b}catch(M){l.conf.viewErr&&console.log(M),l.messages.push(M)}}else{a:if(isFinite(b))c=0===b%1?b+"px":Math.floor(100*b)/100+"px";else{if("String"===p(b)&&(c=b.split(" "),0<c.length)){for(k=0;k<c.length;k++)isFinite(c[k])&&(b=c[k],c[k]=0===b%1?b+"px":Math.floor(100*b)/100+"px");c=c.join(" ");break a}c=b}this.e[d].indexElem.style[a]=c;this.e[d].obj[a]=c}}}else if(d=p(a),"Object"===d?k=Object.keys(a).length:"Function"===d&&(h=a()),"Array"===d||"Function"===d&&
"Array"===p(h))for(d="Array"===d?a:h,c=0;c<d.length;c++)if(a=this.pos(c),1===a.e.length)a.set(d[c]);else break;else for(c=0;c<this.e.length;c++)if("Object"===d&&0<k)for(e in a)this.set(e,a[e],c);else if("Function"===d){for(e in h)this.set(e,h[e],c);this.e[c].indexElem._update=a}else this.set(a,b,c);return this};e.get=function(a,b){if(!a)return this.export(l.expType.object);var d=[],c="",e;b=!!b;for(e=0;e<this.e.length;e++){var h="";this.e[e].obj[a]&&(h=this.e[e].obj[a],"Array"===p(h)&&(h=q(h),h=h.export(l.expType.object)));
h&&""!==h||(h=this.e[e].indexElem.style[a]);h&&""!==h||(h=C(this.e[e].indexElem.cssText,a));h&&(c=h,b&&d.push(c))}return b?d:c};e.has=function(a){var c=[];var d=p(a);if("String"===d){var e=a.split(":");for(d=0;d<this.e.length;d++){var h=C(this.e[d].indexElem.cssText,e[0]);""!==h&&(!e[1]||e[1]&&e[1].replace(/ |;/g,"")===h)&&c.push(this.e[d])}}else if("Array"===d)for(var f=0;f<a.length;f++)for(e=a[f].split(":"),d=0;d<this.e.length;d++)h=C(this.e[d].indexElem.cssText,e[0]),""!==h&&(!e[1]||e[1]&&e[1].replace(/ |;/g,
"")===h)&&c.push(this.e[d]);else if("RegExp"===d)for(d=0;d<this.e.length;d++)if(e=this.e[d].indexElem.cssText.match(/[\S]+:.+?;/g))for(f=0;f<e.length;f++)e[f].match(a)&&c.push(this.e[d]);return q(c,b,!0)};e.update=function(){var a,b;for(a=0;a<this.e.length;a++){if(!1!==this.e[a].indexElem._update){var d=this.e[a].indexElem._update();for(b in d)this.set(b,d[b],a)}if(this.e[a].children)u(null,this.e[a].children).update();else if(this.e[a].indexElem.style)for(b in this.e[a].indexElem.style._update)this.set(b,
this.e[a].indexElem.style._update[b](),a)}return this};e.delete=function(a){var b;if("undefined"===typeof a)for(b=0;b<this.e.length;b++)this.e[b].children&&u(null,this.e[b].children).delete(a),H(this.e[b].indexElem),L(this.e[b].selector,this.e[b].parent?this.e[b].parent:null,this.e[b]);else for(b=0;b<this.e.length;b++)this.e[b].indexElem.style[a]="",this.e[b].children&&u(null,this.e[b].children).delete(a);return this};e.export=function(a,b){var d={},c,e,f,h=a;a===l.expType.obj&&(a=l.expType.object);
if(a===l.expType.normal||a===l.expType.min)a=l.expType.array;b||(b=[]);for(c=0;c<this.e.length;c++)if(!(0<=b.indexOf(this.e[c]))){if(this.e[c].type===l.type.namespace||this.e[c].type===l.type.import||this.e[c].type===l.type.charset)var g=this.e[c].obj;else for(f in g=Object.assign({},this.e[c].obj),this.e[c].obj)if("object"===typeof this.e[c].obj[f]&&"length"in this.e[c].obj[f])if(a===l.expType.notMDObject||a===l.expType.array)g[f]=null,delete g[f];else{g[f]=[];for(e=0;e<this.e[c].obj[f].length;e++)if(!(0<=
b.indexOf(this.e[c].obj[f][e]))){var k=q([this.e[c].obj[f][e]]);k=k.export(a,b)[this.e[c].obj[f][e].selector];b.push(this.e[c].obj[f][e]);!k||0>=Object.keys(k).length||(g[f][e]=k)}0===g[f].length?delete g[f]:1===g[f].length&&(g[f]=g[f][0])}this.e[c].children&&(k=u(null,this.e[c].children),g=Object.assign(k.export(a,b),g));0>=Object.keys(g).length||(a===l.expType.array?(k=J.indexOf(this.e[c]),k="@charset"===this.e[c].selector?0:"@import"===this.e[c].selector?k+1E5:"@namespace"===this.e[c].selector?
k+2E5:"@font-face"===this.e[c].selector?k+3E5:k+1E6,d[k]={},d[k][this.e[c].selector]=g):d[this.e[c].selector]?("object"===typeof d[this.e[c].selector]&&"length"in d[this.e[c].selector]||(d[this.e[c].selector]=[d[this.e[c].selector]]),d[this.e[c].selector].push(g)):d[this.e[c].selector]=g,b.push(this.e[c]))}if(a===l.expType.array)return d=Object.values(d),a===h?d:v(d,h===l.expType.min);a={};d["@charset"]&&(a["@charset"]=d["@charset"]);d["@import"]&&(a["@import"]=d["@import"]);d["@namespace"]&&(a["@namespace"]=
d["@namespace"]);d["@font-face"]&&(a["@font-face"]=d["@font-face"]);if(k=0<Object.keys(a).length)for(c in d)a[c]||(a[c]=d[c]);return k?a:d};e.parse=function(a){return this.export(a?l.expType.min:l.expType.normal)};e.pos=function(a){return q(this.e[a]?[this.e[a]]:[])};e.first=function(){return this.pos(0)};e.last=function(){return this.pos(this.e.length-1)};return e}var A={},J=[],F;var l=function(a,b){try{return x(a,b)}catch(f){l.conf.viewErr&&console.log(f),l.messages.push(f)}};(function(a,b){var f;
if(Object.defineProperty)for(f in b)Object.defineProperty(a,f,{enumerable:!0,value:b[f]});else for(f in b)a[f]=b[f]})(l,{version:"1.0b",init:function(a){a="length"in a?a:[a];for(var b=0;b<a.length;b++)if("sheet"in a[b]&&(a[b]=a[b].sheet),"cssRules"in a[b]){var f=(a[b].ownerNode.getAttribute("data-cssc-ignore")||"").toLowerCase();if("true"!==f&&"1"!==f)try{I(a[b].cssRules,null)}catch(c){l.conf.viewErr&&console.log('Cannot init CSS from "'+a[b].href+'"'),l.messages.push('Cannot init CSS from "'+a[b].href+
'"')}}},"import":function(a,b){return y(a)},"export":function(a){return x().export(a)},parse:function(a){return x().parse(a)},update:function(a){return x(a).update()},parseVars:function(a,b){return E(a,b)},objFromCss:function(a){return G(a)},cssFromObj:function(a,b,f){return v(a,b,f)},conf:w({styleId:"cssc-style",viewErr:!0}),type:w({rule:1,charset:2,"import":3,media:4,fontFace:5,page:6,keyframes:7,keyframe:8,namespace:10,counterStyle:11,supports:12,fontFeatureValues:14,viewport:15,names:w({1:"rule",
2:"charset",3:"import",4:"media",5:"font-face",6:"page",7:"keyframes",8:"keyframe",10:"namespace",11:"counter-style",12:"supports",14:"font-feature-values",15:"viewport"})}),expType:w({normal:"css",min:"minCss",obj:"obj",object:"object",notMDObject:"objNMD",array:"array"}),events:w({beforeChange:"beforechange",change:"change",beforeSet:"beforeset",set:"set",beforeCreate:"beforecreate",create:"create",beforeDelete:"beforedelete","delete":"delete",beforeDestroy:"beforedestroy",destroy:"destroy"})});
l.messages=[];l.vars={};return l}();
