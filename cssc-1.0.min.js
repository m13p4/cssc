/* CSSC.js | @version 1.0b |  m13p4 */
var CSSC=function(){var u={},k=null,y,n=function(a,b){return b?Object.prototype.toString.call(a):Object.prototype.toString.call(a).replace(/(^\[.+\s|\]$)/g,"")},C=function(a,b,e){var c="",d;b=b||"";if("String"===n(a))return a;for(d in a){var f=a[d];var g=n(a[d]);if("Object"===g||"Array"===g)for("Object"===g&&(f=[a[d]]),g=0;g<f.length;g++)if("@namespace"===d||"@import"===d||"@charset"===d)c+=d+" "+f[g]+";"+(e===k.export.type.min?"":"\n");else{var h=C(f[g],b+"  ",e);""!==h&&(c=e===k.export.type.min?
c+(d+"{"+h+"}"):c+(b+d.replace(/\s*,\s*/g,",\n"+b)+" {\n"+h+b+"}\n"))}else c="@namespace"===d||"@import"===d||"@charset"===d?c+(d+" "+f+";"+(e===k.export.type.min?"":"\n")):e===k.export.type.min?c+(d+":"+f+";"):c+((2>b.length?"  ":b)+d+": "+f+";\n")}return c},z=function(a,b){return(a=a.match(new RegExp(b+"s*:s*(.+?);")))?a[1].trim():""},A=function(a,b){"@"===b.charAt(0)&&"@"===a.charAt(0)&&(b=b.substr(1));b="/"===b.charAt(0)?b.substr(1):","===b.charAt(0)?", "+b.substr(1).trim():" "+b;if(0<=a.indexOf(",")||
0<b.indexOf(",")){a=a.split(",");var e,c="",d=b.split(",");if(","!==b.charAt(0))for(e=0;e<a.length;e++)for(b=0;b<d.length;b++)c+=a[e]+d[b]+", ";else for(e=0;e<a.length;e++)c+=a[e]+b+", ";return c.replace(/,+\s*$/,"")}return a+b},D=function(a){var b=a.parentRule?a.parentRule:a.parentStyleSheet,e;for(e=0;e<b.cssRules.length;e++)b.cssRules[e]===a&&b.deleteRule(e)},E=function(a,b){b||(b={});a||(a="");for(var e=a.lastIndexOf("$"),c,d=0,f,g,h,m,l;0<=e&&100>d;){d++;if("\\"!==a.charAt(e-1)){f=null;h=a.substr(e+
1);c=h.search(/[^\w\.]/);c=0>c?a.length:c+e;m=a.substr(e+1,c-e);h=m.split(".");for(g=0;g<h.length;g++)if(l=typeof f,0===g&&h[g]in b)f=b[h[g]];else if(0===g&&h[g]in k.vars)f=k.vars[h[g]];else if(null!==f&&"object"===l&&h[g]in f)f=f[h[g]];else if("string"===l&&h[g].match(/^[0-9]+$/))f=f.charAt(h[g]);else{f="$"+m;break}l=n(f);if("Function"===l&&"("===a.charAt(c+1)){c++;for(g=h=c;g=a.indexOf("(",g+1),c=a.indexOf(")",c+1),-1<g&&g<c;);0>c&&(c=a.length);h=a.substr(h+1,c-h-1);h=h.trim().split(/\s*,\s*/);
f=f.apply(null,h)}else"Function"===l&&(f=f());a=a.substr(0,e)+f+a.substr(c+1);"$"+m===f&&e--;if(-1===e)break}e=a.lastIndexOf("$",e)}return a},F=function(a,b){for(var e=0;e<a.length;e++){var c=a[e];c&&c.parentStyleSheet&&c.parentStyleSheet.ownerNode&&c.parentStyleSheet.ownerNode.id===k.conf.styleId||v(a[e],b)}},v=function(a,b,e){var c=a.cssText.substr(0,a.cssText.indexOf("{")).trim(),d=a.type,f=b?b.children:u;if(d!==k.type.rule&&d!==k.type.fontFace&&d!==k.type.media&&d!==k.type.keyframes&&d!==k.type.keyframe&&
d!==k.type.page&&d!==k.type.supports&&d!==k.type.namespace&&d!==k.type.import&&d!==k.type.charset)console.log("unsuported type: ["+d+"] - "+k.type.names[d]);else{d===k.type.namespace&&(c="@namespace");d===k.type.import&&(c="@import");d===k.type.charset&&(c="@charset");a._update=!1;d===k.type.rule&&(a.style._update={});b={indexElem:a,selector:c,csscSelector:e?e:c,children:!1,parent:b?b:!1,events:{},obj:{},type:d};f[c]?(f[c].content[0].indexElem===a&&(console.log('Dublicate "'+c+'": '),console.log(Error().stack+
"\n\n")),b=f[c].content.push(b)-1):(f[c]={type:d,content:[b],events:{}},b=0);if(d===k.type.media||d===k.type.keyframes||d===k.type.supports)f[c].content[b].children={},F(a.cssRules,f[c].content[b]);else{d=f[c].content[b];a=a.cssText;if(a.match(/^@(namespace|import|charset)/))a=a.replace(/(^@(namespace|import|charset)\s*|\s*;\s*$)/g,"");else{e=a.replace(/(^.*?{\s*|\s*}\s*$)/g,"");a=e.split(";");b={};if(""!==e)for(e=0;e<a.length;e++)if(""!==a[e]){var g=a[e].split(":");b[g[0].trim()]=g.slice(1).join(":").trim()}a=
b}d.obj=a}return f[c]}},t=function(a,b,e,c){var d;if(!c&&!y){if(document.getElementById(k.conf.styleId)){for(d=0;10>d;d++)if(!document.getElementById(k.conf.styleId+"-"+d)){k.conf.styleId=k.conf.styleId+"-"+d;break}if(document.getElementById(k.conf.styleId))throw Error("cann not create new element..");}d=document.createElement("style");d.setAttribute("type","text/css");d.setAttribute("id",k.conf.styleId);d.appendChild(document.createTextNode(""));document.head.appendChild(d);y=d}d=c?c.indexElem:y.sheet;
var f=d.cssRules.length,g="";if(b){var h=n(b);if("Object"===h)for(var m in b)"Function"===n(b[m])?(e=b[m](),g+=m+":"+e+"; "):g+=m+":"+b[m]+"; ";else if("Function"===h)for(m in e=b(),e)g+=m+":"+e[m]+"; ";else g=b+":"+e+";"}try{e=a+"{"+g+"}";if("@namespace"===a||"@import"===a||"@charset"===a)e=a+" "+b;return"@charset"!==a?("insertRule"in d?d.insertRule(e,f):"appendRule"in d?d.appendRule(e,f):"addRule"in d&&d.addRule(a,g,f),v(d.cssRules[f],c,a)):v({csscSelector:a,cssText:e,parent:!1,type:k.type.charset,
cssRules:{}},c,m)}catch(l){a=(c?'"'+c.selector+'" > ':"")+'"'+a+'" -> '+l,k.conf.viewErr&&console.log(a),k.messages.push(a)}return!1},G=function(a,b){b=b?b:u;return b[a]?b[a]:null},H=function(a,b,e){b=b?b:u;if(b[a]){var c=e?b[a].content.indexOf(e):-1;e?0<=c&&(b[a].content.splice(c,1),0>=b[a].content.length&&delete b[a]):delete b[a]}},r=function(a,b,e){b=b?b:u;var c=n(a);if("String"===c)return b=G(a,b),e?b?b.content:[]:p(b?b.content:[],a);if("RegExp"===c){c=[];for(var d in b)if(d.match(a))for(f=0;f<
b[d].content.length;f++)c.push(b[d].content[f]);return e?c:p(c,a)}if("Array"===c){c=[];var f;for(f=0;f<a.length;f++){var g=G(a[f],b);if(null!==g)for(d=0;d<g.content.length;d++)c.push(g.content[d])}return e?c:p(c,a)}if("Null"===c||"Undefined"===c){c=[];for(d in b)for(f=0;f<b[d].content.length;f++)c.push(b[d].content[f]);return e?c:p(c,a)}return null},w=function(a,b,e,c){var d=n(a);if("String"===d||"RegExp"===d||"Array"===d||"Null"===d||"Undefined"===d)return a=r(a,e,c),b?a.has(b):a;B(a)},B=function(a,
b){var e;for(d in a){var c="Array"===n(a[d])?a[d]:[a[d]];var d=E(d);for(e=0;e<c.length;e++)if("@"===d.charAt(0))if("@font-face"===d||"@namespace"===d||"@import"===d||"@charset"===d)t(d,c[e],null,b);else{if(d.match(/^@(media|keyframes|supports)/)||b&&(b.type===k.type.media||b.type===k.type.keyframes||b.type===k.type.supports)){var f=b;var g=d;b&&!g.match(/^@(media|keyframes|supports)/)&&(d=A(b.csscSelector,d),f=b.parent);var h=t(d,null,null,f);if(!h||h.content[h.content.length-1].selector!==h.content[h.content.length-
1].csscSelector){if(h){var m=h.content.length-1;D(h.content[m].indexElem);H(h.content[m].selector,h.content[m].parent,h.content[m])}h=d;m=d+" {}";f=f||!1;var l=d;l=l.trim();if("@"!==l.charAt(0))var q=k.type.rule;else{l=l.substr(1);q=l.indexOf(" ");0<=q&&(l=l.substr(0,q));q=l;if(0<=l.indexOf("-")){var x=l.split("-");q=x[0];for(l=1;l<x.length;l++)q+=x[l].charAt(0).toUpperCase()+x[l].substr(1)}q=q in k.type?k.type[q]:-1}f={csscSelector:h,cssText:m,parent:f,type:q,cssRules:{}};h=v(f,f.parent,d)}B(c[e],
h.content[h.content.length-1]);b&&(b.obj[g]||(b.obj[g]=[]),b.obj[g].push(h.content[h.content.length-1]))}}else if(h=t(d,null,null,b))g=p([h.content[h.content.length-1]],d),g.set(c[e])}},p=function(a,b,e,c){var d=function(){if(0>=f.e.length&&!e&&"String"===n(b)){var a,h=[],m,l;if(c)for(m=0;m<c.length;m++){if(a=t(b,null,null,c[m]))for(l=0;l<a.content.length;l++)h.push(a.content[l])}else if(a=t(b,null,null))h=a.content;f.e=h;f.eLength=h.length}};var f=function(a,b){var g,h,c=[];d();for(g=0;g<f.e.length;g++)if(f.e[g].children){var e=
w(a,b,f.e[g].children,!0);for(h=0;h<e.length;h++)c.push(e[h])}return p(c,a,null,f.e)};f.e=a;f.eLength=a.length;f.set=function(a,b,m){if("number"===typeof m){if(this.e[m].indexElem.type===k.type.fontFace)return k.conf.viewErr&&console.log('Element of Type "'+k.type.names[this.e[m].indexElem.type]+'" is readonly.'),k.messages.push('Element of Type "'+k.type.names[this.e[m].indexElem.type]+'" is readonly.'),this;a=E(a);if(this.e[m].children)r(null,this.e[m].children).set(a,b);else{var l,g=n(b);if("Object"===
g||"Array"===g){var h=A(this.e[m].selector,a);b="Object"===g?[b]:b;for(l=0;l<b.length;l++){g=null;if("@"===a.charAt(0)){if(g=r(this.e[m].parent?A(this.e[m].parent.selector,a):a),g=g(this.e[m].selector),g.set(b[l]),g=g.e[g.e.length-1],this.e[m].parent){var c=this.e[m].parent;c.obj[a]&&"push"in c.obj[a]||(c.obj[a]=[]);c.obj[a].push(g.parent)}}else if(c=t(h,null,null,this.e[m].parent))g=p([c.content[c.content.length-1]],e),g.set(b[l]),g=c.content[c.content.length-1];null!==g&&(this.e[m].obj[a]&&"push"in
this.e[m].obj[a]||(this.e[m].obj[a]=[]),this.e[m].obj[a].push(g))}}else if("Function"===g){var e=this.pos(m).get(a);try{l=b(e),this.set(a,l,m),this.e[m].indexElem.style._update[a]=b}catch(I){k.conf.viewErr&&console.log(I),k.messages.push(I)}}else{a:if(isFinite(b))l=0===b%1?b+"px":Math.floor(100*b)/100+"px";else{if("String"===n(b)&&(l=b.split(" "),0<l.length)){for(b=0;b<l.length;b++)isFinite(l[b])&&(e=l[b],l[b]=0===e%1?e+"px":Math.floor(100*e)/100+"px");l=l.join(" ");break a}l=b}this.e[m].indexElem.style[a]=
l;this.e[m].obj[a]=l}}}else if(m=n(a),"Object"===m?h=Object.keys(a).length:"Function"===m&&(g=a()),d(),"Array"===m||"Function"===m&&"Array"===n(g))for(m="Array"===m?a:g,l=0;l<m.length;l++)if(a=this.pos(l),1===a.e.length)a.set(m[l]);else break;else for(l=0;l<this.e.length;l++)if("Object"===m&&0<h)for(e in a)this.set(e,a[e],l);else if("Function"===m){for(e in g)this.set(e,g[e],l);this.e[l].indexElem._update=a}else this.set(a,b,l);return this};f.get=function(a,b){if(!a)return this.export(k.export.type.object);
var g=[],l="",d;b=!!b;for(d=0;d<this.e.length;d++){var c="";this.e[d].obj[a]&&(c=this.e[d].obj[a],"Array"===n(c)&&(c=p(c),c=c.export(k.export.type.object)));c&&""!==c||(c=this.e[d].indexElem.style[a]);c&&""!==c||(c=z(this.e[d].indexElem.cssText,a));c&&(l=c,b&&g.push(l))}return b?g:l};f.has=function(a){var g=[];var c=n(a);if("String"===c){var d=a.split(":");for(c=0;c<this.e.length;c++){var e=z(this.e[c].indexElem.cssText,d[0]);""!==e&&(!d[1]||d[1]&&d[1].replace(/ |;/g,"")===e)&&g.push(this.e[c])}}else if("Array"===
c)for(var f=0;f<a.length;f++)for(d=a[f].split(":"),c=0;c<this.e.length;c++)e=z(this.e[c].indexElem.cssText,d[0]),""!==e&&(!d[1]||d[1]&&d[1].replace(/ |;/g,"")===e)&&g.push(this.e[c]);else if("RegExp"===c)for(c=0;c<this.e.length;c++)if(d=this.e[c].indexElem.cssText.match(/[\S]+:.+?;/g))for(f=0;f<d.length;f++)(e=d[f].match(a))&&g.push(this.e[c]);return p(g,b,!0)};f.update=function(){var a,b;for(a=0;a<this.e.length;a++){if(!1!==this.e[a].indexElem._update){var c=this.e[a].indexElem._update();for(b in c)this.set(b,
c[b],a)}if(this.e[a].children)r(null,this.e[a].children).update();else if(this.e[a].indexElem.style)for(b in this.e[a].indexElem.style._update)c=this.e[a].indexElem.style._update[b](),this.set(b,c,a)}return this};f.delete=function(a){var b;if("undefined"===typeof a)for(b=0;b<this.e.length;b++){if(D(this.e[b].indexElem),H(this.e[b].selector,this.e[b].parent?this.e[b].parent:null,this.e[b]),this.e[b].children){var c=r(null,this.e[b].children);c.delete(a)}}else for(b=0;b<this.e.length;b++)this.e[b].indexElem.style[a]=
"",this.e[b].children&&(c=r(null,this.e[b].children),c.delete(a));return this};f.export=function(a,b){var c={},d,e,f,g=a;a===k.export.type.obj&&(a=k.export.type.object);if(a===k.export.type.normal||a===k.export.type.min)a=k.export.type.notMDObject;b||(b=[]);for(d=0;d<this.e.length;d++)if(!(0<=b.indexOf(this.e[d]))){if(this.e[d].type===k.type.namespace||this.e[d].type===k.type.import||this.e[d].type===k.type.charset)var h=this.e[d].obj;else for(f in h=Object.assign({},this.e[d].obj),this.e[d].obj)if("object"===
typeof this.e[d].obj[f]&&"length"in this.e[d].obj[f])if(a===k.export.type.notMDObject)h[f]=null,delete h[f];else{h[f]=[];for(e=0;e<this.e[d].obj[f].length;e++)if(!(0<=b.indexOf(this.e[d].obj[f][e]))){var n=p([this.e[d].obj[f][e]]);n=n.export(a,b)[this.e[d].obj[f][e].selector];b.push(this.e[d].obj[f][e]);!n||0>=Object.keys(n).length||(h[f][e]=n)}0===h[f].length?delete h[f]:1===h[f].length&&(h[f]=h[f][0])}this.e[d].children&&(n=r(null,this.e[d].children),h=Object.assign(n.export(a,b),h));0>=Object.keys(h).length||
(c[this.e[d].selector]?("object"===typeof c[this.e[d].selector]&&"length"in c[this.e[d].selector]||(c[this.e[d].selector]=[c[this.e[d].selector]]),c[this.e[d].selector].push(h)):c[this.e[d].selector]=h,b.push(this.e[d]))}a={};c["@charset"]&&(a["@charset"]=c["@charset"]);c["@import"]&&(a["@import"]=c["@import"]);c["@namespace"]&&(a["@namespace"]=c["@namespace"]);c["@font-face"]&&(a["@font-face"]=c["@font-face"]);if(n=0<Object.keys(a).length)for(d in c)a[d]||(a[d]=c[d]);return g===k.export.type.normal||
g===k.export.type.min?C(n?a:c,null,g):n?a:c};f.pos=function(a){return p(this.e[a]?[this.e[a]]:[])};f.first=function(){return this.pos(0)};f.last=function(){return this.pos(this.e.length-1)};return f};k=function(a,b){try{return w(a,b)}catch(e){k.conf.viewErr&&console.log(e),k.messages.push(e)}};k.import=function(a){return B(a)};k.export=function(a){return w().export(a)};k.update=function(a){return w(a).update()};k.init=function(a){a="length"in a?a:[a];for(var b=0;b<a.length;b++)if("sheet"in a[b]&&
(a[b]=a[b].sheet),"cssRules"in a[b]){var e=(a[b].ownerNode.getAttribute("data-cssc-ignore")||"").toLowerCase();if("true"!==e&&"1"!==e)try{F(a[b].cssRules,null)}catch(c){k.conf.viewErr&&console.log('Cannot init CSS from "'+a[b].href+'"'),k.messages.push('Cannot init CSS from "'+a[b].href+'"')}}};k.type={rule:1,charset:2,"import":3,media:4,fontFace:5,page:6,keyframes:7,keyframe:8,namespace:10,counterStyle:11,supports:12,fontFeatureValues:14,viewport:15,names:{1:"rule",2:"charset",3:"import",4:"media",
5:"font-face",6:"page",7:"keyframes",8:"keyframe",10:"namespace",11:"counter-style",12:"supports",14:"font-feature-values",15:"viewport"}};k.events={beforeChange:"beforechange",change:"change",beforeSet:"beforeset",set:"set",beforeCreate:"beforecreate",create:"create",beforeDelete:"beforedelete","delete":"delete",beforeDestroy:"beforedestroy",destroy:"destroy"};k.export.type={normal:"css",min:"minCss",obj:"obj",object:"object",notMDObject:"objNMDO"};k.conf={styleId:"cssc-style",viewErr:!0};k.messages=
[];k.vars={};return k}();
