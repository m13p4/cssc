/* CSSC.js | @version 1.0b |  m13p4 */
var CSSC=function(){function p(a,d){return d?Object.prototype.toString.call(a):Object.prototype.toString.call(a).replace(/(^\[.+\s|\]$)/g,"")}function I(a){if(a.match(/^@(namespace|import|charset)/))return a.replace(/(^@(namespace|import|charset)\s*|\s*;\s*$)/g,"");var d=a.replace(/(^.*?{\s*|\s*}\s*$)/g,"");a=d.split(";");var b={};if(""!==d)for(d=0;d<a.length;d++)if(""!==a[d]){var c=a[d].split(":");b[c[0].trim()]=c.slice(1).join(":").trim()}return b}function x(a,d,b,c,e){var g="",f=Array((parseInt(b)||
2)+1).join(" "),k,h=p(a);c=c||"";if("String"===h)return a;if("Array"===h)for(h=0;h<a.length;h++)g+=x(a[h],d,b,c,!0);else for(k in a){var l=a[k];h=p(a[k]);if("Object"===h||"Array"===h)if(e&&"Array"===h){var m=x(a[k],d,b,c+f,e);""!==m&&(g=d?g+(k.replace(/\s*(,|:)\s*/g,"$1")+"{"+m+"}"):g+(c+k.replace(/\s*,\s*/g,",\n"+c)+" {\n"+m+c+"}\n"))}else for("Object"===h&&(l=[a[k]]),h=0;h<l.length;h++)"@namespace"===k||"@import"===k||"@charset"===k?g+=k+" "+l[h]+";"+(d?"":"\n"):(m=x(l[h],d,b,c+f,e),""!==m&&(g=
d?g+(k.replace(/\s*(,|:)\s*/g,"$1")+"{"+m+"}"):g+(c+k.replace(/\s*,\s*/g,",\n"+c)+" {\n"+m+c+"}\n")));else g="@namespace"===k||"@import"===k||"@charset"===k?g+(k+" "+l+";"+(d?"":"\n")):d?g+(k+":"+l.trim().replace(/\s*,\s*/g,",")+";"):g+((c.length<f.length?f:c)+k+": "+l+";\n")}return g}function E(a,d){"@"===d.charAt(0)&&"@"===a.charAt(0)&&(d=d.substr(1));d="/"===d.charAt(0)?d.substr(1):","===d.charAt(0)?", "+d.substr(1).trim():" "+d;if(0<=a.indexOf(",")||0<d.indexOf(",")){a=a.split(",");var b,c="",
e=d.split(",");if(","!==d.charAt(0))for(b=0;b<a.length;b++)for(d=0;d<e.length;d++)c+=a[b]+e[d]+", ";else for(b=0;b<a.length;b++)c+=a[b]+d+", ";return c.replace(/,+\s*$/,"")}return a+d}function J(a){var d=a.parentRule?a.parentRule:a.parentStyleSheet,b;for(b=0;b<d.cssRules.length;b++)d.cssRules[b]===a&&d.deleteRule(b)}function F(a,d){d?"Array"!==p(d)&&(d=[d]):d=[{}];a||(a="");for(var b=a.lastIndexOf("$"),c,e=0,g,f,k,h,l,m;0<=b&&100>e;){e++;g=null;h=a.substr(b+1);c=h.search(/[^\w\.]/);c=0>c?a.length:
c+b;l=a.substr(b+1,c-b);m=l.split(".");for(f=0;f<m.length;f++)if(!(1>m[f].length)){k=typeof g;if(0===f)for(k=d.length-1;0<=k;k--){if(m[f]in d[k]){g=d[k][m[f]];break}}else if(null!==g&&"object"===k&&m[f]in g)g=g[m[f]];else if("string"===k&&m[f].match(/^[0-9]+$/))g=g.charAt(m[f]);else{g="$"+l;break}if("function"===typeof g){if("("===a.charAt(c+1)){c++;k=h=c;do k=a.indexOf("(",k+1),c=a.indexOf(")",c+1);while(-1<k&&k<c);0>c&&(c=a.length);h=a.substr(h+1,c-h-1);h=h.trim().split(/\s*,\s*/);g=g.apply(null,
h)}else g=g();if("."===a.charAt(c+1))for(c++,k=c,h=a.substr(c+1),c=h.search(/[^\w\.]/),h=h.substr(0,0>c?h.length:c),c=0>c?a.length:c+k,l=a.substr(b+1,c-b),h=h.split("."),k=0;k<h.length;k++)m.push(h[k])}}a=a.substr(0,b)+g+a.substr(c+1);c="$"+l===g?b:c+(g.length-1);if(0>--c)break;b=a.lastIndexOf("$",c)}return a}function K(a,d){var b;if(Object.defineProperty)for(b in d)Object.defineProperty(a,b,{enumerable:!0,value:d[b]});else for(b in d)a[b]=d[b]}function G(a){if(Object.freeze)return Object.freeze(a);
if(Object.defineProperty){var d={},b;for(b in a)Object.defineProperty(d,b,{enumerable:!0,value:a[b]});a=d}Object.preventExtensions&&Object.preventExtensions(a);return a}function L(a,d,b){for(var c=0;c<d.length;c++)d[c]&&d[c].parentStyleSheet&&d[c].parentStyleSheet.ownerNode&&d[c].parentStyleSheet.ownerNode.id===a[4].styleId&&C(a,d[c],b)}function C(a,d,b,c){var e=d.cssText.substr(0,d.cssText.indexOf("{")).trim(),g=d.type,f=b?b.children:a[0];if(1!==g&&5!==g&&4!==g&&7!==g&&8!==g&&6!==g&&12!==g&&10!==
g&&3!==g&&2!==g)console.log("unsuported type: "+g);else return 10===g&&(e="@namespace"),3===g&&(e="@import"),2===g&&(e="@charset"),d._update=!1,1===g&&(d.style._update={}),a[2]++,a={indexElem:d,selector:e,csscSelector:c?c:e,children:!1,parent:b?b:!1,events:{},obj:{},type:g,p:a[2]},f[e]?(f[e].content[0].indexElem===d&&(console.log('Dublicate "'+e+'": '),console.log(Error().stack+"\n\n")),a=f[e].content.push(a)-1):(f[e]={type:g,content:[a],events:{}},a=0),4===g||7===g||12===g?(f[e].content[a].children=
{},L(d.cssRules,f[e].content[a])):f[e].content[a].obj=I(d.cssText),f[e]}function t(a,d,b,c,e){if(!e&&!a[1]){var g=a[4];if(document.getElementById(g.styleId)){for(var f=0;10>f;f++)if(!document.getElementById(g.styleId+"-"+f)){g.styleId=g.styleId+"-"+f;break}if(document.getElementById(g.styleId))throw Error("cann not create new element..");}f=document.createElement("style");f.setAttribute("type","text/css");f.setAttribute("id",g.styleId);f.appendChild(document.createTextNode(""));document.head.appendChild(f);
a[1]=f}g=e?e.indexElem:a[1].sheet;f=g.cssRules.length;var k="";if(b){var h=p(b);if("Object"===h)for(var l in b)"Function"===p(b[l])?(c=b[l](),k+=l+":"+c+"; "):k+=l+":"+b[l]+"; ";else if("Function"===h)for(l in c=b(),c)k+=l+":"+c[l]+"; ";else k=b+":"+c+";"}try{c=d+"{"+k+"}";if("@namespace"===d||"@import"===d||"@charset"===d)c=d+" "+b;return"@charset"!==d?("insertRule"in g?g.insertRule(c,f):"appendRule"in g?g.appendRule(c,f):"addRule"in g&&g.addRule(d,k,f),C(a,g.cssRules[f],e,d)):C(a,{csscSelector:d,
cssText:c,parent:!1,type:2,cssRules:{}},e,l)}catch(m){d=(e?'"'+e.selector+'" > ':"")+'"'+d+'" -> '+m,a[4].viewErr&&console.log(d),v.push(d)}return!1}function M(a,d,b){if(a&&a[d]){var c=b?a[d].content.indexOf(b):-1;b?0<=c&&(a[d].content.splice(c,1),0>=a[d].content.length&&delete a[d]):delete a[d]}}function w(a,d,b){var c=p(d),e="Array"===p(a)?a[0]:a;if("String"===c)return b?e[d]?e[d]:[]:u(a,e[d]?e[d]:[],d);if("RegExp"===c){c=[];for(var g in e)if(g.match(d))for(f=0;f<e[g].content.length;f++)c.push(e[g].content[f]);
return b?c:u(a,c,d)}if("Array"===c){c=[];var f;for(f=0;f<d.length;f++)if(e[d])for(g=0;g<e[d].content.length;g++)c.push(e[d].content[g]);return b?c:u(a,c,d)}if("Null"===c||"Undefined"===c){c=[];for(g in e)for(f=0;f<e[g].content.length;f++)c.push(e[g].content[f]);return b?c:u(a,c,d)}return null}function y(a,d,b,c){var e=p(d);if("String"===e||"RegExp"===e||"Array"===e||"Null"===e||"Undefined"===e)a=w(a,d,c);else return z(a,d);return b?a.has(b):a}function z(a,d,b,c){var e,g={};c||b||("@charset"in d&&
(g["@charset"]=d["@charset"]),"@import"in d&&(g["@import"]=d["@import"]),"@namespace"in d&&(g["@namespace"]=d["@namespace"]),"@font-face"in d&&(g["@font-face"]=d["@font-face"]),0<Object.keys(g).length&&z(a,g,b,!0));for(f in d)if(!(f in g)){c="Array"===p(d[f])?d[f]:[d[f]];var f=F(f,a[3]);for(e=0;e<c.length;e++)if("@"===f.charAt(0))if("@font-face"===f||"@namespace"===f||"@import"===f||"@charset"===f)t(a,f,c[e],null,b);else{if(f.match(/^@(media|keyframes|supports)/)||b&&(4===b.type||7===b.type||12===
b.type)){var k=b;var h=f;b&&!h.match(/^@(media|keyframes|supports)/)&&(f=E(b.csscSelector,f),k=b.parent);var l=t(a,f,null,null,k);var m=(l?l.content.length:0)-1;if(-1<m&&l.content[m].selector===l.content[m].csscSelector)z(a,c[e],l.content[m]);else{-1<m&&(J(l.content[m].indexElem),M(l.content[m].parent?l.content[m].parent:a,l.content[m].selector,l.content[m]));l=f;m=f+" {}";k=k||!1;var n=f;n=n.trim();if("@"!==n.charAt(0))var q=1;else{n=n.substr(1);q=n.indexOf(" ");0<=q&&(n=n.substr(0,q));q=n;if(0<=
n.indexOf("-")){var D=n.split("-");q=D[0];for(n=1;n<D.length;n++)q+=D[n].charAt(0).toUpperCase()+D[n].substr(1)}q=q in H?H[q]:-1}k={csscSelector:l,cssText:m,parent:k,type:q,cssRules:{}};l=C(a,k,k.parent,f);z(a,c[e],l.content[l.content.length-1])}b&&(b.obj[h]||(b.obj[h]=[]),b.obj[h].push(l.content[l.content.length-1]))}}else(l=t(a,f,null,null,b))&&r(a,[l.content[l.content.length-1]],c[e])}}function r(a,d,b,c,e){if("number"===typeof e)if(5===d[e].indexElem.type)a[4].viewErr&&console.log("@font-face rules are readonly."),
v.push("@font-face rules are readonly.");else if(b=F(b,a[3]),d[e].children)w(d[e].children).set(b,c);else{var g=p(c);if("Object"===g||"Array"===g){var f="@"===b.charAt(0),k;g="Object"===g?[c]:c;var h,l=E(d[e].selector,b);f&&(l=d[e].parent?E(d[e].parent.selector,b):b);for(h=0;h<g.length;h++)if(k=t(a,l,null,null,f?!1:d[e].parent)){var m=k.content.length-1;f&&(c=k,(k=t(a,d[e].selector,null,null,k.content[m]))?m=k.content.length-1:k=c);c=k.content[m];r(a,[c],g[h]);f&&d[e].parent&&(k=d[e].parent,k.obj[b]&&
"push"in k.obj[b]||(k.obj[b]=[]),k.obj[b].push(c.parent));d[e].obj[b]&&"push"in d[e].obj[b]||(d[e].obj[b]=[]);d[e].obj[b].push(c)}}else if("Function"===g){f=A(a,d,e).get(b);try{h=c(f),r(a,d,b,h,e),d[e].indexElem.style._update[b]=c}catch(n){a[4].viewErr&&console.log(n),v.push(n)}}else{a:if(isFinite(c))a=0===c%1?c+"px":Math.floor(100*c)/100+"px";else{if("String"===p(c)&&(a=c.split(" "),0<a.length)){for(c=0;c<a.length;c++)isFinite(a[c])&&(h=a[c],a[c]=0===h%1?h+"px":Math.floor(100*h)/100+"px");a=a.join(" ");
break a}a=c}d[e].indexElem.style[b]=a;d[e].obj[b]=a}}else if(e=p(b),"Object"===e?f=Object.keys(b).length:"Function"===e&&(l=b()),"Array"===e||"Function"===e&&"Array"===p(l))for(e="Array"===e?b:l,h=0;h<e.length;h++)if(b=A(a,d,h),1===b.e.length)b.set(e[h]);else break;else for(h=0;h<d.length;h++)if("Object"===e&&0<f)for(g in b)r(a,d,g,b[g],h);else if("Function"===e){for(g in l)r(a,d,g,l[g],h);d[h].indexElem._update=b}else r(a,d,b,c,h)}function B(a,d,b){var c={},e,g,f,k=d;"obj"===d&&(d="object");if("css"===
d||"minCss"===d)d="array";b||(b=[]);for(e=0;e<a.length;e++)if(!(0<=b.indexOf(a[e]))){if(10===a[e].type||3===a[e].type||2===a[e].type)var h=a[e].obj;else for(f in h=Object.assign({},a[e].obj),a[e].obj)if("object"===typeof a[e].obj[f]&&"length"in a[e].obj[f])if("objNMD"===d||"array"===d)h[f]=null,delete h[f];else{h[f]=[];for(g=0;g<a[e].obj[f].length;g++)if(!(0<=b.indexOf(a[e].obj[f][g]))){var l=B([a[e].obj[f][g]],d,b)[a[e].obj[f][g].selector];b.push(a[e].obj[f][g]);!l||0>=Object.keys(l).length||(h[f][g]=
l)}0===h[f].length?delete h[f]:1===h[f].length&&(h[f]=h[f][0])}a[e].children&&(l=w(a[e].children),h=Object.assign(l.export(d,b),h));0>=Object.keys(h).length||("array"===d?(c[a[e].p]={},c[a[e].p][a[e].selector]=h):c[a[e].selector]?("object"===typeof c[a[e].selector]&&"length"in c[a[e].selector]||(c[a[e].selector]=[c[a[e].selector]]),c[a[e].selector].push(h)):c[a[e].selector]=h,b.push(a[e]))}if("array"===d)return c=Object.values(c),d===k?c:x(c,"minCss"===k);a={};c["@charset"]&&(a["@charset"]=c["@charset"]);
c["@import"]&&(a["@import"]=c["@import"]);c["@namespace"]&&(a["@namespace"]=c["@namespace"]);c["@font-face"]&&(a["@font-face"]=c["@font-face"]);if(l=0<Object.keys(a).length)for(e in c)a[e]||(a[e]=c[e]);return l?a:c}function A(a,d,b,c,e){0>b&&(b+=d.length);return d[b]?u(a,[d[b]],c,!1,d[b].parent?d[b].parent:!1):u(a,[],c,!1,e)}function N(a){for(var d=[],b=0;b<a.length;b++)a[b].indexElem&&d.push(a[b].indexElem);return d}function u(a,d,b,c,e){function g(){if(0>=d.length&&!c&&"String"===p(b)){var a,h=
[],g,m;if(e)for(g=0;g<e.length;g++){if(a=t(b,null,null,e[g]))for(m=0;m<a.content.length;m++)h.push(a.content[m])}else if(a=t(b,null,null))h=a.content;d=h;f.e=N(d);f.selector=1===d.length?d[0].selector:b}}var f=function(b,c){var e,h,f=[];g();for(e=0;e<d.length;e++)if(d[e].children){var k=y(d[e].children,b,c,!0);for(h=0;h<k.length;h++)f.push(k[h])}return u(a,f,b,null,d)};f.e=N(d);f.selector=1===d.length?d[0].selector:b;K(f,{set:function(b,c,e){g();r(a,d,b,c,e);return this},get:function(a,b){var c=d;
if(a){var e=[],g="",h;b=!!b;for(h=0;h<c.length;h++){var f="";c[h].obj[a]&&(f=c[h].obj[a],"Array"===p(f)&&(f=B(f,"object")));f&&""!==f||(f=c[h].indexElem.style[a]);f&&""!==f||(f=(f=c[h].indexElem.cssText.match(new RegExp(a+"s*:s*(.+?);")))?f[1].trim():"");f&&(g=f,b&&e.push(g))}a=b?e:g}else a=B("object");return a},update:function(){var a=d,b,c;for(b=0;b<a.length;b++){if(!1!==a[b].indexElem._update){var e=a[b].indexElem._update();for(c in e)r(c,e[c],b)}if(a[b].children)w(a[b].children).update();else if(a[b].indexElem.style)for(c in a[b].indexElem.style._update)r(c,
a[b].indexElem.style._update[c](),b)}return this},"delete":function(b){var c=d,e;if("undefined"===typeof b)for(e=0;e<c.length;e++)c[e].children&&w(c[e].children).delete(b),J(c[e].indexElem),M(c[e].parent?c[e].parent:a,c[e].selector,c[e]);else for(e=0;e<c.length;e++)c[e].indexElem.style[b]="",c[e].children&&w(c[e].children).delete(b);return this},"export":function(a){return B(d,a)},parse:function(a){return B(d,a?"minCss":"css")},pos:function(c){return A(a,d,c,b,e)},first:function(){return A(a,d,0,
b,e)},last:function(){return A(a,d,-1,b,e)}});return f}var H=G({rule:1,charset:2,"import":3,media:4,fontFace:5,page:6,keyframes:7,keyframe:8,namespace:10,counterStyle:11,supports:12,fontFeatureValues:14,viewport:15}),O=G({normal:"css",min:"minCss",obj:"obj",object:"object",notMDObject:"objNMD",array:"array"}),v=[];return function(){var a=[{},!1,0,[],{}],d=function(b,c){try{return y(a,b,c)}catch(e){a[4].viewErr&&console.log(e),v.push(e)}};K(d,{version:"1.0b",init:function(b){b="length"in b?b:[b];for(var c=
0;c<b.length;c++)if("sheet"in b[c]&&(b[c]=b[c].sheet),"cssRules"in b[c]){var d=(b[c].ownerNode.getAttribute("data-cssc-ignore")||"").toLowerCase();if("true"!==d&&"1"!==d)try{L(a,b[c].cssRules,null)}catch(g){a[4].viewErr&&console.log('Cannot init CSS from "'+b[c].href+'"'),v.push('Cannot init CSS from "'+b[c].href+'"')}}},"import":function(b,c){return z(a,b)},"export":function(b){return y(a).export(b)},parse:function(b){return y(a).parse(b)},update:function(b){return y(a,b).update()},defineVars:function(b){a[3]=
[b];return this},addVars:function(b){a[3].push(b);return this},getVars:function(){return a[3]},defineConf:function(b){a[4]=b;return this},setConf:function(b,c){a[4][b]=c;return this},getConf:function(b){return b?a[4][b]:a[4]},parseVars:function(a,c){return F(a,c?c:d.vars)},objFromCss:function(a){return I(a)},cssFromObj:function(a,c,d){return x(a,c,d)},_conf:G({styleId:"cssc-style",viewErr:!0}),type:H,exportType:O,messages:v});d.defineConf(d._conf);return d}()}();
