/*
@version 1.0b
@author m13p4
@copyright Meliantchenkov Pavel
*/
var CSSC=function(){var w;return function(m,G){var p={},x=!1,h=null,z=function(){if(!x){if("cssRules"in m){var a=(m.ownerNode.getAttribute("data-cssc-ignore")||"").toLowerCase();if("true"!==a&&"1"!==a)try{y(m.cssRules,null)}catch(c){h.conf.viewErr&&console.log('Cannot init CSS from "'+m.href+'"'),h.messages.push('Cannot init CSS from "'+m.href+'"')}}else if("length"in m)for(var b=0;b<m.length;b++)if(a=(m[b].ownerNode.getAttribute("data-cssc-ignore")||"").toLowerCase(),"true"!==a&&"1"!==a)try{y(m[b].cssRules,
null)}catch(c){h.conf.viewErr&&console.log('Cannot init CSS from "'+m[b].href+'"'),h.messages.push('Cannot init CSS from "'+m[b].href+'"')}x=!0}},y=function(a,b){for(var c=0;c<a.length;c++)n.isElemInOwnNode(a[c])||C(a[c],b)},C=function(a,b){var c=a.cssText.substr(0,a.cssText.indexOf("{")).trim(),d=a.type,e=b?b.children:p;if(d!==h.ruleType.rule&&d!==h.ruleType.fontFace&&d!==h.ruleType.media&&d!==h.ruleType.keyframes&&d!==h.ruleType.keyframe&&d!==h.ruleType.page&&d!==h.ruleType.supports)console.log("unsuported type: ["+
d+"] - "+h.ruleType.names[d]);else return a._update=!1,d===h.ruleType.rule&&(a.style._update={}),b={indexElem:a,selector:c,children:!1,parent:b?b:!1,events:{},obj:{},type:d},e[c]?(e[c].content[0].indexElem===a&&(console.log('Dublicate "'+c+'": '),console.log(Error().stack+"\n\n")),b=e[c].content.push(b)-1):(e[c]={type:d,content:[b],events:{}},b=0),d===h.ruleType.media||d===h.ruleType.keyframes||d===h.ruleType.supports?(e[c].content[b].children={},y(a.cssRules,e[c].content[b])):e[c].content[b].obj=
n.objFromCssText(a.cssText),e[c]},u=function(a,b,c,d){d||w||n.createNewStyleElem();var e=d?d.indexElem:w.sheet;var g=e.cssRules.length,k="";if(b){var f=n.elemType(b);if("Object"===f)for(var t in b)"Function"===n.elemType(b[t])?(c=b[t](),k+=t+":"+c+"; "):k+=t+":"+b[t]+"; ";else if("Function"===f)for(t in c=b(),c)k+=t+":"+c[t]+"; ";else k=b+":"+c+";"}try{return"insertRule"in e?e.insertRule(a+"{"+k+"}",g):"appendRule"in e?e.appendRule(a+"{"+k+"}",g):"addRule"in e&&e.addRule(a,k,g),C(e.cssRules[g],d)}catch(D){h.conf.viewErr&&
console.log('"'+a+'" -> '+D),h.messages.push('"'+a+'" -> '+D)}return!1},E=function(a,b){x||z();b=b?b:p;return b[a]?b[a]:null},v=function(a,b,c){b=b?b:p;var d=n.elemType(a);if("String"===d)return b=E(a,b),c?b?b.content:[]:q(b?b.content:[],a);if("RegExp"===d){d=[];for(var e in b)if(e.match(a))for(g=0;g<b[e].content.length;g++)d.push(b[e].content[g]);return c?d:q(d,a)}if("Array"===d){d=[];var g;for(g=0;g<a.length;g++){var k=E(a[g],b);if(null!==k)for(e=0;e<k.content.length;e++)d.push(k.content[e])}return c?
d:q(d,a)}if("Null"===d||"Undefined"===d){d=[];for(e in b)for(g=0;g<b[e].content.length;g++)d.push(b[e].content[g]);return c?d:q(d,a)}return null},B=function(a,b,c,d){var e=n.elemType(a);if("String"===e||"RegExp"===e||"Array"===e||"Null"===e||"Undefined"===e)return a=v(a,c,d),b?a.has(b):a;A(a,null,c)},A=function(a,b){var c,d,e;for(d in a){var g="Array"===n.elemType(a[d])?a[d]:[a[d]];for(e=0;e<g.length;e++)if("@font-face"===d)u(d,g[e],null,b);else if(d.match(/^@(media|keyframes|supports)/)){if(c=u(d,
null,null,b)){var k=c.content.length-1;A(g[e],c.content[k])}}else if(c=u(d,null,null,b))c=q([c.content[c.content.length-1]],d),c.set(g[e])}},q=function(a,b,c,d){var e=function(a,b){var f,g,k=[];for(f=0;f<e.e.length;f++)if(e.e[f].children){var c=B(a,b,e.e[f].children,!0);for(g=0;g<c.length;g++)k.push(c[g])}return q(k,a,null,e.e)};e.e=a;e.eLength=a.length;e.set=function(a,k,f){if("number"===typeof f){if(this.e[f].indexElem.type===h.ruleType.fontFace)return h.conf.viewErr&&console.log('Element of Type "'+
h.ruleType.names[this.e[f].indexElem.type]+'" is readonly.'),h.messages.push('Element of Type "'+h.ruleType.names[this.e[f].indexElem.type]+'" is readonly.'),this;if(this.e[f].children)v(null,this.e[f].children).set(a,k);else{var g=n.elemType(k);if("Object"===g||"Array"===g){var e=this.e[f].selector+" "+a;k="Object"===g?[k]:k;var l;a.match(/^(\[|:|\/)/)&&(e=this.e[f].selector+a.replace(/^\//,""));for(l=0;l<k.length;l++)if(g=u(e,null,null,this.e[f].parent))q([g.content[g.content.length-1]],r).set(k[l]),
this.e[f].obj[a]&&this.e[f].obj[a].indexElem?this.e[f].obj[a]=[this.e[f].obj[a],g.content[g.content.length-1]]:this.e[f].obj[a]&&"push"in this.e[f].obj[a]?this.e[f].obj[a].push(g.content[g.content.length-1]):this.e[f].obj[a]=g.content[g.content.length-1]}else if("Function"===g){var r=this.pos(f).get(a);try{l=k(r),this.set(a,l,f),this.e[f].indexElem.style._update[a]=k}catch(F){h.conf.viewErr&&console.log(F),h.messages.push(F)}}else k=n.parseValue(k),this.e[f].indexElem.style[a]=k,this.e[f].obj[a]=
k}}else{var m;f=n.elemType(a);"Object"===f?e=Object.keys(a).length:"Function"===f&&(m=a());if(0>=this.e.length&&!c&&"String"===n.elemType(b)){var p=[];if(d)for(p=[],l=0;l<d.length;l++){if(g=u(b,null,null,d[l].indexElem,d[l].children))for(r=0;r<g.content.length;r++)p.push(g.content[r])}else if(g=u(b,null,null))p=g.content;this.e=p;this.eLength=p.length}if("Array"===f||"Function"===f&&"Array"===n.elemType(m))for(k="Array"===f?a:m,l=0;l<k.length;l++)if(a=this.pos(l),1===a.e.length)a.set(k[l]);else break;
else for(l=0;l<this.e.length;l++)if("Object"===f&&0<e)for(r in a)this.set(r,a[r],l);else if("Function"===f){for(r in m)this.set(r,m[r],l);this.e[l].indexElem._update=a}else this.set(a,k,l)}return this};e.get=function(a,b){if(!a)return this.export(h.export.type.object);var f=[],g="",k;b=!!b;for(k=0;k<this.e.length;k++){var c="";this.e[k].obj[a]&&!this.e[k].obj[a].selector&&(c=this.e[k].obj[a]);c&&""!==c||(c=this.e[k].indexElem.style[a]);c&&""!==c||(c=n.findPropInCssText(this.e[k].indexElem.cssText,
a));c&&(g=c,b&&f.push(g))}return b?f:g};e.has=function(a){var g=[];var f=n.elemType(a);if("String"===f){var c=a.split(":");for(f=0;f<this.e.length;f++){var e=n.findPropInCssText(this.e[f].indexElem.cssText,c[0]);""!==e&&(!c[1]||c[1]&&c[1].replace(/ |;/g,"")===e)&&g.push(this.e[f])}}else if("Array"===f)for(var d=0;d<a.length;d++)for(c=a[d].split(":"),f=0;f<this.e.length;f++)e=n.findPropInCssText(this.e[f].indexElem.cssText,c[0]),""!==e&&(!c[1]||c[1]&&c[1].replace(/ |;/g,"")===e)&&g.push(this.e[f]);
else if("RegExp"===f)for(f=0;f<this.e.length;f++)if(c=this.e[f].indexElem.cssText.match(/[\S]+:.+?;/g))for(d=0;d<c.length;d++)(e=c[d].match(a))&&g.push(this.e[f]);return q(g,b,!0)};e.update=function(){var a,b;for(a=0;a<this.e.length;a++){if(!1!==this.e[a].indexElem._update){var f=this.e[a].indexElem._update();for(b in f)this.set(b,f[b],a)}if(this.e[a].children)v(null,this.e[a].children).update();else for(b in this.e[a].indexElem.style._update)f=this.e[a].indexElem.style._update[b](),this.set(b,f,
a)}return this};e.delete=function(a){var c;if("undefined"===typeof a)for(c=0;c<this.e.length;c++){this.e[c].indexElem.parentRule?this.e[c].indexElem.parentRule.deleteRule(this.e[c]):this.e[c].indexElem.parentStyleSheet.deleteRule(this.e[c]);var f=this.e[c].parent?this.e[c].parent:null;f=f?f:p;f[b]&&delete f[b];this.e[c].children&&(f=v(null,this.e[c].children),f.delete(a))}else for(c=0;c<this.e.length;c++)this.e[c].indexElem.style[a]="",this.e[c].children&&(f=v(null,this.e[c].children),f.delete(a));
return this};e.export=function(a,c){var b,e,d;if(a===h.export.type.obj||a===h.export.type.object){a=h.export.type.object;var g={}}else g="";c||(c=[]);for(b=0;b<this.e.length;b++)if(!(0<=c.indexOf(this.e[b])))if(a===h.export.type.object){var k=Object.assign({},this.e[b].obj);for(d in this.e[b].obj)if(this.e[b].obj[d].selector){var m=q([this.e[b].obj[d]]);k[d]=m.export(a,c)[this.e[b].obj[d].selector];c.push(this.e[b].obj[d])}else if("object"===typeof this.e[b].obj[d]&&"length"in this.e[b].obj[d])for(k[d]=
Object.assign({},this.e[b].obj[d]),e=0;e<this.e[b].obj[d].length;e++)m=q([this.e[b].obj[d][e]]),k[d][e]=m.export(a,c)[this.e[b].obj[d][e].selector],c.push(this.e[b].obj[d][e]);this.e[b].children?(k=v(null,this.e[b].children),g[this.e[b].selector]=k.export(a,c)):g[this.e[b].selector]?("length"in g[this.e[b].selector]||(g[this.e[b].selector]=[g[this.e[b].selector]]),g[this.e[b].selector].push(k)):g[this.e[b].selector]=k}else this.e[b].indexElem.cssText.match(/^[\s\S]+?\{\s*?\}\s*?$/)||(g+=n.exportParser(this.e[b].indexElem.cssText,
a));return a===h.export.type.object?g:g.trim()};e.pos=function(a){return q(this.e[a]?[this.e[a]]:[])};e.first=function(){return this.pos(0)};e.last=function(){return this.pos(this.e.length-1)};return e},n={elemType:function(a,b){return b?Object.prototype.toString.call(a):Object.prototype.toString.call(a).replace(/(^\[.+\s|\]$)/g,"")},createNewStyleElem:function(){if(document.getElementById(h.conf.styleId)){for(var a=0;10>a;a++)if(!document.getElementById(h.conf.styleId+"-"+a)){h.conf.styleId=h.conf.styleId+
"-"+a;break}if(document.getElementById(h.conf.styleId))throw Error("cann not create new element..");}a=document.createElement("style");a.setAttribute("type","text/css");a.setAttribute("id",h.conf.styleId);a.appendChild(document.createTextNode(""));document.head.appendChild(a);w=a},isElemInOwnNode:function(a){return a&&!!a.parentStyleSheet&&!!a.parentStyleSheet.ownerNode&&a.parentStyleSheet.ownerNode.id===h.conf.styleId},parseValue:function(a){if(isFinite(a))return 0===a%1?a+"px":Math.floor(100*a)/
100+"px";if("String"===n.elemType(a)){var b=a.split(" ");if(0<b.length){for(var c=0;c<b.length;c++)isFinite(b[c])&&(a=b[c],b[c]=0===a%1?a+"px":Math.floor(100*a)/100+"px");return b.join(" ")}}return a},objFromCssText:function(a){var b=a.replace(/(^.*?{\s*|\s*}\s*$)/g,"");a=b.split(";");var c={};if(""!==b)for(b=0;b<a.length;b++)if(""!==a[b]){var d=a[b].split(":");c[d[0].trim()]=d.slice(1).join(":").trim()}return c},findPropInCssText:function(a,b){return(a=a.match(new RegExp(b+"s*:s*(.+?);")))?a[1].trim():
""},exportParser:function(a,b){return b===h.export.type.ruleRow?a.replace(/\n/g,"")+"\n":b===h.export.type.min?a.replace(/(;|:|\s*?{|}|,)\s+/g,function(a){return a.trim()}):a.match(/^@(media|keyframes|supports)/)?a.replace(/^(.*){([\s\S]*)}$/,function(a,b,e){return b+"\n{\n    "+e.trim().replace(/({|}|;)\s*/g,function(a){a=a.trim();if("{"===a)return"\n    {\n        ";if("}"===a)return"}\n    ";if(";"===a)return";\n        "}).replace(/\s+}/g,"\n    }").trim()+"\n}\n"}):a.replace(/({|}|;)\s*/g,function(a){a=
a.trim();if("{"===a)return"\n"+a+"\n    ";if("}"===a)return a+"\n";if(";"===a)return a+"\n    "}).replace(/\s+}/,"\n}")}};h=function(a,b){try{return B(a,b)}catch(c){h.conf.viewErr&&console.log(c),h.messages.push(c)}};h.import=function(a){try{return A(a)}catch(b){h.conf.viewErr&&console.log(b),h.messages.push(b)}};h.export=function(a){return B().export(a)};h.update=function(a){if(a)a=h(a),a.update();else for(var b in p)a=q(p[b].content),a.update()};h.ruleType={rule:1,charset:2,"import":3,media:4,fontFace:5,
page:6,keyframes:7,keyframe:8,namespace:10,counterStyle:11,supports:12,fontFeatureValues:14,names:{1:"rule",2:"charset",3:"import",4:"media",5:"fontFace",6:"page",7:"keyframes",8:"keyframe",10:"namespace",11:"counterStyle",12:"supports",14:"fontFeatureValues"}};h.events={beforeChange:"beforechange",change:"change",beforeSet:"beforeset",set:"set",beforeCreate:"beforecreate",create:"create",beforeDelete:"beforedelete","delete":"delete",beforeDestroy:"beforedestroy",destroy:"destroy"};h.export.type=
{normal:"normal",ruleRow:"ruleRow",min:"min",obj:"obj",object:"object"};h.conf={styleId:"cssc-style",viewErr:!0};h.messages=[];G?z():window.addEventListener("load",function(){z()});return h}(document.styleSheets,!0)}();
