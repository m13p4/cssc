/* CSSC.js | @version 1.0b |  m13p4 */
var CSSC=function(){var y;return function(q){var t={},z=!1,e=null,n=function(a,b){return b?Object.prototype.toString.call(a):Object.prototype.toString.call(a).replace(/(^\[.+\s|\]$)/g,"")},F=function(a,b,k){var f="",c;b=b||"";if("String"===n(a))return a;for(c in a){var d=a[c];var g=n(a[c]);if("Object"===g||"Array"===g)for("Object"===g&&(d=[a[c]]),g=0;g<d.length;g++)if("@namespace"===c||"@import"===c||"@charset"===c)f+=c+" "+d[g]+";"+(k===e.export.type.min?"":"\n");else{var l=F(d[g],b+"  ",k);""!==
l&&(f=k===e.export.type.min?f+(c+"{"+l+"}"):f+(b+c.replace(/\s*,\s*/g,",\n"+b)+" {\n"+l+b+"}\n"))}else f="@namespace"===c||"@import"===c||"@charset"===c?f+(c+" "+d+";"+(k===e.export.type.min?"":"\n")):k===e.export.type.min?f+(c+":"+d+";"):f+((2>b.length?"  ":b)+c+": "+d+";\n")}return f},A=function(a,b){return(a=a.match(new RegExp(b+"s*:s*(.+?);")))?a[1].trim():""},B=function(a,b){"@"===b.charAt(0)&&"@"===a.charAt(0)&&(b=b.substr(1));b="/"===b.charAt(0)?b.substr(1):","===b.charAt(0)?", "+b.substr(1).trim():
" "+b;if(0<=a.indexOf(",")||0<b.indexOf(",")){a=a.split(",");var e,f="",c=b.split(",");if(","!==b.charAt(0))for(e=0;e<a.length;e++)for(b=0;b<c.length;b++)f+=a[e]+c[b]+", ";else for(e=0;e<a.length;e++)f+=a[e]+b+", ";return f.replace(/,+\s*$/,"")}return a+b},G=function(a){var b=a.parentRule?a.parentRule:a.parentStyleSheet,e;for(e=0;e<b.cssRules.length;e++)b.cssRules[e]===a&&b.deleteRule(e)},H=function(a,b){var k=/(^|[^\\\$])(\$[^\W]+)/,f=0,c=a.match(k);for(b||(b={});c;){var d=c[2].substr(1);var g=new RegExp("\\"+
c[2],"g");a=d in b?a.replace(g,b[d]):d in e.vars?a.replace(g,e.vars[d]):a.replace(g,"\\\\"+c[2]);if(100<f++)break;c=a.match(k)}return a},C=function(a,b){for(var k=0;k<a.length;k++){var f=a[k];f&&f.parentStyleSheet&&f.parentStyleSheet.ownerNode&&f.parentStyleSheet.ownerNode.id===e.conf.styleId||w(a[k],b)}},w=function(a,b,k){var f=a.cssText.substr(0,a.cssText.indexOf("{")).trim(),c=a.type,d=b?b.children:t;if(c!==e.type.rule&&c!==e.type.fontFace&&c!==e.type.media&&c!==e.type.keyframes&&c!==e.type.keyframe&&
c!==e.type.page&&c!==e.type.supports&&c!==e.type.namespace&&c!==e.type.import&&c!==e.type.charset)console.log("unsuported type: ["+c+"] - "+e.type.names[c]);else{c===e.type.namespace&&(f="@namespace");c===e.type.import&&(f="@import");c===e.type.charset&&(f="@charset");a._update=!1;c===e.type.rule&&(a.style._update={});b={indexElem:a,selector:f,csscSelector:k?k:f,children:!1,parent:b?b:!1,events:{},obj:{},type:c};d[f]?(d[f].content[0].indexElem===a&&(console.log('Dublicate "'+f+'": '),console.log(Error().stack+
"\n\n")),b=d[f].content.push(b)-1):(d[f]={type:c,content:[b],events:{}},b=0);if(c===e.type.media||c===e.type.keyframes||c===e.type.supports)d[f].content[b].children={},C(a.cssRules,d[f].content[b]);else{c=d[f].content[b];a=a.cssText;if(a.match(/^@(namespace|import|charset)/))a=a.replace(/(^@(namespace|import|charset)\s*|\s*;\s*$)/g,"");else{k=a.replace(/(^.*?{\s*|\s*}\s*$)/g,"");a=k.split(";");b={};if(""!==k)for(k=0;k<a.length;k++)if(""!==a[k]){var g=a[k].split(":");b[g[0].trim()]=g.slice(1).join(":").trim()}a=
b}c.obj=a}return d[f]}},v=function(a,b,k,f){var c;if(!f&&!y){if(document.getElementById(e.conf.styleId)){for(c=0;10>c;c++)if(!document.getElementById(e.conf.styleId+"-"+c)){e.conf.styleId=e.conf.styleId+"-"+c;break}if(document.getElementById(e.conf.styleId))throw Error("cann not create new element..");}c=document.createElement("style");c.setAttribute("type","text/css");c.setAttribute("id",e.conf.styleId);c.appendChild(document.createTextNode(""));document.head.appendChild(c);y=c}c=f?f.indexElem:y.sheet;
var d=c.cssRules.length,g="";if(b){var l=n(b);if("Object"===l)for(var m in b)"Function"===n(b[m])?(k=b[m](),g+=m+":"+k+"; "):g+=m+":"+b[m]+"; ";else if("Function"===l)for(m in k=b(),k)g+=m+":"+k[m]+"; ";else g=b+":"+k+";"}try{k=a+"{"+g+"}";if("@namespace"===a||"@import"===a||"@charset"===a)k=a+" "+b;return"@charset"!==a?("insertRule"in c?c.insertRule(k,d):"appendRule"in c?c.appendRule(k,d):"addRule"in c&&c.addRule(a,g,d),w(c.cssRules[d],f,a)):w({csscSelector:a,cssText:k,parent:!1,type:e.type.charset,
cssRules:{}},f,m)}catch(h){a=(f?'"'+f.selector+'" > ':"")+'"'+a+'" -> '+h,e.conf.viewErr&&console.log(a),e.messages.push(a)}return!1},I=function(a,b){if(!z&&!z){if("cssRules"in q){var k=(q.ownerNode.getAttribute("data-cssc-ignore")||"").toLowerCase();if("true"!==k&&"1"!==k)try{C(q.cssRules,null)}catch(c){e.conf.viewErr&&console.log('Cannot init CSS from "'+q.href+'"'),e.messages.push('Cannot init CSS from "'+q.href+'"')}}else if("length"in q)for(var f=0;f<q.length;f++)if(k=(q[f].ownerNode.getAttribute("data-cssc-ignore")||
"").toLowerCase(),"true"!==k&&"1"!==k)try{C(q[f].cssRules,null)}catch(c){e.conf.viewErr&&console.log('Cannot init CSS from "'+q[f].href+'"'),e.messages.push('Cannot init CSS from "'+q[f].href+'"')}z=!0}b=b?b:t;return b[a]?b[a]:null},J=function(a,b,e){b=b?b:t;if(b[a]){var f=e?b[a].content.indexOf(e):-1;e?0<=f&&(b[a].content.splice(f,1),0>=b[a].content.length&&delete b[a]):delete b[a]}},u=function(a,b,e){b=b?b:t;var f=n(a);if("String"===f)return b=I(a,b),e?b?b.content:[]:p(b?b.content:[],a);if("RegExp"===
f){f=[];for(var c in b)if(c.match(a))for(d=0;d<b[c].content.length;d++)f.push(b[c].content[d]);return e?f:p(f,a)}if("Array"===f){f=[];var d;for(d=0;d<a.length;d++){var g=I(a[d],b);if(null!==g)for(c=0;c<g.content.length;c++)f.push(g.content[c])}return e?f:p(f,a)}if("Null"===f||"Undefined"===f){f=[];for(c in b)for(d=0;d<b[c].content.length;d++)f.push(b[c].content[d]);return e?f:p(f,a)}return null},E=function(a,b,e,f){var c=n(a);if("String"===c||"RegExp"===c||"Array"===c||"Null"===c||"Undefined"===c)return a=
u(a,e,f),b?a.has(b):a;D(a)},D=function(a,b){var k;for(c in a){var f="Array"===n(a[c])?a[c]:[a[c]];var c=H(c);for(k=0;k<f.length;k++)if("@"===c.charAt(0))if("@font-face"===c||"@namespace"===c||"@import"===c||"@charset"===c)v(c,f[k],null,b);else{if(c.match(/^@(media|keyframes|supports)/)||b&&(b.type===e.type.media||b.type===e.type.keyframes||b.type===e.type.supports)){var d=b;var g=c;b&&!g.match(/^@(media|keyframes|supports)/)&&(c=B(b.csscSelector,c),d=b.parent);var l=v(c,null,null,d);if(!l||l.content[l.content.length-
1].selector!==l.content[l.content.length-1].csscSelector){if(l){var m=l.content.length-1;G(l.content[m].indexElem);J(l.content[m].selector,l.content[m].parent,l.content[m])}l=c;m=c+" {}";d=d||!1;var h=c;h=h.trim();if("@"!==h.charAt(0))var r=e.type.rule;else{h=h.substr(1);r=h.indexOf(" ");0<=r&&(h=h.substr(0,r));r=h;if(0<=h.indexOf("-")){var x=h.split("-");r=x[0];for(h=1;h<x.length;h++)r+=x[h].charAt(0).toUpperCase()+x[h].substr(1)}r=r in e.type?e.type[r]:-1}d={csscSelector:l,cssText:m,parent:d,type:r,
cssRules:{}};l=w(d,d.parent,c)}D(f[k],l.content[l.content.length-1]);b&&(b.obj[g]||(b.obj[g]=[]),b.obj[g].push(l.content[l.content.length-1]))}}else if(l=v(c,null,null,b))g=p([l.content[l.content.length-1]],c),g.set(f[k])}},p=function(a,b,k,f){var c=function(){if(0>=d.e.length&&!k&&"String"===n(b)){var g,a=[],c,h;if(f)for(c=0;c<f.length;c++){if(g=v(b,null,null,f[c]))for(h=0;h<g.content.length;h++)a.push(g.content[h])}else if(g=v(b,null,null))a=g.content;d.e=a;d.eLength=a.length}};var d=function(b,
a){var g,h,e=[];c();for(g=0;g<d.e.length;g++)if(d.e[g].children){var l=E(b,a,d.e[g].children,!0);for(h=0;h<l.length;h++)e.push(l[h])}return p(e,b,null,d.e)};d.e=a;d.eLength=a.length;d.set=function(b,a,m){if("number"===typeof m){if(this.e[m].indexElem.type===e.type.fontFace)return e.conf.viewErr&&console.log('Element of Type "'+e.type.names[this.e[m].indexElem.type]+'" is readonly.'),e.messages.push('Element of Type "'+e.type.names[this.e[m].indexElem.type]+'" is readonly.'),this;b=H(b);if(this.e[m].children)u(null,
this.e[m].children).set(b,a);else{var h,g=n(a);if("Object"===g||"Array"===g){var f=B(this.e[m].selector,b);a="Object"===g?[a]:a;for(h=0;h<a.length;h++){g=null;if("@"===b.charAt(0)){if(g=u(this.e[m].parent?B(this.e[m].parent.selector,b):b),g=g(this.e[m].selector),g.set(a[h]),g=g.e[g.e.length-1],this.e[m].parent){var l=this.e[m].parent;l.obj[b]&&"push"in l.obj[b]||(l.obj[b]=[]);l.obj[b].push(g.parent)}}else if(l=v(f,null,null,this.e[m].parent))g=p([l.content[l.content.length-1]],d),g.set(a[h]),g=l.content[l.content.length-
1];null!==g&&(this.e[m].obj[b]&&"push"in this.e[m].obj[b]||(this.e[m].obj[b]=[]),this.e[m].obj[b].push(g))}}else if("Function"===g){var d=this.pos(m).get(b);try{h=a(d),this.set(b,h,m),this.e[m].indexElem.style._update[b]=a}catch(K){e.conf.viewErr&&console.log(K),e.messages.push(K)}}else{a:if(isFinite(a))h=0===a%1?a+"px":Math.floor(100*a)/100+"px";else{if("String"===n(a)&&(h=a.split(" "),0<h.length)){for(a=0;a<h.length;a++)isFinite(h[a])&&(d=h[a],h[a]=0===d%1?d+"px":Math.floor(100*d)/100+"px");h=h.join(" ");
break a}h=a}this.e[m].indexElem.style[b]=h;this.e[m].obj[b]=h}}}else if(m=n(b),"Object"===m?f=Object.keys(b).length:"Function"===m&&(g=b()),c(),"Array"===m||"Function"===m&&"Array"===n(g))for(m="Array"===m?b:g,h=0;h<m.length;h++)if(b=this.pos(h),1===b.e.length)b.set(m[h]);else break;else for(h=0;h<this.e.length;h++)if("Object"===m&&0<f)for(d in b)this.set(d,b[d],h);else if("Function"===m){for(d in g)this.set(d,g[d],h);this.e[h].indexElem._update=b}else this.set(b,a,h);return this};d.get=function(b,
a){if(!b)return this.export(e.export.type.object);var c=[],g="",f;a=!!a;for(f=0;f<this.e.length;f++){var d="";this.e[f].obj[b]&&(d=this.e[f].obj[b],"Array"===n(d)&&(d=p(d),d=d.export(e.export.type.object)));d&&""!==d||(d=this.e[f].indexElem.style[b]);d&&""!==d||(d=A(this.e[f].indexElem.cssText,b));d&&(g=d,a&&c.push(g))}return a?c:g};d.has=function(a){var c=[];var g=n(a);if("String"===g){var e=a.split(":");for(g=0;g<this.e.length;g++){var d=A(this.e[g].indexElem.cssText,e[0]);""!==d&&(!e[1]||e[1]&&
e[1].replace(/ |;/g,"")===d)&&c.push(this.e[g])}}else if("Array"===g)for(var f=0;f<a.length;f++)for(e=a[f].split(":"),g=0;g<this.e.length;g++)d=A(this.e[g].indexElem.cssText,e[0]),""!==d&&(!e[1]||e[1]&&e[1].replace(/ |;/g,"")===d)&&c.push(this.e[g]);else if("RegExp"===g)for(g=0;g<this.e.length;g++)if(e=this.e[g].indexElem.cssText.match(/[\S]+:.+?;/g))for(f=0;f<e.length;f++)(d=e[f].match(a))&&c.push(this.e[g]);return p(c,b,!0)};d.update=function(){var b,a;for(b=0;b<this.e.length;b++){if(!1!==this.e[b].indexElem._update){var c=
this.e[b].indexElem._update();for(a in c)this.set(a,c[a],b)}if(this.e[b].children)u(null,this.e[b].children).update();else if(this.e[b].indexElem.style)for(a in this.e[b].indexElem.style._update)c=this.e[b].indexElem.style._update[a](),this.set(a,c,b)}return this};d.delete=function(b){var a;if("undefined"===typeof b)for(a=0;a<this.e.length;a++){if(G(this.e[a].indexElem),J(this.e[a].selector,this.e[a].parent?this.e[a].parent:null,this.e[a]),this.e[a].children){var c=u(null,this.e[a].children);c.delete(b)}}else for(a=
0;a<this.e.length;a++)this.e[a].indexElem.style[b]="",this.e[a].children&&(c=u(null,this.e[a].children),c.delete(b));return this};d.export=function(a,b){var c={},d,f,g,k=a;a===e.export.type.obj&&(a=e.export.type.object);if(a===e.export.type.normal||a===e.export.type.min)a=e.export.type.notMDObject;b||(b=[]);for(d=0;d<this.e.length;d++)if(!(0<=b.indexOf(this.e[d]))){if(this.e[d].type===e.type.namespace||this.e[d].type===e.type.import||this.e[d].type===e.type.charset)var l=this.e[d].obj;else for(g in l=
Object.assign({},this.e[d].obj),this.e[d].obj)if("object"===typeof this.e[d].obj[g]&&"length"in this.e[d].obj[g])if(a===e.export.type.notMDObject)l[g]=null,delete l[g];else{l[g]=[];for(f=0;f<this.e[d].obj[g].length;f++)if(!(0<=b.indexOf(this.e[d].obj[g][f]))){var n=p([this.e[d].obj[g][f]]);n=n.export(a,b)[this.e[d].obj[g][f].selector];b.push(this.e[d].obj[g][f]);!n||0>=Object.keys(n).length||(l[g][f]=n)}0===l[g].length?delete l[g]:1===l[g].length&&(l[g]=l[g][0])}this.e[d].children&&(n=u(null,this.e[d].children),
l=Object.assign(n.export(a,b),l));0>=Object.keys(l).length||(c[this.e[d].selector]?("object"===typeof c[this.e[d].selector]&&"length"in c[this.e[d].selector]||(c[this.e[d].selector]=[c[this.e[d].selector]]),c[this.e[d].selector].push(l)):c[this.e[d].selector]=l,b.push(this.e[d]))}a={};c["@charset"]&&(a["@charset"]=c["@charset"]);c["@import"]&&(a["@import"]=c["@import"]);c["@namespace"]&&(a["@namespace"]=c["@namespace"]);c["@font-face"]&&(a["@font-face"]=c["@font-face"]);if(n=0<Object.keys(a).length)for(d in c)a[d]||
(a[d]=c[d]);return k===e.export.type.normal||k===e.export.type.min?F(n?a:c,null,k):n?a:c};d.pos=function(a){return p(this.e[a]?[this.e[a]]:[])};d.first=function(){return this.pos(0)};d.last=function(){return this.pos(this.e.length-1)};return d};e=function(a,b){try{return E(a,b)}catch(k){e.conf.viewErr&&console.log(k),e.messages.push(k)}};e.import=function(a){try{return D(a)}catch(b){e.conf.viewErr&&console.log(b),e.messages.push(b)}};e.export=function(a){return E().export(a)};e.update=function(a){if(a)a=
e(a),a.update();else for(var b in t)a=p(t[b].content),a.update()};e.type={rule:1,charset:2,"import":3,media:4,fontFace:5,page:6,keyframes:7,keyframe:8,namespace:10,counterStyle:11,supports:12,fontFeatureValues:14,viewport:15,names:{1:"rule",2:"charset",3:"import",4:"media",5:"font-face",6:"page",7:"keyframes",8:"keyframe",10:"namespace",11:"counter-style",12:"supports",14:"font-feature-values",15:"viewport"}};e.events={beforeChange:"beforechange",change:"change",beforeSet:"beforeset",set:"set",beforeCreate:"beforecreate",
create:"create",beforeDelete:"beforedelete","delete":"delete",beforeDestroy:"beforedestroy",destroy:"destroy"};e.export.type={normal:"css",min:"minCss",obj:"obj",object:"object",notMDObject:"objNMDO"};e.conf={styleId:"cssc-style",viewErr:!0};e.messages=[];e.vars={};e.messages.push(t);return e}(document.styleSheets)}();
