/*
@version 1.0b
@author m13p4
@copyright Meliantchenkov Pavel
*/
var CSSC=function(){var w;return function(n,G){var p={},x=!1,b=null,z=function(){if(!x){if("cssRules"in n){var a=(n.ownerNode.getAttribute("data-cssc-ignore")||"").toLowerCase();if("true"!==a&&"1"!==a)try{y(n.cssRules,null)}catch(g){b.conf.viewErr&&console.log('Cannot init CSS from "'+n.href+'"'),b.messages.push('Cannot init CSS from "'+n.href+'"')}}else if("length"in n)for(var c=0;c<n.length;c++)if(a=(n[c].ownerNode.getAttribute("data-cssc-ignore")||"").toLowerCase(),"true"!==a&&"1"!==a)try{y(n[c].cssRules,
null)}catch(g){b.conf.viewErr&&console.log('Cannot init CSS from "'+n[c].href+'"'),b.messages.push('Cannot init CSS from "'+n[c].href+'"')}x=!0}},y=function(a,c){for(var g=0;g<a.length;g++)m.isElemInOwnNode(a[g])||C(a[g],c)},C=function(a,c){var g=a.cssText.substr(0,a.cssText.indexOf("{")).trim(),h=a.type,f=c?c.children:p;if(h!==b.ruleType.rule&&h!==b.ruleType.fontFace&&h!==b.ruleType.media&&h!==b.ruleType.keyframes&&h!==b.ruleType.keyframe&&h!==b.ruleType.page&&h!==b.ruleType.supports)console.log("unsuported type: ["+
h+"] - "+b.ruleType.names[h]);else return a._update=!1,h===b.ruleType.rule&&(a.style._update={}),c={indexElem:a,selector:g,children:!1,parent:c?c:!1,events:{},obj:{},type:h},f[g]?(f[g].content[0].indexElem===a&&(console.log('Dublicate "'+g+'": '),console.log(Error().stack+"\n\n")),c=f[g].content.push(c)-1):(f[g]={type:h,content:[c],events:{}},c=0),h===b.ruleType.media||h===b.ruleType.keyframes||h===b.ruleType.supports?(f[g].content[c].children={},y(a.cssRules,f[g].content[c])):f[g].content[c].obj=
m.objFromCssText(a.cssText),f[g]},u=function(a,c,g,h){h||w||m.createNewStyleElem();var f=h?h.indexElem:w.sheet;var e=f.cssRules.length,k="";if(c){var d=m.elemType(c);if("Object"===d)for(var t in c)"Function"===m.elemType(c[t])?(g=c[t](),k+=t+":"+g+"; "):k+=t+":"+c[t]+"; ";else if("Function"===d)for(t in g=c(),g)k+=t+":"+g[t]+"; ";else k=c+":"+g+";"}try{return"insertRule"in f?f.insertRule(a+"{"+k+"}",e):"appendRule"in f?f.appendRule(a+"{"+k+"}",e):"addRule"in f&&f.addRule(a,k,e),C(f.cssRules[e],h)}catch(D){b.conf.viewErr&&
console.log('"'+a+'" -> '+D),b.messages.push('"'+a+'" -> '+D)}return!1},E=function(a,c){x||z();c=c?c:p;return c[a]?c[a]:null},v=function(a,c,g){c=c?c:p;var b=m.elemType(a);if("String"===b)return c=E(a,c),g?c?c.content:[]:q(c?c.content:[],a);if("RegExp"===b){b=[];for(var f in c)if(f.match(a))for(e=0;e<c[f].content.length;e++)b.push(c[f].content[e]);return g?b:q(b,a)}if("Array"===b){b=[];var e;for(e=0;e<a.length;e++){var k=E(a[e],c);if(null!==k)for(f=0;f<k.content.length;f++)b.push(k.content[f])}return g?
b:q(b,a)}if("Null"===b||"Undefined"===b){b=[];for(f in c)for(e=0;e<c[f].content.length;e++)b.push(c[f].content[e]);return g?b:q(b,a)}return null},B=function(a,c,b,h){var g=m.elemType(a);if("String"===g||"RegExp"===g||"Array"===g||"Null"===g||"Undefined"===g)return a=v(a,b,h),c?a.has(c):a;A(a,null,b)},A=function(a,c){var b,h,f;for(h in a){var e="Array"===m.elemType(a[h])?a[h]:[a[h]];for(f=0;f<e.length;f++)if("@font-face"===h)u(h,e[f],null,c);else if(h.match(/^@(media|keyframes|supports)/)){if(b=u(h,
null,null,c)){var k=b.content.length-1;A(e[f],b.content[k])}}else if(b=u(h,null,null,c))b=q([b.content[b.content.length-1]],h),b.set(e[f])}},q=function(a,c,g,h){var f=function(a,c){var d,e,b=[];for(d=0;d<f.e.length;d++)if(f.e[d].children){var k=B(a,c,f.e[d].children,!0);for(e=0;e<k.length;e++)b.push(k[e])}return q(b,a,null,f.e)};f.e=a;f.eLength=a.length;f.set=function(a,k,d){if("number"===typeof d){if(this.e[d].indexElem.type===b.ruleType.fontFace)return b.conf.viewErr&&console.log('Element of Type "'+
b.ruleType.names[this.e[d].indexElem.type]+'" is readonly.'),b.messages.push('Element of Type "'+b.ruleType.names[this.e[d].indexElem.type]+'" is readonly.'),this;if(this.e[d].children)v(null,this.e[d].children).set(a,k);else{var e=m.elemType(k);if("Object"===e||"Array"===e){var f=this.e[d].selector+" "+a;k="Object"===e?[k]:k;var l;a.match(/^(\[|:|\/)/)&&(f=this.e[d].selector+a.replace(/^\//,""));for(l=0;l<k.length;l++)if(e=u(f,null,null,this.e[d].parent))q([e.content[e.content.length-1]],r).set(k[l]),
this.e[d].obj[a]&&this.e[d].obj[a].indexElem?this.e[d].obj[a]=[this.e[d].obj[a],e.content[e.content.length-1]]:this.e[d].obj[a]&&"push"in this.e[d].obj[a]?this.e[d].obj[a].push(e.content[e.content.length-1]):this.e[d].obj[a]=e.content[e.content.length-1]}else if("Function"===e){var r=this.pos(d).get(a);try{l=k(r),this.set(a,l,d),this.e[d].indexElem.style._update[a]=k}catch(F){b.conf.viewErr&&console.log(F),b.messages.push(F)}}else k=m.parseValue(k),this.e[d].indexElem.style[a]=k,this.e[d].obj[a]=
k}}else{var n;d=m.elemType(a);"Object"===d?f=Object.keys(a).length:"Function"===d&&(n=a());if(0>=this.e.length&&!g&&"String"===m.elemType(c)){var p=[];if(h)for(p=[],l=0;l<h.length;l++){if(e=u(c,null,null,h[l].indexElem,h[l].children))for(r=0;r<e.content.length;r++)p.push(e.content[r])}else if(e=u(c,null,null))p=e.content;this.e=p;this.eLength=p.length}if("Array"===d||"Function"===d&&"Array"===m.elemType(n))for(k="Array"===d?a:n,l=0;l<k.length;l++)if(a=this.pos(l),1===a.e.length)a.set(k[l]);else break;
else for(l=0;l<this.e.length;l++)if("Object"===d&&0<f)for(r in a)this.set(r,a[r],l);else if("Function"===d){for(r in n)this.set(r,n[r],l);this.e[l].indexElem._update=a}else this.set(a,k,l)}return this};f.get=function(a,c){if(!a)return this.export(b.export.type.object);var d=[],e="",k;c=!!c;for(k=0;k<this.e.length;k++){var g="";this.e[k].obj[a]&&!this.e[k].obj[a].selector&&(g=this.e[k].obj[a]);g&&""!==g||(g=this.e[k].indexElem.style[a]);g&&""!==g||(g=m.findPropInCssText(this.e[k].indexElem.cssText,
a));g&&(e=g,c&&d.push(e))}return c?d:e};f.has=function(a){var b=[];var d=m.elemType(a);if("String"===d){var e=a.split(":");for(d=0;d<this.e.length;d++){var g=m.findPropInCssText(this.e[d].indexElem.cssText,e[0]);""!==g&&(!e[1]||e[1]&&e[1].replace(/ |;/g,"")===g)&&b.push(this.e[d])}}else if("Array"===d)for(var f=0;f<a.length;f++)for(e=a[f].split(":"),d=0;d<this.e.length;d++)g=m.findPropInCssText(this.e[d].indexElem.cssText,e[0]),""!==g&&(!e[1]||e[1]&&e[1].replace(/ |;/g,"")===g)&&b.push(this.e[d]);
else if("RegExp"===d)for(d=0;d<this.e.length;d++)if(e=this.e[d].indexElem.cssText.match(/[\S]+:.+?;/g))for(f=0;f<e.length;f++)(g=e[f].match(a))&&b.push(this.e[d]);return q(b,c,!0)};f.update=function(){var a,c;for(a=0;a<this.e.length;a++){if(!1!==this.e[a].indexElem._update){var d=this.e[a].indexElem._update();for(c in d)this.set(c,d[c],a)}if(this.e[a].children)v(null,this.e[a].children).update();else for(c in this.e[a].indexElem.style._update)d=this.e[a].indexElem.style._update[c](),this.set(c,d,
a)}return this};f.delete=function(a){var b;if("undefined"===typeof a)for(b=0;b<this.e.length;b++){this.e[b].indexElem.parentRule?this.e[b].indexElem.parentRule.deleteRule(this.e[b]):this.e[b].indexElem.parentStyleSheet.deleteRule(this.e[b]);var d=this.e[b].parent?this.e[b].parent:null;d=d?d:p;d[c]&&delete d[c];this.e[b].children&&(d=v(null,this.e[b].children),d.delete(a))}else for(b=0;b<this.e.length;b++)this.e[b].indexElem.style[a]="",this.e[b].children&&(d=v(null,this.e[b].children),d.delete(a));
return this};f.export=function(a,c){var d,g,e;if(a===b.export.type.obj||a===b.export.type.object||a===b.export.type.notMDObject){a===b.export.type.obj&&(a=b.export.type.object);var f={}}else f="";c||(c=[]);for(d=0;d<this.e.length;d++)if(!(0<=c.indexOf(this.e[d])))if(a===b.export.type.object||a===b.export.type.notMDObject){var h=Object.assign({},this.e[d].obj);for(e in this.e[d].obj)if(this.e[d].obj[e].selector)if(a===b.export.type.notMDObject)h[e]=null,delete h[e];else{var k=q([this.e[d].obj[e]]);
h[e]=k.export(a,c)[this.e[d].obj[e].selector];c.push(this.e[d].obj[e])}else if("object"===typeof this.e[d].obj[e]&&"length"in this.e[d].obj[e])if(a===b.export.type.notMDObject)h[e]=null,delete h[e];else for(h[e]=Object.assign({},this.e[d].obj[e]),g=0;g<this.e[d].obj[e].length;g++)k=q([this.e[d].obj[e][g]]),h[e][g]=k.export(a,c)[this.e[d].obj[e][g].selector],c.push(this.e[d].obj[e][g]);this.e[d].children?(h=v(null,this.e[d].children),f[this.e[d].selector]?("length"in f[this.e[d].selector]||(f[this.e[d].selector]=
[f[this.e[d].selector]]),f[this.e[d].selector].push(h.export(a,c))):f[this.e[d].selector]=h.export(a,c)):f[this.e[d].selector]?("length"in f[this.e[d].selector]||(f[this.e[d].selector]=[f[this.e[d].selector]]),f[this.e[d].selector].push(h)):f[this.e[d].selector]=h}else this.e[d].indexElem.cssText.match(/^[\s\S]+?\{\s*?\}\s*?$/)||(f+=m.exportParser(this.e[d].indexElem.cssText,a));return a===b.export.type.object||a===b.export.type.notMDObject?f:f.trim()};f.pos=function(a){return q(this.e[a]?[this.e[a]]:
[])};f.first=function(){return this.pos(0)};f.last=function(){return this.pos(this.e.length-1)};return f},m={elemType:function(a,c){return c?Object.prototype.toString.call(a):Object.prototype.toString.call(a).replace(/(^\[.+\s|\]$)/g,"")},createNewStyleElem:function(){if(document.getElementById(b.conf.styleId)){for(var a=0;10>a;a++)if(!document.getElementById(b.conf.styleId+"-"+a)){b.conf.styleId=b.conf.styleId+"-"+a;break}if(document.getElementById(b.conf.styleId))throw Error("cann not create new element..");
}a=document.createElement("style");a.setAttribute("type","text/css");a.setAttribute("id",b.conf.styleId);a.appendChild(document.createTextNode(""));document.head.appendChild(a);w=a},isElemInOwnNode:function(a){return a&&!!a.parentStyleSheet&&!!a.parentStyleSheet.ownerNode&&a.parentStyleSheet.ownerNode.id===b.conf.styleId},parseValue:function(a){if(isFinite(a))return 0===a%1?a+"px":Math.floor(100*a)/100+"px";if("String"===m.elemType(a)){var c=a.split(" ");if(0<c.length){for(var b=0;b<c.length;b++)isFinite(c[b])&&
(a=c[b],c[b]=0===a%1?a+"px":Math.floor(100*a)/100+"px");return c.join(" ")}}return a},objFromCssText:function(a){var b=a.replace(/(^.*?{\s*|\s*}\s*$)/g,"");a=b.split(";");var g={};if(""!==b)for(b=0;b<a.length;b++)if(""!==a[b]){var h=a[b].split(":");g[h[0].trim()]=h.slice(1).join(":").trim()}return g},findPropInCssText:function(a,b){return(a=a.match(new RegExp(b+"s*:s*(.+?);")))?a[1].trim():""},exportParser:function(a,c){return c===b.export.type.ruleRow?a.replace(/\n/g,"")+"\n":c===b.export.type.min?
a.replace(/(;|:|\s*?{|}|,)\s+/g,function(a){return a.trim()}):a.match(/^@(media|keyframes|supports)/)?a.replace(/^(.*){([\s\S]*)}$/,function(a,b,c){return b+"\n{\n    "+c.trim().replace(/({|}|;)\s*/g,function(a){a=a.trim();if("{"===a)return"\n    {\n        ";if("}"===a)return"}\n    ";if(";"===a)return";\n        "}).replace(/\s+}/g,"\n    }").trim()+"\n}\n"}):a.replace(/({|}|;)\s*/g,function(a){a=a.trim();if("{"===a)return"\n"+a+"\n    ";if("}"===a)return a+"\n";if(";"===a)return a+"\n    "}).replace(/\s+}/,
"\n}")}};b=function(a,c){try{return B(a,c)}catch(g){b.conf.viewErr&&console.log(g),b.messages.push(g)}};b.import=function(a){try{return A(a)}catch(c){b.conf.viewErr&&console.log(c),b.messages.push(c)}};b.export=function(a){return B().export(a)};b.update=function(a){if(a)a=b(a),a.update();else for(var c in p)a=q(p[c].content),a.update()};b.ruleType={rule:1,charset:2,"import":3,media:4,fontFace:5,page:6,keyframes:7,keyframe:8,namespace:10,counterStyle:11,supports:12,fontFeatureValues:14,names:{1:"rule",
2:"charset",3:"import",4:"media",5:"fontFace",6:"page",7:"keyframes",8:"keyframe",10:"namespace",11:"counterStyle",12:"supports",14:"fontFeatureValues"}};b.events={beforeChange:"beforechange",change:"change",beforeSet:"beforeset",set:"set",beforeCreate:"beforecreate",create:"create",beforeDelete:"beforedelete","delete":"delete",beforeDestroy:"beforedestroy",destroy:"destroy"};b.export.type={normal:"normal",ruleRow:"ruleRow",min:"min",obj:"obj",object:"object",notMDObject:"nMDO"};b.conf={styleId:"cssc-style",
viewErr:!0};b.messages=[];G?z():window.addEventListener("load",function(){z()});return b}(document.styleSheets,!0)}();
